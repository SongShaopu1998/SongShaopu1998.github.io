I"å¬<p>æˆ‘å°†2020ç§‹å­£Berkeleyçš„CS 61Aä½œä¸šå‘å¸ƒåœ¨æˆ‘çš„<a href="https://github.com/SongShaopu1998/Berkeley-CS-61A">Githubä»“åº“</a>.</p>

<blockquote>
  <p>å‡ ç±»é€’å½’é—®é¢˜ï¼š</p>

  <ul>
    <li><a href="#anchor5">Number Selection Problem</a>, <a href="#anchor8">Lists/String Selection Problem</a></li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">ä»ç»™å®šçš„æ•°å­—åºåˆ—ä¸­ç­›é€‰å‡ºç¬¦åˆé¢˜æ„çš„æ•°å­—ç»„åˆï¼Œæ­¤ç±»é¢˜ç›®ä¸€èˆ¬ä½¿ç”¨Tree Recursionè§£å†³ï¼Œåˆ†ä¸ºä½¿ç”¨æœ€åä¸€ä½æ•°å­—å’Œä¸ä½¿ç”¨æœ€åä¸€ä½æ•°å­—ä¸¤ç§æƒ…å†µï¼ˆn //10 &amp; n % 10ï¼‰,è¿™ç±»é¢˜ç›®ä¹Ÿå¸¸ä¾æ‰˜äºåˆ—è¡¨æˆ–è€…å­—ç¬¦ä¸²ç­‰åŸºç¡€æ•°æ®ç»“æ„ï¼Œä½†åŸºæœ¬çš„æ€è·¯æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯æ¯”è¾ƒå…¸å‹çš„Tree Recursioné—®é¢˜</code></p>

  <ul>
    <li><a href="#anchor14">Hysteresis Number Problem</a>, <a href="#anchor15">Hysteresis list element Problem</a></li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">æ­¤ç±»é—®é¢˜ä¼šé€šè¿‡ä¸€ä¸ªå˜é‡æˆ–è€…å‡½æ•°å‚æ•°ä¿å­˜å…ˆå‰éå†è¿‡æˆ–è€…æŸ¥çœ‹è¿‡çš„æŸä¸ªå˜é‡ï¼Œåœ¨ä¸‹ä¸€æ¬¡é€’å½’ä¸­å‚ä¸æ¯”è¾ƒ</code></p>

  <ul>
    <li><a href="#anchor9">Mutual Recursion</a>, <a href="#anchor6">Recursion with helper function</a>, <a href="#anchor7">Recursion-&gt;Tree with helper function</a></li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">æ­¤ç±»é—®é¢˜çš„è§£å†³ä¾é è®¾è®¡åµŒå¥—å‡½æ•°ï¼Œå¹¶è¾…ä¹‹ä»¥è·Ÿè¸ªå˜é‡indexæˆ–è€…æŸç§flagï¼Œå‡å°é€’å½’éš¾åº¦ï¼Œå¦‚æœæˆ‘ä»¬å‘ç°åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œå¢æ·»ä¸€ä¸ªè·Ÿè¸ªæŒ‡æ ‡æˆ–è€…å°†å‡½æ•°ä¸­çš„æŸéƒ¨åˆ†ç‹¬ç«‹å‡ºæ¥æ›´åŠ æ–¹ä¾¿ï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨</code></p>

  <ul>
    <li><a href="#anchor10">Number selection Problem with yield</a>, <a href="#anchor11">Recursion with yield</a></li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">è¿™æ˜¯ä¸€ç±»æ¯”è¾ƒç‰¹æ®Šçš„é€’å½’é—®é¢˜ï¼Œä½¿ç”¨yieldå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨è¿™ç±»é¢˜ç›®ä¸­å¤§å¤§ç®€æ´ä»£ç ï¼Œè¿™æ˜¯å› ä¸ºyieldæ¯æ¬¡ç”Ÿæˆçš„generatoréƒ½ä¼šè¢«ä¿å­˜è‡³ä¸‹ä¸€æ¬¡é€’å½’ä¸­ï¼Œè€Œä¸ä¼šéšç€ç¨‹åºè¿è¡Œç»“æŸè€Œæ¶ˆå¤±ï¼Œä»è€Œé¿å…äº†ä½¿ç”¨listç­‰æ•°æ®ç»“æ„å­˜å‚¨æˆ–è·Ÿéšé€’å½’ç”Ÿæˆå˜é‡çš„éœ€è¦</code></p>

  <ul>
    <li><a href="#anchor12">Basic Recursion with linked lists &amp; Trees</a>, <a href="#anchor13">Complicate Recursion with linked lists &amp; Trees</a></li>
  </ul>

  <p><code class="language-plaintext highlighter-rouge">è¿™ä¸€ç±»é—®é¢˜å·²ç»è¢«ä¸“é—¨æ•´ç†åˆ°ä¸€èµ·</code></p>
</blockquote>

<h2 id="hw1">HW1</h2>

<h4 id="q2">Q2</h4>

<p>é—®é¢˜è½¬åŒ–çš„æƒ³æ³•ï¼šé€‰å‡ºä¸¤ä¸ªæœ€å¤§çš„æ•°ï¼Œå¹¶è®¡ç®—å…¶å¹³æ–¹å’Œï¼Œå…¶å®ä¹Ÿå°±æ˜¯åœ¨è®¡ç®—æœ€å¤§çš„æ•°å€¼å¹³æ–¹ç»„åˆ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">,</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="o">+</span><span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="q3">Q3</h4>

<p>æ‘’å¼ƒéå†é¡ºåºæ­£åºçš„æƒ³æ³•ï¼Œåœ¨æ­¤é¢˜ç›®ä¸­ï¼Œå€’åºéå†æ˜¯æœ€æ–¹ä¾¿çš„:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">factor</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">factor</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span>
	<span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="n">factor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">factor</span>
	<span class="n">factor</span> <span class="o">-=</span> <span class="mi">1</span>
</code></pre></div></div>

<h4 id="q4">Q4</h4>

<p><code class="language-plaintext highlighter-rouge">if_function(cond(), true_func(), false_func()</code>ä¸­ï¼Œä¼šå…ˆæ‰§è¡Œå…¶ä¸­çš„å‡½æ•°ï¼Œä¹‹åå°†å…¶è¿”å›å€¼ä¼ å…¥ä¸»å‡½æ•°ã€‚æ‰€ä»¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸€å®šæ˜¯<code class="language-plaintext highlighter-rouge">true_func()-&gt;false_func()</code>ï¼Œæ‰§è¡Œç»“æœæ ¹æ®æç¤ºåˆ†åˆ«ä¸º42ä¸47ï¼Œåˆå› ä¸º<code class="language-plaintext highlighter-rouge">statement</code>å‡½æ•°æ‰§è¡Œç»“æœä»…ä¸º47ï¼Œæ‰€ä»¥ä¸€å®šæ˜¯<code class="language-plaintext highlighter-rouge">true_func()</code>å¯¹åº”47ï¼Œé‚£ä¹ˆ<code class="language-plaintext highlighter-rouge">false_func()</code>å¯¹åº”42ï¼Œæ ¹æ®ä¹‹å‰çš„æ‰§è¡Œé¡ºåºï¼Œæ¡ä»¶åˆ¤æ–­å‡½æ•°<code class="language-plaintext highlighter-rouge">cond()</code>åº”å½“è®¾å®šä¸º<code class="language-plaintext highlighter-rouge">false</code>ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">cond</span><span class="p">():</span>
	<span class="k">return</span> <span class="n">true_func</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
	<span class="k">return</span> <span class="n">false_func</span><span class="p">()</span>
</code></pre></div></div>

<p>åŒæ—¶æŠŠæ¡ä¸‹å›¾ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210705172319.jpg" alt="Snipaste_2021-07-05_17-20-24" style="zoom:80%;" /></p>

<blockquote>
  <p>æ•´æ•°é™¤æ³•ï¼š<strong>//</strong></p>
</blockquote>

<h2 id="lab1">Lab1</h2>

<h3 id="veritasiness">Veritasiness</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="mi">3</span> <span class="ow">and</span> <span class="mi">10</span> <span class="ow">and</span> <span class="mi">15</span>
<span class="o">&gt;&gt;&gt;</span> <span class="mi">15</span>
</code></pre></div></div>

<p>æ‰§è¡Œé¡ºåºä¸º<strong>è‡ªå·¦è‡³å³</strong>ï¼Œå¦‚æœç¬¬ä¸€é¡¹ä¸º<code class="language-plaintext highlighter-rouge">True</code>ï¼Œåˆ™åˆ¤å®šç¬¬äºŒé¡¹ï¼Œä»¥æ­¤ç±»æ¨ï¼</p>

<h3 id="coding-practice">Coding Practice</h3>

<p>åŠªåŠ›æŠŠä»£ç å†™çš„å…·æœ‰è¢«è¯­è¨€æœ¬èº«çš„ç‰¹æ€§ï¼Œçœ‹èµ·æ¥æ›´åŠ ç®€æ´ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">falling</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="s">"""Compute the falling factorial of n to depth k."""</span>
    <span class="n">total</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="n">k</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">stop</span><span class="p">:</span>
        <span class="n">total</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">total</span><span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">return</span> <span class="n">total</span>
</code></pre></div></div>

<h2 id="f20-lecture-4">F20 Lecture 4</h2>

<h3 id="lambda">lambda</h3>

<p>å®šä¹‰ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">search</code>å‡½æ•°ï¼Œæ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„<code class="language-plaintext highlighter-rouge">x</code>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># æ³¨æ„è¿™é‡Œloopè¯­æ³•ç®€æ´
</span>    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<p>ç°åœ¨æˆ‘ä»¬æƒ³è¦åšä¸€ä¸ª<code class="language-plaintext highlighter-rouge">inverse</code>å‡½æ•°ï¼Œä½œä¸ºåå‡½æ•°æ±‚å€¼å™¨ï¼Œè¯¾ä¸Šç»™å‡ºçš„è§£æ³•å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
	<span class="k">return</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span><span class="n">search</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åšå¦‚ä¸‹åˆ†æï¼š</p>

<p>åœ¨<code class="language-plaintext highlighter-rouge">search</code>å‡½æ•°ä¸­ï¼Œ<strong>æ¡ä»¶</strong>è¢«è®¾å®šä¸º<code class="language-plaintext highlighter-rouge">f(x)</code>ï¼›è€Œåœ¨<code class="language-plaintext highlighter-rouge">inverse</code>å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é€šè¿‡ç»™å‡ºçš„å‡½æ•°<code class="language-plaintext highlighter-rouge">f</code>ï¼Œå¯ä»¥å¯¹ä»»æ„<code class="language-plaintext highlighter-rouge">y</code>å€¼è·å–æ»¡è¶³æ¡ä»¶<code class="language-plaintext highlighter-rouge">f(x)==y</code>çš„<code class="language-plaintext highlighter-rouge">x</code>ã€‚</p>

<p>å¦‚æœä½¿ç”¨<code class="language-plaintext highlighter-rouge">lambda</code>æ“ä½œï¼Œå¾ˆæ–¹ä¾¿çš„ä¸€ç‚¹æ˜¯å¯ä»¥å€ŸåŠ©<code class="language-plaintext highlighter-rouge">lambda</code>çš„åŒ¿åç‰¹ç‚¹ï¼Œè¡¨ç¤ºæˆ‘ä»¬éœ€è¦çš„<strong>æ¡ä»¶</strong>ã€‚å› ä¸ºæˆ‘ä»¬è¦æ±‚çš„æ˜¯åå‡½æ•°ä¸­çš„<code class="language-plaintext highlighter-rouge">x</code>ï¼Œä½†æ˜¯åˆéœ€è¦å¼•å…¥æœªçŸ¥æ•°<code class="language-plaintext highlighter-rouge">x</code>ï¼Œæ­¤æ—¶å¦‚æœæ˜¯é€šè¿‡<code class="language-plaintext highlighter-rouge">def</code>çš„å½¢å¼å¼•å…¥å˜é‡<code class="language-plaintext highlighter-rouge">x</code>ï¼Œå°±æ˜¾å¾—å†—ä½™ï¼Œå› ä¸ºåœ¨<code class="language-plaintext highlighter-rouge">search</code>å‡½æ•°å†…éƒ¨è¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬ä¼šçœŸæ­£ç”¨åˆ°çš„<code class="language-plaintext highlighter-rouge">x</code>ï¼Œè€ŒåŒ¿åå‡½æ•°<code class="language-plaintext highlighter-rouge">lambda</code>æ°å¥½è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚åŒæ ·åœ°ï¼Œ<code class="language-plaintext highlighter-rouge">lambda</code>ä¹Ÿå¯ä»¥ç”¨äºå¼•å…¥å‚æ•°<code class="language-plaintext highlighter-rouge">y</code>ã€‚</p>

<p>è€Œå¦‚æœä½¿ç”¨<code class="language-plaintext highlighter-rouge">def</code>çš„å½¢å¼å®šä¹‰å‡½æ•°ï¼Œåˆ™æœ€æ–¹ä¾¿çš„åŠæ³•æ˜¯å…ˆå°†<code class="language-plaintext highlighter-rouge">search</code>å‡½æ•°æ›´æ”¹ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">search</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># æ³¨æ„è¿™é‡Œloopè¯­æ³•ç®€æ´
</span>    
    <span class="k">while</span> <span class="ow">not</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">inverse</code>å‡½æ•°åšå¦‚ä¸‹å®šä¹‰ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">SetY</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SetY</span>
</code></pre></div></div>

<p>å¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸æ›´æ”¹<code class="language-plaintext highlighter-rouge">search</code>å‡½æ•°ï¼Œåˆ™<code class="language-plaintext highlighter-rouge">inverse</code>å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">SetY</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="c1"># å› ä¸ºåªæœ‰åœ¨è¿™ä¸ªframeé‡Œæ‰éœ€è¦ç”¨åˆ°xï¼Œæ‰€ä»¥é€‰æ‹©åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨å®šä¹‰SetXï¼Œå…¶å®æ˜¯å’ŒåŒ¿åå‡½æ•°ä¸€ä¸ªé“ç†
</span>        
        <span class="k">def</span> <span class="nf">SetX</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span>
        <span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="n">SetX</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SetY</span>
</code></pre></div></div>

<p>è¿™é‡Œè¦å­¦ä¹ çš„è¿˜æœ‰ä»ç‰¹ä¾‹åˆ°æŠ½è±¡çš„æ¨å¯¼æ€ç»´ï¼Œè¿™æœ‰åŠ©äºæˆ‘ä»¬å¿«é€Ÿæ„å»ºå‡ºç¨‹åºç»“æ„ã€‚å…ˆä»å¼€å¹³æ–¹æ ¹å‡½æ•°çš„ç‰¹ä¾‹å¼€å§‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># ä¸€ä¸ªå¹³æ–¹æŸ¥æ‰¾å‡½æ•°
</span>
<span class="k">def</span> <span class="nf">is_square_of_4</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">square</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span>
<span class="c1"># ä¸€ä¸ªå¹³æ–¹æ ¹æŸ¥æ‰¾å‡½æ•°
</span>
<span class="k">def</span> <span class="nf">is_sqrt_of_16</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">16</span>
<span class="c1"># åˆ©ç”¨searchå‡½æ•°å¯»æ‰¾xï¼š
</span>
<span class="n">ans</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="n">is_sqrt_of_16</span><span class="p">)</span>
<span class="c1"># æ‰©å……ä½¿ç”¨æ¡ˆä¾‹åˆ°16-&gt;nï¼š
</span>
<span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
	<span class="k">def</span> <span class="nf">is_sqrt_of_n</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    	<span class="k">return</span> <span class="n">square</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="n">is_sqrt_of_n</span><span class="p">)</span>
<span class="c1"># æ‰©å……å¹³æ–¹æ ¹å‡½æ•°ï¼Œè®¾è®¡inverse,ä»å†…å‘å¤–ï¼Œé€å±‚æ·»åŠ ï¼š
</span>
<span class="k">def</span> <span class="nf">inverse</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">is_inverse_of_f</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">is_inverse_of_y</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">y</span>
    	<span class="k">return</span> <span class="n">search</span><span class="p">(</span><span class="n">is_inverse_of_y</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">is_inverse_of_f</span>
</code></pre></div></div>

<p>è°ƒç”¨å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># e.g.
</span>
<span class="n">sqrt</span> <span class="o">=</span> <span class="n">inverse</span><span class="p">(</span><span class="n">square</span><span class="p">)</span>
<span class="n">Ans</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„<strong>256</strong>å°±æ˜¯å‡½æ•°ä¸­çš„<code class="language-plaintext highlighter-rouge">y</code>å‚æ•°ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¦æŠŠ<code class="language-plaintext highlighter-rouge">return</code>å†™åš<code class="language-plaintext highlighter-rouge">lambda y:...</code>çš„åŸå› ï¼Œæˆ‘ä»¬è¦å…ˆç»™åˆ°å‚æ•°<code class="language-plaintext highlighter-rouge">y</code>ã€‚</p>

<h3 id="call-expressionä¸­çš„æ‰§è¡Œé¡ºåº">call expressionä¸­çš„æ‰§è¡Œé¡ºåº</h3>

<p>ä¸ºä»€ä¹ˆä¸ä¼šå‡ºç°<code class="language-plaintext highlighter-rouge">if_(c,t,f)</code>è¿™ç§å½¢å¼ï¼Ÿå› ä¸ºè¿™æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">call expression (which applies a function to some arguments)</code>ï¼Œè€Œæ ¹æ®å¦‚ä¸‹çš„evaluationè§„åˆ™ï¼Œè¿™ç§å‡½æ•°è®¾è®¡å¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ï¼Œæ‰€æœ‰å­è¡¨è¾¾å¼å‡è¦æå‰è¢«æ‰§è¡Œï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210708215753.png" alt="image-20210708215746570" style="zoom:67%;" /></p>

<h2 id="hoghigher-order-function">Hogï¼ˆHigher Order Functionï¼‰</h2>

<h3 id="q8-test">Q8 Test</h3>

<blockquote>
  <p>â€‹     &gt;&gt;&gt; dice = make_test_dice(3, 1, 5, 6)</p>

  <p>â€‹     &gt;&gt;&gt; averaged_roll_dice = make_averaged(roll_dice, 1000)</p>

  <p>â€‹     &gt;&gt;&gt; # Average of calling roll_dice 1000 times</p>

  <p>â€‹     &gt;&gt;&gt; # Enter a float (e.g. 1.0) instead of an integer</p>

  <p>â€‹     &gt;&gt;&gt; averaged_roll_dice(2, dice)</p>
</blockquote>

<p>æœ€ç»ˆçš„ç»“æœä¸º<strong>6.0</strong>ã€‚å…¶ä¸­éƒ¨åˆ†å‡½æ•°å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_test_dice</span><span class="p">(</span><span class="o">*</span><span class="n">outcomes</span><span class="p">):</span>
    <span class="s">"""Return a die that cycles deterministically through OUTCOMES.

    &gt;&gt;&gt; dice = make_test_dice(1, 2, 3)
    &gt;&gt;&gt; dice()
    1
    &gt;&gt;&gt; dice()
    2
    &gt;&gt;&gt; dice()
    3
    &gt;&gt;&gt; dice()
    1
    &gt;&gt;&gt; dice()
    2

    This function uses Python syntax/techniques not yet covered in this course.
    The best way to understand it is by reading the documentation and examples.
    """</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'You must supply outcomes to make_test_dice'</span>
    <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">outcomes</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">o</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">o</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'Outcome is not a positive integer'</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">dice</span><span class="p">():</span>
        <span class="k">nonlocal</span> <span class="n">index</span>
        <span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">outcomes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">outcomes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">dice</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">roll_dice</span><span class="p">(</span><span class="n">num_rolls</span><span class="p">,</span> <span class="n">dice</span><span class="o">=</span><span class="n">six_sided</span><span class="p">):</span>
    <span class="s">"""Simulate rolling the DICE exactly NUM_ROLLS &gt; 0 times. Return the sum of
    the outcomes unless any of the outcomes is 1. In that case, return 1.

    num_rolls:  The number of dice rolls that will be made.
    dice:       A function that simulates a single dice roll outcome.
    """</span>
    <span class="c1"># These assert statements ensure that num_rolls is a positive integer.
</span>    
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">num_rolls</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">,</span> <span class="s">'num_rolls must be an integer.'</span>
    <span class="k">assert</span> <span class="n">num_rolls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s">'Must roll at least once.'</span>
    <span class="n">i</span><span class="p">,</span> <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="n">flag_1</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_rolls</span><span class="p">:</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">dice</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">flag_1</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">sum</span> <span class="o">+=</span> <span class="n">res</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">flag_1</span><span class="p">:</span>
        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">sum</span>
</code></pre></div></div>

<p>è¿™è¦æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æ˜¯<code class="language-plaintext highlighter-rouge">Higher Order Function</code>ï¼Œä»¥åŠä¸€ä¸ª<code class="language-plaintext highlighter-rouge">nonlocal</code>å…³é”®å­—ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªè¦<code class="language-plaintext highlighter-rouge">[f1=make_test_dice]</code>è¿™ä¸ªframeæ²¡æœ‰å˜ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ²¡æœ‰åœ¨å¦ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">[f2=make_test_dice]</code>é‡Œæ“ä½œï¼Œé‚£ä¹ˆæ— è®ºæˆ‘ä»¬æ‰§è¡Œå¤šå°‘æ¬¡<code class="language-plaintext highlighter-rouge">dice(*args)</code>ï¼Œå˜é‡<code class="language-plaintext highlighter-rouge">index</code>çš„å€¼å§‹ç»ˆæ˜¯å¾ªç¯çš„ï¼Œå› ä¸ºæ ¹æ®<code class="language-plaintext highlighter-rouge">environment diagram</code>çš„åŸåˆ™ï¼Œå®ƒçš„ä½œç”¨åŸŸ<code class="language-plaintext highlighter-rouge">f1</code>æ²¡æœ‰æ¶ˆå¤±ã€‚</p>

<h3 id="q7">Q7</h3>

<p>åœ¨Problem 7æä¾›çš„æ ·ä¾‹ä¸­ï¼Œæœ‰å‡ ä¸ªæœ‰è¶£çš„<code class="language-plaintext highlighter-rouge">Higher Order Function</code>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">say_scores</span><span class="p">(</span><span class="n">score0</span><span class="p">,</span> <span class="n">score1</span><span class="p">):</span>
    <span class="s">"""A commentary function that announces the score for each player."""</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s">"Player 0 now has"</span><span class="p">,</span> <span class="n">score0</span><span class="p">,</span> <span class="s">"and Player 1 now has"</span><span class="p">,</span> <span class="n">score1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">say_scores</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">announce_lead_changes</span><span class="p">(</span><span class="n">last_leader</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""Return a commentary function that announces lead changes."""</span>

    <span class="o">&gt;&gt;&gt;</span> <span class="n">f0</span> <span class="o">=</span> <span class="n">announce_lead_changes</span><span class="p">()</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">f1</span> <span class="o">=</span> <span class="n">f0</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Player</span> <span class="mi">0</span> <span class="n">takes</span> <span class="n">the</span> <span class="n">lead</span> <span class="n">by</span> <span class="mi">5</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">f2</span> <span class="o">=</span> <span class="n">f1</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="n">Player</span> <span class="mi">1</span> <span class="n">takes</span> <span class="n">the</span> <span class="n">lead</span> <span class="n">by</span> <span class="mi">7</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">f3</span> <span class="o">=</span> <span class="n">f2</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">f4</span> <span class="o">=</span> <span class="n">f3</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="o">&gt;&gt;&gt;</span> <span class="n">f5</span> <span class="o">=</span> <span class="n">f4</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
    <span class="n">Player</span> <span class="mi">0</span> <span class="n">takes</span> <span class="n">the</span> <span class="n">lead</span> <span class="n">by</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">score0</span><span class="p">,</span> <span class="n">score1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">score0</span> <span class="o">&gt;</span> <span class="n">score1</span><span class="p">:</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">score1</span> <span class="o">&gt;</span> <span class="n">score0</span><span class="p">:</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">leader</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">leader</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">leader</span> <span class="o">!=</span> <span class="n">last_leader</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'Player'</span><span class="p">,</span> <span class="n">leader</span><span class="p">,</span> <span class="s">'takes the lead by'</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">score0</span> <span class="o">-</span> <span class="n">score1</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">announce_lead_changes</span><span class="p">(</span><span class="n">leader</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">say</span>
</code></pre></div></div>

<p>å…¶ä¸­çš„<code class="language-plaintext highlighter-rouge">say</code>å‡½æ•°ï¼Œè¿”å›å€¼ä¸º<code class="language-plaintext highlighter-rouge">announce_lead_changes(leader)</code>ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">call expression</code>ï¼Œæ‰€ä»¥ä¼šé‡æ–°å»ºç«‹ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">environment diagram</code>ï¼Œå…¶ä¸­çš„<code class="language-plaintext highlighter-rouge">formal parameter</code>ç”±åˆšæ‰§è¡Œå®Œæ¯•çš„<code class="language-plaintext highlighter-rouge">say</code>å‡½æ•°ç»™å‡ºï¼Œå¹¶ä½œä¸ºå³å°†æ‰§è¡Œçš„<code class="language-plaintext highlighter-rouge">announce_lead_changes</code>çš„å‚æ•°ï¼Œåˆä¼ å…¥ä»¥å®ƒä¸º<code class="language-plaintext highlighter-rouge">parent</code>çš„<code class="language-plaintext highlighter-rouge">say</code>å‡½æ•°ä¸­ä½¿ç”¨ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">both</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">):</span>
    <span class="s">"""Return a commentary function that says what f says, then what g says."""</span>

    <span class="n">NOTE</span><span class="p">:</span> <span class="n">the</span> <span class="n">following</span> <span class="n">game</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">possible</span> <span class="n">under</span> <span class="n">the</span> <span class="n">rules</span><span class="p">,</span> <span class="n">it</span><span class="s">'s just
    an example for the sake of the doctest

    &gt;&gt;&gt; h0 = both(say_scores, announce_lead_changes())
    &gt;&gt;&gt; h1 = h0(10, 0)
    Player 0 now has 10 and Player 1 now has 0
    Player 0 takes the lead by 10
    &gt;&gt;&gt; h2 = h1(10, 8)
    Player 0 now has 10 and Player 1 now has 8
    &gt;&gt;&gt; h3 = h2(10, 17)
    Player 0 now has 10 and Player 1 now has 17
    Player 1 takes the lead by 7
    
    def say(score0, score1):
        return both(f(score0, score1), g(score0, score1))
    return say
</span></code></pre></div></div>

<p><strong>æ¯å‡½æ•°è¿”å›å­å‡½æ•°çš„åŒæ—¶ï¼Œå­å‡½æ•°è¿”å›æ¯å‡½æ•°</strong>â€“è¿™æ ·åšçš„å¥½å¤„åœ¨äº<strong>ä¸€ç›´è·Ÿéš<code class="language-plaintext highlighter-rouge">leader</code>çš„å˜åŒ–ï¼ŒåŒæ—¶å¯ä»¥è¿ç»­ä½¿ç”¨<code class="language-plaintext highlighter-rouge">(score0,score1)</code>çš„æ ¼å¼</strong>ã€‚åœ¨CS 61Aæä¾›çš„æ–‡æ¡£ä¸­ï¼Œè¡¨æ˜è¿™æ˜¯<code class="language-plaintext highlighter-rouge">commentary function</code>çš„å¸¸ç”¨å†™æ³•ï¼ˆå³åˆ©ç”¨<code class="language-plaintext highlighter-rouge">Higher Order Function</code>ï¼‰.</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210713192015.png" alt="image-20210713192008394" /></p>

<h2 id="disc-02higher-order-function">Disc 02(Higher Order Function)</h2>

<p>ä¸€é“å¾ˆæœ‰è¶£çš„<strong>HOF</strong>é¢˜ç›®ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">y</span> <span class="o">=</span> <span class="s">"y"</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">y</span>

<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">h</span> <span class="o">=</span> <span class="s">"h"</span>
    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">h</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="s">"i"</span>
    <span class="n">y</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">y</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">h</span><span class="p">:</span> <span class="n">y</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">y</span><span class="p">)(</span><span class="n">y</span><span class="p">)</span>
</code></pre></div></div>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210714155901.png" alt="image-20210714155901223" style="zoom: 67%;" /></p>

<p>è¿›è¡Œå˜é‡æŸ¥æ‰¾æ—¶ï¼Œå…ˆåœ¨è¯¥ä½œç”¨åŸŸå†…æŸ¥æ‰¾å¯¹åº”çš„å˜é‡åç§°å’Œå€¼ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œè¿›å…¥å…¶<code class="language-plaintext highlighter-rouge">parent frame</code>ä¸­æŸ¥æ‰¾ï¼Œä¾æ­¤é€’æ¨ã€‚æ‰€ä»¥åœ¨ç¨‹åºæ®µæœ€åè°ƒç”¨<code class="language-plaintext highlighter-rouge">y</code>æ—¶ï¼Œå®ƒæ‰€æŒ‡å‘çš„åº”è¯¥æ˜¯<code class="language-plaintext highlighter-rouge">global frame</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">func y(y)</code>ï¼Œè€Œä¸æ˜¯<code class="language-plaintext highlighter-rouge">func y(y) frame</code>ä¸­çš„\(\lambda(y)\) . ä¸ä¹‹ç›¸åçš„æ˜¯ï¼Œ<code class="language-plaintext highlighter-rouge">return lambda h: y(h)</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">y</code>åˆ™æ˜¯æ¥è‡ªäºæœ¬<code class="language-plaintext highlighter-rouge">frame</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">y = lambda y: y(h)</code>.</p>

<h2 id="f20-lecture-8recursion">F20 Lecture 8ï¼ˆRecursionï¼‰</h2>

<p>ä¸»è¦å›´ç»•<strong>é€’å½’</strong>è¿›è¡Œè®¨è®ºï¼š</p>

<p>é€’å½’çš„ä¸»è¦åŸåˆ™å°±æ˜¯é€šè¿‡å‡½æ•°çš„é€’å½’ï¼Œé€æ­¥å°†åŸå§‹é—®é¢˜è½¬åŒ–ä¸ºæ›´ç®€å•çš„é—®é¢˜ï¼Œæœ€ç»ˆå°†é—®é¢˜å®šä½åˆ°<strong>base case</strong>ä¸Šï¼Œé€’å½’ç»“æŸï¼Œå¹¶ç»™ä¹‹å‰ä½¿ç”¨çš„å‡½æ•°é€ä¸ªæä¾›è¿”å›å€¼ã€‚</p>

<p>é€’å½’çš„ä¾æ®æ˜¯æ•°å­¦å½’çº³æ³•ï¼Œå³åœ¨è¯æ˜ï¼ˆæˆ–è€…è¯´ç»™å‡ºï¼‰<code class="language-plaintext highlighter-rouge">k=1</code>å’Œ<code class="language-plaintext highlighter-rouge">k=n-1</code>çš„è§£æ³•ä¹‹åï¼Œå³å¯è¯æ˜ï¼ˆæ¨æ–­å‡ºï¼‰<code class="language-plaintext highlighter-rouge">k=n</code>çš„æƒ…å†µã€‚<strong>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¾æ®è¿™ä¸€åŸåˆ™éªŒè¯æˆ‘ä»¬å†™å‡ºçš„é€’å½’å‡½æ•°æ˜¯å¦æ­£ç¡®ï¼Œå³åˆ†åˆ«éªŒè¯<code class="language-plaintext highlighter-rouge">k=1</code>çš„æƒ…å†µï¼Œå¹¶å‡å®š<code class="language-plaintext highlighter-rouge">k=n-1</code>çš„æƒ…å†µæ˜¯æ­£ç¡®çš„ï¼Œè§‚å¯Ÿæˆ‘ä¹ˆèƒ½å¦å¾—åˆ°éœ€è¦çš„<code class="language-plaintext highlighter-rouge">k=n</code>çš„ç»“æœã€‚</strong></p>

<p>åœ¨å†™é€’å½’å‡½æ•°æ—¶ï¼Œä¸è¦å°è¯•æ¨å¯¼é€’å½’è¿‡ç¨‹ï¼Œ<strong>å°è¯•ç”¨æŠ½è±¡æ€ç»´å®šä¹‰å‡½æ•°</strong>ã€‚</p>

<h3 id="mutual-recursion">mutual recursion<a id="anchor9"></a></h3>

<p>æ­¤ç§æƒ…å†µé€‚ç”¨äºå•ä¸€é€’å½’å‡½æ•°è§£å†³èµ·æ¥æ¯”è¾ƒç¹çï¼Œæˆ–è€…ä¸é€‚äºè§£å†³çš„é—®é¢˜ï¼š</p>

<p><em>e.g. é“¶è¡Œå¡å·è®¡ç®—é—®é¢˜ï¼š</em></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">sum_digits</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_but_last</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">sum_digits</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">)</span> <span class="o">+</span> <span class="n">last</span>

<span class="k">def</span> <span class="nf">luhn_sum</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_but_last</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="n">luhn_sum_double</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">)</span> <span class="o">+</span> <span class="n">last</span>
    
<span class="k">def</span> <span class="nf">luhn_sum_double</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">all_but_last</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
    <span class="n">last</span> <span class="o">=</span> <span class="n">sum_digits</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">last</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">last</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">luhn_sum</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">)</span><span class="o">+</span><span class="n">last</span>
</code></pre></div></div>

<p>è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">mutual recursion</code>å®è´¨ä¸Šæ˜¯é’ˆå¯¹å¥‡å¶ä¸¤ç§æƒ…å†µçš„è®¨è®ºï¼Œè€Œä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸¤ä¸ªå‡½æ•°åˆå¹¶åˆ°ä¸€ä¸ªå‡½æ•°å†…æ¥å†™ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">luhn_sum</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sum_digits</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_but_last</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">luhn_sum</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">last</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">last</span> <span class="o">=</span> <span class="n">sum_digits</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">last</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">luhn_sum</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">last</span>
</code></pre></div></div>

<p>åªè¦è®¾ç½®ä¸€ä¸ªå¥‡å¶æŒ‡ç¤ºæ ‡å¿—å³å¯ã€‚</p>

<h3 id="trick">trick<a id="anchor3"></a></h3>

<p>é‡åˆ°å¤æ‚çš„é€’å½’é—®é¢˜å¦‚ä½•è§£å†³ï¼Ÿæˆ‘ä»¬è¦è®¾æƒ³åœ¨é—®é¢˜è§£å†³çš„å‰ä¸€æ­¥ä¹ƒè‡³å‰å‡ æ­¥çš„å˜åŒ–ï¼Œæ¯”å¦‚<strong>æ±‰è¯ºå¡”</strong>é—®é¢˜ï¼Œæˆ‘ä»¬æ­£æ˜¯å€ŸåŠ©äºå¯¹<code class="language-plaintext highlighter-rouge">k=n-1</code>çš„æƒ…å†µçš„äº†è§£ï¼Œè¿›è¡Œå‚æ•°å˜æ¢ï¼Œå¹¶å°†<code class="language-plaintext highlighter-rouge">k=n</code>çš„é—®é¢˜æˆåŠŸè½¬åŒ–ä¸ºä¸‰ä¸ªæ­¥éª¤ã€‚å†æ¯”å¦‚è¿™ä¸ªé—®é¢˜ï¼š</p>

<blockquote>
  <p>nä¸ªè‡ªç„¶æ•°ä¸­å–å‡ºrä¸ªæ•°å­—çš„ç»„åˆ</p>
</blockquote>

<p>é¦–å…ˆæˆ‘ä»¬ä¸¾ä¾‹ï¼š654321ï¼Œ6é€‰4ï¼Œæˆ‘ä»¬å¯ä»¥å°†é—®é¢˜åˆ†ä¸ºå¦‚ä¸‹å‡ ç§æƒ…å†µï¼š</p>

<blockquote>
  <ol>
    <li>å›ºå®š6ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»54321è¿™5ä¸ªæ•°å­—ä¸­é€‰3ä¸ªæ•°</li>
    <li>å›ºå®š5ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»4321è¿™4ä¸ªæ•°å­—ä¸­é€‰3ä¸ªæ•°ï¼ˆæ— 6ï¼‰</li>
    <li>å›ºå®š4ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»321è¿™3ä¸ªæ•°å­—ä¸­é€‰3ä¸ªæ•°ï¼ˆæ— 56ï¼‰</li>
  </ol>
</blockquote>

<p>ä¸€å¼€å§‹çš„æ€è·¯æ˜¯æƒ³æŠŠè¿™å››æ­¥å†™æˆé€’å½’ï¼Œä½†æ˜¯å‘ç°å­˜åœ¨é—®é¢˜ï¼šè¿™å‡ æ­¥æ˜¯åˆ†åˆ«ç‹¬ç«‹çš„æ­¥éª¤ï¼Œ<strong>æˆ‘ä»¬æ— æ³•åœ¨é€’å½’ç¨‹åºä¸­å…ˆå›ºå®š6ï¼Œä¹‹ååˆä¸è€ƒè™‘6</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¯èƒ½æŒ‰ç…§æ—¶é—´é¡ºåºå…ˆåå‘ç”Ÿã€‚</p>

<p>äºæ˜¯ï¼Œæˆ‘ä»¬å°†ä¸Šè¾¹çš„<strong>æƒ…å†µ1</strong>çš„åç»­æ­¥éª¤å†™å‡ºæ¥ï¼š</p>

<blockquote>
  <p>å›ºå®š6ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»54321è¿™<strong>5</strong>ä¸ªæ•°å­—ä¸­é€‰<strong>3</strong>ä¸ªæ•°-&gt;å›ºå®š4ï¼ˆå·²æœ‰64ï¼‰ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»5321è¿™<strong>4</strong>ä¸ªæ•°å­—ä¸­é€‰<strong>2</strong>ä¸ªæ•°-&gt;å›ºå®š3ï¼ˆå·²æœ‰456ï¼‰ï¼Œé—®é¢˜è½¬åŒ–ä¸ºä»521è¿™<strong>3</strong>ä¸ªæ•°å­—ä¸­é€‰<strong>1</strong>ä¸ªæ•°â€¦â€¦</p>
</blockquote>

<p>è¿™ä¸ªæ­¥éª¤ï¼Œæ˜¯å¯ä»¥å†™ä½œé€’å½’çš„ï¼äºæ˜¯å‰è¾¹çš„å‡ ç§æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘å†™æˆå¾ªç¯(<code class="language-plaintext highlighter-rouge">iteration</code>).ï¼ˆ<strong>è¿™ä¹Ÿç¬¦åˆå°†é€’å½’å˜æˆä¸€ä¸ªsimpler questionçš„å‡†åˆ™ï¼Œè½¬åŒ–åçš„é—®é¢˜åˆæ˜¯ä¸€ä¸ªå¯ä»¥å†™æˆä¸€ä¸ªæœ‰iterationçš„ï¼Œå¯ä»¥ç»§ç»­åˆ†è§£çš„å­é—®é¢˜â€¦</strong>ï¼‰</p>

<p>äºæ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥æ€è€ƒï¼Œé€’å½’çš„<code class="language-plaintext highlighter-rouge">base case</code>æ˜¯ä»€ä¹ˆï¼Ÿé€šè¿‡ä¸Šè¾¹çš„æ¡ˆä¾‹ï¼Œä¸éš¾å‘ç°æ˜¯<code class="language-plaintext highlighter-rouge">r=1</code>ã€‚åœ¨<code class="language-plaintext highlighter-rouge">base case</code>æ—¶ï¼Œè¦åšä»€ä¹ˆï¼Ÿå°±æ˜¯æŠŠä¹‹å‰å·²ç»è¢«å›ºå®šï¼ˆé€‰æ‹©å¥½çš„ï¼‰æ•°å­—è¾“å‡ºï¼Œ<strong>ä¸ºäº†è¾¾åˆ°è¿™ä¸€ç›®çš„ï¼Œæˆ‘ä»¬å°†ä¹‹å‰éå†è¿‡çš„æ•°å­—ç”¨æ•°å­—ä¿å­˜èµ·æ¥</strong>ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">a</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">list_r_from_n</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">r</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">r</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># ä¿å­˜éå†è¿‡çš„æ•°å­—
</span>        
        <span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
        <span class="c1"># base case:
</span>        
        <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
            <span class="k">print</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="c1"># ä¸å¯ä»¥a.clear()
</span>        
        <span class="k">else</span><span class="p">:</span>
            <span class="n">list_r_from_n</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">r</span>
</code></pre></div></div>

<p>æ³¨æ„åœ¨ä¿å­˜éå†è¿‡çš„æ•°å­—æ—¶ï¼Œä¸è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">a.append(i)</code>å’Œ<code class="language-plaintext highlighter-rouge">a.clear()</code>çš„æ–¹å¼ï¼Œå› ä¸ºæœ€å¤–å±‚çš„å¾ªç¯å¹¶éä»…ä»…ä¼šç»å†<code class="language-plaintext highlighter-rouge">n-r+1</code>æ¬¡ï¼Œç›´æ¥æ¸…ç©ºæ•´ä¸ªåˆ—è¡¨ä¼šå¯¼è‡´æ’åœ¨å‰è¾¹çš„æ•°æ®ç¼ºå¤±ã€‚</p>

<p>æ­¤å¤–ï¼Œé€’å½’ä¹Ÿå¯ä»¥è¿ç”¨åœ¨<code class="language-plaintext highlighter-rouge">higher order function</code>ä¸­ï¼Œå¦‚ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
    	<span class="k">return</span> <span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
    	<span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">repeat</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">return</span> <span class="n">repeat</span>
</code></pre></div></div>

<h3 id="tree-recursion">Tree recursion</h3>

<h4 id="order-of-recursive-calls">Order of Recursive Calls</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210720182400.png" alt="image-20210720182353317" /></p>

<h4 id="tree-recursionåˆ†ææ–¹æ³•">Tree Recursionåˆ†ææ–¹æ³•</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210720182553.png" alt="image-20210720182553555" /></p>

<p>è§£å†³<code class="language-plaintext highlighter-rouge">Tree recursion</code>çš„åŸºæœ¬æ–¹æ³•æ˜¯è¿›è¡Œ<code class="language-plaintext highlighter-rouge">recursive decomposition</code>ï¼Œå°è¯•æ‰¾åˆ°é—®é¢˜æ›´ç®€å•çš„<strong>æ¡ˆä¾‹</strong>ã€‚æ¯”å¦‚<code class="language-plaintext highlighter-rouge">Counting Partitions</code>çš„ä¾‹å­ï¼Œè€ƒè™‘<code class="language-plaintext highlighter-rouge">count_partitions(6,4)</code>å°±å¯ä»¥åˆ†è§£ä¸ºä¸¤ä¸ªå­é—®é¢˜ï¼š</p>

<ol>
  <li><strong>è‡³å°‘æœ‰ä¸€ä¸ª</strong>4-&gt;count_partitions(2,4)</li>
  <li><strong>ä¸ä½¿ç”¨</strong>4-&gt;count_partitions(6,3)</li>
</ol>

<p>ä¹‹åå†å°†ä¾‹å­æ‹“å±•å³å¯ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">with_m</span> <span class="o">=</span> <span class="n">count_partitions</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">m</span><span class="p">,</span><span class="n">m</span><span class="p">)</span>
<span class="n">without_m</span> <span class="o">=</span> <span class="n">count_partitions</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">return</span> <span class="n">with_m</span> <span class="o">+</span> <span class="n">without_m</span>
</code></pre></div></div>

<h4 id="number-selection-problem">Number Selection Problem<a id="anchor5"></a></h4>

<p>ä»ç»™å®šçš„ä¸€ä¸ªé•¿æ•´æ•°ä¸­é€‰å‡ºæ»¡è¶³é¢˜æ„çš„æ•°å­—ç»„åˆï¼Œä¸€èˆ¬ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Tree recursion</code>æ–¹æ³•è§£å†³ï¼š</p>

<p>æ ¹æ®<code class="language-plaintext highlighter-rouge">Tree recursion</code>çš„æ–¹æ³•ï¼Œå¯ä»¥å†™å‡ºé—®é¢˜<a href="#anchor3">trick</a>çš„å¦ä¸€ç§è§£æ³•ï¼š</p>

<h5 id="trick1">trick1</h5>

<blockquote>
  <p>nä¸ªè‡ªç„¶æ•°ä¸­å–å‡ºrä¸ªæ•°å­—çš„ç»„åˆ</p>
</blockquote>

<p>çš„å¦ä¸€ç§è§£æ³•ï¼š</p>

<p>å°†é—®é¢˜<code class="language-plaintext highlighter-rouge">list_r_from_n(6,4)</code>åˆ’åˆ†ä¸ºä¸¤ä¸ªå­é—®é¢˜ï¼š</p>

<ol>
  <li>æ•°å­—ç»„åˆä¸­<strong>ä¸åŒ…å«6</strong>-&gt;list_r_from_n(5,4)</li>
  <li>æ•°å­—ç»„åˆä¸­<strong>è‡³å°‘åŒ…å«ä¸€ä¸ª6</strong>-&gt;list_r_from_n(5,3)</li>
</ol>

<p>å°†ä¾‹å­æ‹“å±•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">list_r_from_n</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># è¿›å…¥elseï¼Œå…ˆæŠŠæ­£åœ¨è®¨è®ºçš„æ•°å›ºå®šä½
</span>        
        <span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">list_r_from_n</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">list_r_from_n</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>

<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span>
</code></pre></div></div>

<p>ç±»ä¼¼çš„ä¾‹å­è¿˜å‡ºç°åœ¨<em>lab04</em>å’Œ<em>disc04</em>å½“ä¸­:</p>

<h5 id="lab-04">Lab 04</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">max_subseq</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="s">"""Return the maximum subsequence of length at most t that can be found in the given number n."""</span>
    
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_but_last</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_subseq</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">last</span><span class="p">,</span> <span class="n">max_subseq</span><span class="p">(</span><span class="n">all_but_last</span><span class="p">,</span> <span class="n">t</span><span class="p">))</span>
</code></pre></div></div>

<p>è¿˜æ˜¯ç”¨ä¹‹å‰çš„æ€è·¯åˆ†æä¸€éé—®é¢˜ï¼š</p>

<p>å‡è®¾nä¸º34521ï¼Œtä¸º3ï¼Œé—®é¢˜å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p>

<ol>
  <li>3ä¸ªæ•°çš„å­åºåˆ—ä¸­ï¼Œä¸ä½¿ç”¨nçš„æœ€åä¸€ä¸ªæ•°å­—ï¼šåˆ™nä¸º3452ï¼Œtä¸º3</li>
  <li>3ä¸ªæ•°çš„å­åºåˆ—ä¸­ï¼Œä½¿ç”¨nçš„æœ€åä¸€ä¸ªæ•°å­—ï¼šåˆ™nä¸º3452ï¼Œtä¸º2ï¼Œä¹‹åä½¿ç”¨<code class="language-plaintext highlighter-rouge">10*n+d</code>çš„æ–¹æ³•å°†æœ«ä½å›ºå®šä½ï¼Œè¿™é‡Œç›¸å½“äºå‡è®¾<code class="language-plaintext highlighter-rouge">max_subseq(all_but_last,t-1)</code>ä¼šè¿”å›æ­£ç¡®çš„ä¸œè¥¿ï¼ˆ<strong>æ•°å­¦å½’çº³æ³•</strong>ï¼‰</li>
</ol>

<p>å°†1ä¸2å¾—åˆ°çš„æ•°å­—æ¯”è¾ƒå¤§å°</p>

<h5 id="ç”¨yieldå¦‚ä½•è§£å†³number-selection-problem">ç”¨yieldå¦‚ä½•è§£å†³Number Selection Problemï¼Ÿ<a id="anchor10"></a></h5>

<blockquote>
  <p>æœ¬é¢˜ç›®æ¥è‡ªäºspring 2020 midterm2</p>
</blockquote>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161737580.png" alt="image-20210816173745505" style="zoom:50%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161738434.png" alt="image-20210816173812366" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">curry2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">powers</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="s">"""Yield all powers of k whose digits appear in order in n."""</span>
    <span class="k">def</span> <span class="nf">build</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
        <span class="s">"""Yield all non-negative integers whose digits appear in order in seed.
        0 is yielded because 0 has no digits, so all its digits are in seed.
        """</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">build</span><span class="p">(</span><span class="n">seed</span> <span class="o">//</span> <span class="mi">10</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">x</span>
                <span class="k">yield</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">seed</span> <span class="o">%</span> <span class="mi">10</span>
    <span class="k">yield</span> <span class="k">from</span> <span class="nb">filter</span><span class="p">(</span><span class="n">curry2</span><span class="p">(</span><span class="n">is_power</span><span class="p">)(</span><span class="n">k</span><span class="p">),</span> <span class="n">build</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</code></pre></div></div>

<p>è¿™é“é¢˜ç›®çš„æ€»ä½“æ€è·¯æ˜¯å…ˆæŠŠæ‰€æœ‰æ•°å­—ç»„åˆæ’åˆ—å‡ºæ¥ï¼Œä¹‹åå†åˆ©ç”¨å…ˆå‰å®ç°çš„<code class="language-plaintext highlighter-rouge">is_power</code>å‡½æ•°æŠŠç¬¦åˆé¢˜æ„çš„æ•°å­—ç»„åˆç­›é€‰å‡ºæ¥ã€‚æ³¨æ„åˆ°åœ¨<code class="language-plaintext highlighter-rouge">build</code>å‡½æ•°å†…éƒ¨çš„æ•°å­—ç»„åˆæ–¹æ³•ï¼Œä¸ä¸Šè¾¹çš„<code class="language-plaintext highlighter-rouge">lab 04</code>ååˆ†ç›¸ä¼¼ï¼Œå…¶å®ä¹Ÿæ˜¯å‡å®šï¼ˆ<strong>æ•°å­¦å½’çº³æ³•</strong>ï¼‰<code class="language-plaintext highlighter-rouge">build(seed//10)</code>è¿™ä¸ªæ›´ç®€å•çš„é€’å½’é—®é¢˜è¿”å›æ­£ç¡®çš„æ•°å­—ç»„åˆï¼Œä¹‹åæŠŠæœ«å°¾æ•°å­—è€ƒè™‘è¿›å»ã€‚</p>

<h5 id="disc-04">disc 04</h5>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210725151724.png" alt="image-20210725151723769" style="zoom: 50%;" /></p>

<p>æˆ–è€…ï¼Œå½“é—®é¢˜ä¸å†èƒ½ç®€å•çš„äºŒåˆ†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¾ªç¯çš„æ–¹å¼ç»Ÿè®¡æ‰€æœ‰å¯èƒ½æ€§ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210725162045.png" alt="image-20210725162045374" style="zoom:50%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210725162056.png" alt="image-20210725162056225" style="zoom:50%;" /></p>

<h5 id="sp18-final-5-b">sp18-final 5 (b)</h5>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109030236777.png" alt="image-20210903023625650" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜çš„å…³é”®åœ¨äºè¦é¦–å…ˆå‘ç°æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Tree Recursion</code>çš„é—®é¢˜ï¼Œå½“<code class="language-plaintext highlighter-rouge">k</code>ä¸ºå› æ•°æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨æˆ–è€…ä¸ä½¿ç”¨ï¼Œä»è€Œå¯¹åº”äº†<code class="language-plaintext highlighter-rouge">Tree Recursion</code>çš„ä¸¤ç§æƒ…å†µï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">%</span> <span class="n">k</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">factorize</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">factorize</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)])</span>
</code></pre></div></div>

<h5 id="summer-2020-practice-mt-q3">Summer 2020 Practice mt Q3<a id="anchor14"></a></h5>

<p>è¿™æ˜¯ä¸€é“æ›´ä¸ºå¤æ‚çš„<code class="language-plaintext highlighter-rouge">Number selection Problem</code>ï¼Œé¢˜ç›®è¦æ±‚å¦‚ä¸‹ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108181326255.png" alt="image-20210818132652753" style="zoom:50%;" /></p>

<p>æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªæ›´ç®€å•çš„<code class="language-plaintext highlighter-rouge">Number selection Problem</code>å…¥æ‰‹ï¼Œå³çœç•¥æ‰ä¸Šé¢é¢˜ç›®ä¸­æ•°å­—é€’å¢é¡ºåºå¯ä»¥ä»<code class="language-plaintext highlighter-rouge">i+2</code>ä½å¼€å§‹çš„è¦æ±‚ï¼Œè¦æ±‚å…¨éƒ¨é€’å¢ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥å®Œæˆå¦‚ä¸‹çš„å‡½æ•°è®¾è®¡ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">increasing</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">smallest</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># æ„å‘³ç€å¯ä»¥ä½¿ç”¨å½“å‰çš„æœ«ä½æ•°å­—
</span>    
    <span class="n">no</span> <span class="o">=</span> <span class="n">increasing</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">smallest</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="n">smallest</span><span class="p">:</span>
        <span class="c1"># ç°åœ¨æœ€å°çš„æ•°å­—å˜æˆäº†n%10
</span>        
        <span class="n">yes</span> <span class="o">=</span> <span class="n">increasing</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">no</span><span class="p">,</span> <span class="n">yes</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">no</span>
</code></pre></div></div>

<p>é‚£ä¹ˆåœ¨æ­¤é¢˜ä¸­ï¼Œå› ä¸ºé€’å¢æ•°å­—åºåˆ—ä¸­é—´å¯ä»¥é—´éš”ä¸€ä¸ªæ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬æ€è€ƒæ˜¯å¦æœ‰åŠæ³•å°†æœ€å°å€¼çš„æ¯”è¾ƒå’Œç¡®å®šæ»åä¸€ä½ï¼Œä½¿å¾—<code class="language-plaintext highlighter-rouge">smallest</code>ä»£è¡¨éš”ä¸€ä½æ•°å­—åçš„æœ€å°å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬é¢å¯¹<code class="language-plaintext highlighter-rouge">435</code>æ—¶ï¼Œå¦‚æœè¦æ’å…¥<code class="language-plaintext highlighter-rouge">4</code>ï¼Œæ­¤æ—¶æˆ‘ä»¬æƒ³è¦æ¯”è¾ƒçš„å¯¹è±¡ï¼ˆåä¹‰æœ€å°å€¼ï¼‰ä¸º<code class="language-plaintext highlighter-rouge">5</code>ï¼Œè€Œéå‰ä¸€æ­¥åˆšåŠ å…¥çš„<code class="language-plaintext highlighter-rouge">3</code>ã€‚æ‰€ä»¥é¢˜ç›®å°è¯•åŠ å…¥ä¸€ä¸ªå‚æ•°<code class="language-plaintext highlighter-rouge">d</code>ï¼Œç”¨ä»¥ä¿å­˜å½“å‰è½®æ¬¡çš„æœ«å°¾æ•°å­—ï¼Œå¹¶å°†è¯¥æœ«ä½æ•°å­—<code class="language-plaintext highlighter-rouge">d</code><strong>åœ¨ä¸‹ä¸€è½®åŠ å…¥æœ€å°å€¼<code class="language-plaintext highlighter-rouge">smallest</code>çš„æ¯”è¾ƒ</strong>ã€‚è¿™æ ·ä¸€æ¥ï¼Œ<code class="language-plaintext highlighter-rouge">smallest</code>ä¸­å­˜å‚¨çš„å°±æ˜¯éš”ä¸€ä½ä¹‹åçš„æ•°å­—æœ€å°å€¼äº†ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cloase</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">smallest</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">d</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="n">no</span> <span class="o">=</span> <span class="n">close</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">smallest</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">&lt;</span> <span class="n">smallest</span><span class="p">:</span>
        <span class="n">yes</span> <span class="o">=</span> <span class="n">close</span><span class="p">(</span><span class="n">n</span> <span class="o">//</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">smallest</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">10</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">yes</span><span class="p">,</span> <span class="n">no</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">no</span>
</code></pre></div></div>

<blockquote>
  <p>é•¿åº¦æœ€é•¿çš„æ•°å­—ï¼Œä¹Ÿå°±æ„å‘³ç€æ•°å€¼æœ€å¤§çš„æ•°å­—ï¼Œåœ¨è§£æ³•ä¸­ï¼Œè¿ç”¨äº†è¿™ä¸ªå…³ç³»</p>
</blockquote>

<h2 id="hw2-recursionhigher--order--function">HW2 (Recursion+Higher  Order  Function)<a id="anchor6"></a></h2>

<p>åœ¨å¯¹åº”çš„<strong>HW</strong>ä¸­ï¼Œç»™å‡ºäº†å°†<code class="language-plaintext highlighter-rouge">Tree Recursion</code>ä¸<code class="language-plaintext highlighter-rouge">Higher Order Function</code>ç›¸ç»“åˆçš„ä¾‹å­.</p>

<p>åŒæ—¶æ³¨æ„åœ¨ä½¿ç”¨é€’å½’æ—¶ï¼Œå¦‚æœæˆ‘ä»¬æœ‰å¤šä¸ªæ•°æ®éœ€è¦è¿½è¸ªï¼Œå¯ä»¥å†™ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">helper</code>å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count_coins</span><span class="p">(</span><span class="n">total</span><span class="p">):</span>
    <span class="s">"""Return the number of ways to make change for total using coins of value of 1"""</span>
    
    <span class="k">def</span> <span class="nf">count_helper</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">count_helper</span><span class="p">(</span><span class="n">total</span> <span class="o">-</span> <span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span> <span class="o">+</span> <span class="n">count_helper</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">next_largest_coin</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">count_helper</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™ä¹Ÿæ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">tree recursion</code>é—®é¢˜ï¼Œæ ¹æ®å¤„ç†è¿™ç±»é—®é¢˜çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°è¯•å¯»æ‰¾ä¸€ä¸ªæ ‡å‡†ï¼Œå°†é—®é¢˜åˆ†ä¸ºå‡ ä¸ªæ›´ç®€å•çš„<code class="language-plaintext highlighter-rouge">instance</code>ã€‚ä¾é <code class="language-plaintext highlighter-rouge">helper</code>å‡½æ•°ï¼Œé—®é¢˜è½¬åŒ–ä¸ºï¼š</p>

<ol>
  <li>ä¸ç”¨å½“å‰æœ€å°é¢å€¼ç¡¬å¸1ï¼Œåˆ™é—®é¢˜è½¬åŒ–ä¸ºä½¿ç”¨æœ€å°é¢å€¼ç¡¬å¸<code class="language-plaintext highlighter-rouge">next_largest_coin(1)</code>ï¼Œå‡‘é½æ€»ä»·å€¼<code class="language-plaintext highlighter-rouge">total</code></li>
  <li>è‡³å°‘ä½¿ç”¨ä¸€ä¸ªé¢å€¼ä¸º1çš„ç¡¬å¸ï¼Œåˆ™é—®é¢˜è½¬åŒ–ä¸ºä½¿ç”¨æœ€å°é¢å€¼ç¡¬å¸1ï¼Œå‡‘é½æ€»ä»·å€¼ä¸º<code class="language-plaintext highlighter-rouge">total-1</code></li>
</ol>

<p>æˆ‘ä»¬å°†åˆ†æå†™æˆå‡½æ•°ï¼Œå°±æ˜¯ä¸Šè¾¹çš„å½¢å¼ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pingpong</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""Return the nth element of the ping-pong sequence."""</span>
    
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pingpong</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">helper</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># å†³å®šæ˜¯è¦+1è¿˜æ˜¯-1
</span>
<span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">8</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">num_eights</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">helper</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">helper</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">lambda</code>å‡½æ•°ï¼Œåœ¨ä¸ç»™å‡ºå‡½æ•°åçš„æƒ…å†µä¸‹å®šä¹‰é€’å½’ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">fact</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">mul</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">fact</span><span class="p">(</span><span class="n">sub</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fact</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="mi">120</span>

<span class="k">def</span> <span class="nf">make_anonymous_factorial</span><span class="p">():</span>
    <span class="s">"""Return the value of an expression that computes factorial."""</span>
    
    <span class="k">return</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">f</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">n</span><span class="p">))(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">))))</span>
</code></pre></div></div>

<p><strong>è¿™é‡Œç†è§£çš„ç‚¹åœ¨äºï¼Œé€’å½’çš„è¿‡ç¨‹å®è´¨ä¸Šæ˜¯æŠŠå‡½æ•°æœ¬èº«ä¹Ÿä½œä¸ºäº†å‡½æ•°çš„å‚æ•°ï¼Œåœ¨å‡½æ•°å†…éƒ¨è°ƒç”¨äº†å‡½æ•°è‡ªå·±.</strong></p>

<h2 id="f20-lecture-10list">F20 Lecture 10(List)</h2>

<ol>
  <li>listçš„concatenation &amp; repetition</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># å°†åŸæ¥çš„æ‰€æœ‰å…ƒç´ é‡å¤ä¸€éå¹¶åŠ ä¸Š[2,7]å…ƒç´ 
</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span><span class="o">+</span><span class="n">lists</span><span class="o">*</span><span class="mi">2</span>
</code></pre></div></div>

<ol>
  <li>Sequence Unpacking</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pairs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">:</span>
<span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span>
	<span class="p">...</span>
</code></pre></div></div>

<ol>
  <li>list constructor</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="list--string-åœ¨tree-recursionä¸­çš„ä½¿ç”¨">List / String åœ¨Tree Recursionä¸­çš„ä½¿ç”¨<a id="anchor8"></a></h3>

<h4 id="cats">cats</h4>

<blockquote>
  <h3 id="problem-7-3-pt">Problem 7 (3 pt)</h3>

  <p>Implement <code class="language-plaintext highlighter-rouge">pawssible_patches</code>, which is a diff function that returns the minimum number of edit operations needed to transform the <code class="language-plaintext highlighter-rouge">start</code> word into the <code class="language-plaintext highlighter-rouge">goal</code> word.</p>

  <p>There are three kinds of edit operations:</p>

  <ol>
    <li>Add a letter to <code class="language-plaintext highlighter-rouge">start</code>,</li>
    <li>Remove a letter from <code class="language-plaintext highlighter-rouge">start</code>,</li>
    <li>Substitute a letter in <code class="language-plaintext highlighter-rouge">start</code> for another.</li>
  </ol>

  <p>Each edit operation contributes 1 to the difference between two words.</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">big_limit</span> <span class="o">=</span> <span class="mi">10</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="s">"cats"</span><span class="p">,</span> <span class="s">"scat"</span><span class="p">,</span> <span class="n">big_limit</span><span class="p">)</span>       <span class="c1"># cats -&gt; scats -&gt; scat
</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="s">"purng"</span><span class="p">,</span> <span class="s">"purring"</span><span class="p">,</span> <span class="n">big_limit</span><span class="p">)</span>   <span class="c1"># purng -&gt; purrng -&gt; purring
</span>
<span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="s">"ckiteus"</span><span class="p">,</span> <span class="s">"kittens"</span><span class="p">,</span> <span class="n">big_limit</span><span class="p">)</span> <span class="c1"># ckiteus -&gt; kiteus -&gt; kitteus -&gt; kittens
</span>
<span class="mi">3</span>
</code></pre></div>  </div>

  <p>We have provided a template of an implementation in <code class="language-plaintext highlighter-rouge">cats.py</code>. This is a recursive function with three recursive calls. One of these recursive calls will be similar to the recursive call in <code class="language-plaintext highlighter-rouge">shifty_shifts</code>.</p>

  <p>You may modify the template however you want or delete it entirely.</p>

  <p>If the number of edits required is greater than <code class="language-plaintext highlighter-rouge">limit</code>, then <code class="language-plaintext highlighter-rouge">pawssible_patches</code> should return any number larger than <code class="language-plaintext highlighter-rouge">limit</code> and should minimize the amount of computation needed to do so.</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">2</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="s">"ckiteus"</span><span class="p">,</span> <span class="s">"kittens"</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span>
<span class="bp">True</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="s">"ckiteusabcdefghijklm"</span><span class="p">,</span> <span class="s">"kittensnopqrstuvwxyz"</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit</span>
<span class="bp">True</span>
</code></pre></div>  </div>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pawssible_patches</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span> <span class="n">limit</span><span class="p">):</span>
    <span class="s">"""A diff function that computes the edit distance from START to GOAL."""</span>

    <span class="k">if</span> <span class="n">limit</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">goal</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">limit</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">add_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
        <span class="n">remove_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
        <span class="n">substitute_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">add_diff</span><span class="p">,</span> <span class="n">remove_diff</span><span class="p">,</span> <span class="n">substitute_diff</span><span class="p">)</span>
</code></pre></div></div>

<p>å¯¹äºè¿™é“é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ç±»æ¯”ä¹‹å‰çš„<code class="language-plaintext highlighter-rouge">Tree Recursion</code>é€’å½’é—®é¢˜ï¼Œæ€è€ƒå¦‚ä½•æŠŠé—®é¢˜æŠ½è±¡åŒ–ï¼š</p>

<p>å¯¹äºæ¯ä¸€ä¸ªä½ç½®çš„å­—ç¬¦å¯¹æ¯”ï¼Œéƒ½æœ‰å¢åˆ æ”¹ä¸‰ç§æ“ä½œï¼Œå¯ä»¥è”æƒ³ä¹‹å‰çˆ¬æ¥¼æ¢¯çš„é—®é¢˜ï¼šæ¯ä¸€æ­¥éƒ½æœ‰ä¸Š1çº§å°é˜¶æˆ–è€…2çº§å°é˜¶è¿™ä¸¤ç§æƒ…å†µï¼Œåªæ˜¯åœ¨è¿™é‡Œï¼Œå¢åˆ æ”¹è¿™ä¸‰ç§æ“ä½œä¸ç®€å•çš„æ˜¯<code class="language-plaintext highlighter-rouge">f(n-1)</code>è¿™ç§å½¢å¼ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±å®ç°å®ƒã€‚æ‰€ä»¥ç°åœ¨åŸºæœ¬å¯ä»¥ç¡®å®šï¼Œé€’å½’ä¼šä½œç”¨åœ¨å®ç°å¢åˆ æ”¹è¿™ä¸‰ç§æ“ä½œä¸Šï¼Œæ¥ä¸‹æ¥è¦å®Œå–„å‡½æ•°è®¾è®¡ï¼Œå°±è¦æ€è€ƒå¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p>

<ul>
  <li>base caseæ˜¯ä»€ä¹ˆï¼Ÿ</li>
</ul>

<p>é¦–å…ˆåˆ¨é™¤<code class="language-plaintext highlighter-rouge">limit</code>è¿™ä¸ªå˜é‡ä¸ç®¡ï¼Œæ˜¾ç„¶åœ¨æˆ‘ä»¬åœ¨é€’å½’è‡³å­—ç¬¦ä¸²<code class="language-plaintext highlighter-rouge">start</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">goal</code>ä»»æ„ä¸€ä¸ªä¸ºç©ºå­—ç¬¦ä¸²æ—¶ï¼Œé€’å½’åœæ­¢ï¼Œå¹¶è¿”å›å¦ä¸€å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆåŠéœ€è¦è¿›è¡Œæ”¹å˜çš„æ¬¡æ•°ï¼‰</p>

<ul>
  <li>å¦‚ä½•è¿›è¡Œ<code class="language-plaintext highlighter-rouge">recursion decomposition</code>?</li>
</ul>

<p>èµ·ç‚¹å¾ˆç®€å•ï¼Œä¸€å®šæ˜¯å­—ç¬¦ä¸²å¼€å¤´çš„é¦–å­—æ¯ï¼Œæ‰€ä»¥å¯ä»¥åˆ†ä¸ºé¦–å­—æ¯ç›¸åŒä¸é¦–å­—æ¯ä¸åŒä¸¤ç§æƒ…å†µï¼Œå¦‚æœé¦–å­—æ¯ç›¸åŒï¼Œå°±ä¸éœ€è¦åˆ©ç”¨å¢åˆ æ”¹ä¸‰è€…å½“ä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸ª<code class="language-plaintext highlighter-rouge">simpler instance</code>å¯ä»¥å†™ä½œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">elif</span> <span class="n">start</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
	<span class="k">return</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span><span class="n">limit</span><span class="p">)</span>
</code></pre></div></div>

<p>å¦‚æœé¦–å­—æ¯ä¸ç›¸åŒï¼Œè¿™æ—¶å€™å°±éœ€è¦è¿›è¡Œå¢åˆ æ”¹çš„æ“ä½œï¼Œä½†è¦æ³¨æ„ï¼Œæˆ‘ä»¬å°†<code class="language-plaintext highlighter-rouge">goal</code>çš„é¦–ä½é€’æ¨çš„ä»»åŠ¡äº¤ç»™ä¸¤è€…ç›¸åŒçš„æƒ…å†µï¼Œä»¥å…å‘ç”Ÿé”™è¯¯ã€‚åªè¦è¿›è¡Œäº†ä¸€æ¬¡æ›´æ”¹æ“ä½œï¼Œæ¬¡æ•°è¦åŠ 1ï¼Œæ‰€åˆå› ä¸ºé¢˜ç›®è¦æ±‚è®¡ç®—æœ€å°æ›´æ”¹æ¬¡æ•°ï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡ï¼Œæˆ‘ä»¬éƒ½é€‰å–è¿™ä¸‰ç§æ“ä½œé‡Œéœ€è¦æ¬¡æ•°æœ€å°‘çš„é‚£ä¸€ä¸ªå¹¶éšä¹‹é€’å½’ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span><span class="p">:</span>
    <span class="n">limit</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="n">add_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">,</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">remove_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">substitute_diff</span> <span class="o">=</span> <span class="n">pawssible_patches</span><span class="p">(</span><span class="n">goal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">start</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">goal</span><span class="p">,</span><span class="n">limit</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">add_diff</span><span class="p">,</span> <span class="n">remove_diff</span><span class="p">,</span> <span class="n">substitute_diff</span><span class="p">)</span>
</code></pre></div></div>

<p>æœ€åï¼Œä¸ºäº†æé«˜ç¨‹åºè¿è¡Œçš„æ•ˆç‡ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—ä½•æ—¶è¾¾åˆ°<code class="language-plaintext highlighter-rouge">limit</code>ï¼Œäºæ˜¯åœ¨æ¯ä¸€æ¬¡æ›´æ”¹ä¹‹åï¼Œéƒ½å°†<code class="language-plaintext highlighter-rouge">limit</code>å‡å°1ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">limit</code>è¾¾åˆ°0æ—¶ï¼Œåœæ­¢é€’å½’ã€‚</p>

<h4 id="lab-14-q6">Lab 14 Q6</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109030253833.png" alt="image-20210903025336665" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜é¢˜ç›®å¾ˆé•¿ï¼Œä½†æ˜¯ç»™å‡ºäº†ä¸å°‘çš„<code class="language-plaintext highlighter-rouge">template</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç›´æ¥æŠ›å¼ƒ<code class="language-plaintext highlighter-rouge">template</code>ï¼Œçœ‹æ•´ä½“çš„å®ç°æ€è·¯æ˜¯æ€æ ·çš„ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">align_skeleton</span><span class="p">(</span><span class="n">skeleton</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
    <span class="s">"""Aligns the given skeleton with the given code, minimizing the edit distance between the two."""</span>
    <span class="n">skeleton</span><span class="p">,</span> <span class="n">code</span> <span class="o">=</span> <span class="n">skeleton</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">),</span> <span class="n">code</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">" "</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span><span class="p">,</span> <span class="n">code_idx</span><span class="p">):</span>
        <span class="s">"""
        Aligns the given skeletal segment with the code.
        Returns (match, cost)
            match: the sequence of corrections as a string
            cost: the cost of the corrections, in edits
        """</span>
        <span class="c1"># ä½äºæœ«å°¾ä¸”åŒ¹é…
</span>        
        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">''</span><span class="p">,</span> <span class="mi">0</span>
        <span class="c1"># ä½äºæœ«å°¾ä¸”éœ€è¦åˆ é™¤
</span>        
        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
            <span class="n">edits</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="s">"-["</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s">"]"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">skeleton</span><span class="p">[</span><span class="n">skeleton_idx</span><span class="p">:]])</span>
            <span class="k">return</span> <span class="n">edits</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="o">-</span> <span class="n">skeleton_idx</span>
        <span class="c1"># ä½äºæœ«å°¾ä¸”éœ€è¦å¢åŠ 
</span>        
        <span class="k">if</span> <span class="n">skeleton_idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">skeleton</span><span class="p">)</span> <span class="ow">and</span> <span class="n">code_idx</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
            <span class="n">edits</span> <span class="o">=</span> <span class="s">""</span><span class="p">.</span><span class="n">join</span><span class="p">([</span><span class="s">"+["</span> <span class="o">+</span> <span class="n">c</span> <span class="o">+</span> <span class="s">"]"</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">code</span><span class="p">[</span><span class="n">code_idx</span><span class="p">:]])</span>
            <span class="k">return</span> <span class="n">edits</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">code</span><span class="p">)</span> <span class="o">-</span> <span class="n">code_idx</span>

        <span class="n">possibilities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">skel_char</span><span class="p">,</span> <span class="n">code_char</span> <span class="o">=</span> <span class="n">skeleton</span><span class="p">[</span><span class="n">skeleton_idx</span><span class="p">],</span> <span class="n">code</span><span class="p">[</span><span class="n">code_idx</span><span class="p">]</span>
        <span class="c1"># Match
</span>        
        <span class="k">if</span> <span class="n">skel_char</span> <span class="o">==</span> <span class="n">code_char</span><span class="p">:</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">code_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">new_result</span> <span class="o">=</span> <span class="n">skel_char</span> <span class="o">+</span> <span class="n">result</span>
            <span class="n">possibilities</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_result</span><span class="p">,</span> <span class="n">cost</span><span class="p">))</span>
        <span class="c1"># Insert
</span>        
        <span class="n">result1</span><span class="p">,</span> <span class="n">cost1</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span><span class="p">,</span> <span class="n">code_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">new_result1</span> <span class="o">=</span> <span class="s">"+["</span> <span class="o">+</span> <span class="n">code_char</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="n">result1</span>
        <span class="n">possibilities</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_result1</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cost1</span><span class="p">))</span>
        <span class="c1"># Delete
</span>        
        <span class="n">result2</span><span class="p">,</span> <span class="n">cost2</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="n">skeleton_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">code_idx</span><span class="p">)</span>
        <span class="n">new_result2</span> <span class="o">=</span> <span class="s">"-["</span> <span class="o">+</span> <span class="n">skel_char</span> <span class="o">+</span> <span class="s">"]"</span> <span class="o">+</span> <span class="n">result2</span>
        <span class="n">possibilities</span><span class="p">.</span><span class="n">append</span><span class="p">((</span><span class="n">new_result2</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">cost2</span><span class="p">))</span>
        <span class="c1"># è¿”å›æ“ä½œæ¬¡æ•°æœ€å°‘çš„æƒ…å†µ
</span>        
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">possibilities</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">result</span><span class="p">,</span> <span class="n">cost</span> <span class="o">=</span> <span class="n">helper_align</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<p>åœ¨é¢˜ç›®çš„å™è¿°ä¸­ï¼Œå…¶å®å·²ç»ç»™å‡ºäº†ä¸å°‘æç¤ºï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p>

<ol>
  <li>å½“ä¸€ä¸ªåºåˆ—è¾¾åˆ°æœ«å°¾ï¼Œä½†æ˜¯å¦ä¸€ä¸ªæ²¡æœ‰æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›å¯¹åº”çš„ç¼–è¾‘æ“ä½œä»¥åŠ<strong>é•¿åº¦</strong>ï¼Œä½†æ˜¯æ³¨æ„è¿™é‡Œçš„<strong>é•¿åº¦</strong>å¹¶é<code class="language-plaintext highlighter-rouge">len(edits)</code>ï¼Œè€Œæ˜¯ä½™ä¸‹çš„åŸåºåˆ—çš„å­—ç¬¦é•¿åº¦ï¼Œä¸åŒ…æ‹¬å¢åŠ çš„<code class="language-plaintext highlighter-rouge">[]</code>ç­‰ã€‚</li>
  <li>åœ¨è€ƒè™‘äº†ä¸‰ç§<code class="language-plaintext highlighter-rouge">base case</code>ä¹‹åï¼Œæ˜¯é€’å½’çš„ä¸»ä½“éƒ¨åˆ†ã€‚åœ¨åŸé¢˜ç›®ç»™å‡ºçš„<code class="language-plaintext highlighter-rouge">template</code>ä¸­æœ‰ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">possibilities</code>ï¼Œ<strong>æˆ‘ä»¬åº”å½“é¦–å…ˆæ€è€ƒè¿™ä¸ªæ•°ç»„çš„ä½œç”¨ï¼Œæˆ–è€…è¯´å½“è‡ªå·±è§£é¢˜æ—¶ï¼Œä¹Ÿè¦å€ŸåŠ©äºè¿™ç§æ–¹æ³•å®ç°æ­¤ç±»é—®é¢˜ï¼šåˆ©ç”¨è¯¥æ•°ç»„å¾—åˆ°å½“å‰æŸä¸€æ­¥(æ¯”å¦‚ç¬¬(n-1)æ­¥)æ‰€æœ‰çš„æ“ä½œåºåˆ—ï¼Œå¹¶å¯¹åº”çš„æ“ä½œæ•°æœ€å°‘çš„é‚£ç§ï¼Œä¼ é€’ç»™éœ€è¦å¤„ç†çš„ç¬¬nä¸ªå­—ç¬¦</strong>ã€‚ä¸€èˆ¬è¿™ç§æ“ä½œéƒ½æ˜¯å…ˆæŠŠæ‰€æœ‰æƒ…å†µå­˜å‚¨èµ·æ¥ï¼ˆ<code class="language-plaintext highlighter-rouge">Delete/Insert</code>ï¼‰ï¼Œæœ€ååœ¨<code class="language-plaintext highlighter-rouge">return</code>å¤„ä½¿ç”¨<code class="language-plaintext highlighter-rouge">min/max</code>è¿›è¡Œé€‰æ‹©ã€‚</li>
  <li>å½“æ—¶åœ¨è§£è¿™é“é¢˜æ—¶ï¼Œä¸»è¦å¡åœ¨äº†<code class="language-plaintext highlighter-rouge">Match</code>çš„æƒ…å†µï¼ŒåŸæœ¬æƒ³å¯¹ä¸¤ä¸ª<code class="language-plaintext highlighter-rouge">flag</code>åˆ†åˆ«å¢åŠ ï¼Œä½†æ˜¯å‘ç°è¿™æ ·å¤„ç†ä¹‹å<code class="language-plaintext highlighter-rouge">insert/Delete</code>çš„æƒ…å†µå¯èƒ½ä¼šå‡ºç°æº¢å‡ºï¼Œæ‰€ä»¥æ¢ä¸€ç§æ€è·¯ï¼š<strong>ç›´æ¥åœ¨<code class="language-plaintext highlighter-rouge">Match</code>å†…éƒ¨é€’å½’ä¸€æ¬¡å‡½æ•°ï¼ŒæŠŠ<code class="language-plaintext highlighter-rouge">flag</code>çš„å¢åŠ ç›´æ¥ä½“ç°åœ¨å‡½æ•°å‚æ•°ä¸Š</strong></li>
</ol>

<h4 id="f20-lecture-21-qa">F20 Lecture 21 Q&amp;A</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108101626258.png" alt="image-20210810162623125" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="c1"># base case 1:
</span>    
    <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s">''</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># base case 2:
</span>    
    <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">ms</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="c1"># recursive case, make sure that at least 1 char at the front and the end:
</span>    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">first</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="n">s</span><span class="p">[:</span><span class="n">k</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">k</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">rest</span> <span class="ow">in</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">suffix</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
                <span class="n">ms</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="s">' '</span> <span class="o">+</span> <span class="n">rest</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ms</span>
</code></pre></div></div>

<h4 id="lab-09">lab 09</h4>

<h5 id="subseqs--inc_subseqs">subseqs &amp; inc_subseqs<a id="anchor15"></a></h5>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192131634.png" alt="image-20210819213149368" style="zoom:50%;" /></p>

<p><code class="language-plaintext highlighter-rouge">insert_into_all</code>å‡½æ•°è¾ƒä¸ºå®¹æ˜“å®ç°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">insert_into_all</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">nested_list</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[[</span><span class="n">item</span><span class="p">]</span> <span class="o">+</span> <span class="n">elem</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">nested_list</span><span class="p">]</span>
</code></pre></div></div>

<p>è€Œ<code class="language-plaintext highlighter-rouge">subseqs</code>æ˜¯ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„<code class="language-plaintext highlighter-rouge">Number Selection problem with lists</code>ï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯ä»å¤´éƒ¨å¼€å§‹çš„ï¼Œé¢å¯¹è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè€ƒå¯Ÿ<code class="language-plaintext highlighter-rouge">s[1:]</code>æ—¶çš„æƒ…å†µï¼Œä»¥<code class="language-plaintext highlighter-rouge">[2,3]</code>ä¸ºä¾‹ï¼Œé‚£ä¹ˆæ­¤æ—¶çš„è¿”å›å€¼åº”å½“ä¸º<code class="language-plaintext highlighter-rouge">[[],[2],[3],[2,3]]</code>ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°è§„å¾‹ï¼Œå½“æˆ‘ä»¬è¯•å›¾æŠŠé—®é¢˜ä»<code class="language-plaintext highlighter-rouge">s[1:]</code>è½¬åŒ–åˆ°<code class="language-plaintext highlighter-rouge">s</code>æ—¶ï¼Œå…¶å®æ˜¯åœ¨<code class="language-plaintext highlighter-rouge">s[1:]</code>ç»“æœçš„åŸºç¡€ä¸Šåœ¨ç¬¬ä¸€ä½æ’å…¥<code class="language-plaintext highlighter-rouge">s[0]</code>ã€‚äºæ˜¯å€ŸåŠ©äºä¹‹å‰å®ç°çš„å‡½æ•°ï¼Œä¸éš¾å†™å‡ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">subseqs</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[[]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">insert_into_all</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">subseqs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">+</span> <span class="n">subseqs</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</code></pre></div></div>

<p>åœ¨è¯¥å‡½æ•°çš„åŸºç¡€ä¸Šï¼Œé¢˜ç›®è¦æ±‚æˆ‘ä»¬å®ç°ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192140603.png" alt="image-20210819214046426" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜ç›®æœ‰ç‚¹ç±»ä¼¼äº<a href="#anchor14">Summer 2020 Practice mt Q3</a>ï¼Œè®¾ç«‹ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">prev</code>å˜é‡ç”¨äºä¿å­˜å…ˆå‰éå†è¿‡çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ¬¡é€’å½’ä¸­ï¼ˆå¦‚æœåˆ—è¡¨è¢«æ”¹å˜ï¼‰çš„èµ·å§‹ä½ã€‚</p>

<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ€è€ƒï¼šå½“æˆ‘ä»¬å°è¯•å°†<code class="language-plaintext highlighter-rouge">3</code>ä¸ç»„åˆ<code class="language-plaintext highlighter-rouge">[2,4]</code>æ”¾åˆ°ä¸€èµ·æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">[3,2]</code>ä¸å¯ä»¥å‡ºç°ï¼Œå› ä¸ºæ­¤æ—¶çš„<code class="language-plaintext highlighter-rouge">prev</code>ï¼Œ<code class="language-plaintext highlighter-rouge">3</code>è¦æ¯”<code class="language-plaintext highlighter-rouge">s[0]</code>ï¼Œ<code class="language-plaintext highlighter-rouge">2</code>å¤§ã€‚å› ä¸ºæˆ‘ä»¬æ˜¯ä»å‰å‘åéå†çš„ï¼ŒæŒ‰ç…§<code class="language-plaintext highlighter-rouge">Tree recursion</code>çš„æ–¹æ³•ï¼ŒåŠ å…¥æ­¤æ—¶æˆ‘ä»¬å†³å®šé€‰ç”¨<code class="language-plaintext highlighter-rouge">3</code>ï¼Œé‚£ä¹ˆæ„å‘³ç€<code class="language-plaintext highlighter-rouge">2</code>æ˜¯ä¸å¯ä»¥è¢«ä½¿ç”¨çš„ï¼Œåˆ™ä¸‹è¾¹åº”ç»§ç»­æ¯”è¾ƒçš„å¯¹è±¡å°±ä¸º<code class="language-plaintext highlighter-rouge">s[1:]</code>äº†ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">inc_subseqs</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">subseq_helper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">prev</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[[]]</span>
        <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">prev</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">subseq_helper</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">prev</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># ç”¨s[0]ï¼Œé‚£ä¹ˆéœ€è¦æ›´æ–°prevçš„å€¼ä¸ºs[0]
</span>            
            <span class="n">a</span> <span class="o">=</span> <span class="n">subseq_helper</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1"># ä¸ç”¨s[0]
</span>            
            <span class="n">b</span> <span class="o">=</span> <span class="n">subseq_helper</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">prev</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">insert_into_all</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span>

    <span class="k">return</span> <span class="n">subseq_helper</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="lab-14-q4">Lab 14 Q4</h4>

<p>è¿™é“é¢˜å½“æ—¶è¢«å¡ä½ï¼Œä¸»è¦æ˜¯å› ä¸ºæ²¡æœ‰æƒ³åˆ°å¦‚ä½•å°†é—®é¢˜è½¬åŒ–ä¸ºå¯ä»¥ç”¨ç¨‹åºè¯­è¨€æè¿°çš„<code class="language-plaintext highlighter-rouge">Tree Recursion</code>é—®é¢˜ã€‚</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109030222611.png" alt="image-20210903022249465" style="zoom:50%;" /></p>

<p>å¯¹äºæŸä¸ªæ•°å­—ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŠ å…¥å‰åŠä¸ªå­é›†ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸åŠ å…¥ï¼Œé—®é¢˜çš„è½¬åŒ–å…³é”®å°±åœ¨äºï¼Œå½“æˆ‘ä»¬é€‰æ‹©<strong>æ”¾å¼ƒæŸä¸ªæ•°å­—æ—¶ï¼Œå…¶å®å°±é»˜è®¤äº†è¦å°†è¯¥æ•°å­—æ”¾åœ¨ååŠä¸ªå­é›†é‡Œ</strong>ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œé¢˜ç›®ä¸­è¦æ±‚çš„<code class="language-plaintext highlighter-rouge">difference</code>ä¹Ÿä¼šå‘ç”Ÿå¯¹åº”çš„<code class="language-plaintext highlighter-rouge">+-</code>å˜åŒ–ï¼Œå½¢æˆäº†<code class="language-plaintext highlighter-rouge">Tree Recursion</code>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">num_splits</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">difference_so_far</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">difference</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">s</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">difference</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
           <span class="k">return</span> <span class="mi">0</span>
        <span class="n">element</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">difference_so_far</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">difference</span> <span class="o">+</span> <span class="n">element</span><span class="p">)</span> <span class="o">+</span> <span class="n">difference_so_far</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">difference</span> <span class="o">-</span> <span class="n">element</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">difference_so_far</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</code></pre></div></div>

<p>æ³¨æ„åˆ°ä¸Šè¿°çš„è®¡ç®—è¿‡ç¨‹å…¶å®æ˜¯æ°å¥½é‡å¤è®¡ç®—äº†ä¸€éï¼Œæ‰€ä»¥ç»“æœè¦é™¤ä»¥2.</p>

<h4 id="æ³¨æ„çµæ´»å¤„ç†è¿”å›å€¼">æ³¨æ„çµæ´»å¤„ç†è¿”å›å€¼</h4>

<h5 id="disc-14">disc 14</h5>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109030342232.png" alt="image-20210903034240125" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜æ€è·¯ä¸éš¾ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„<strong>å½“æˆ‘ä»¬å‘ç°æ— æ³•é€šè¿‡å¯¹å‰åºä»£ç ä¸‹æ‰‹å¾—åˆ°éœ€è¦çš„ç»“æœæ—¶ï¼Œå¯ä»¥è€ƒè™‘åœ¨returnå€¼ä¸Šåšå˜æ¢å¤„ç†ã€‚</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">paths</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> 
    <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">[]</span> 
    <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">y</span><span class="p">:</span> 
        <span class="k">return</span> <span class="p">[[</span><span class="n">x</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">a</span> <span class="o">=</span> <span class="n">paths</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 
        <span class="n">b</span> <span class="o">=</span> <span class="n">paths</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> 
        <span class="k">return</span> <span class="p">[[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">subpath</span> <span class="k">for</span> <span class="n">subpath</span> <span class="ow">in</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">]</span>
</code></pre></div></div>

<h2 id="f20-lecture-12recursion-tree">F20 Lecture 12ï¼ˆRecursion-&gt;Treeï¼‰</h2>

<p>è¯¦ç»†é˜è¿°äº†å¦‚ä½•ä½¿ç”¨é€’å½’å®Œæˆå…³äº<strong>æ ‘</strong>çš„å„ç§æ“ä½œï¼Œä»¥åŠä¸€äº›<code class="language-plaintext highlighter-rouge">container</code>çš„ç›¸å…³æ“ä½œã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">sum(iterable[,start])-&gt;value</code></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="nb">sum</span><span class="p">([[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],[</span><span class="mi">4</span><span class="p">]],[])</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">max(iterable[,key=func])-&gt;value</code></p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">all(iterable)-&gt;bool</code></p>
  </li>
</ul>

<blockquote>
  <p>Return True if bool(x) is True for all values in x in the iterable. If the iterable is empty, return True.</p>
</blockquote>

<h3 id="tree">Tree</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210727235928.png" alt="image-20210727235920957" /></p>

<p>å¦‚ä½•æ„é€ ä¸€ä¸ªæ ‘ï¼Ÿ</p>

<p>e.g.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">tree</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">tree</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">)])])</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">2</span><span class="p">,[</span><span class="mi">1</span><span class="p">],[</span><span class="mi">1</span><span class="p">]]]</span>
</code></pre></div></div>

<p>å®šä¹‰å¦‚ä¸‹å‡ ä¸ªå‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">tree</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">branches</span><span class="o">=</span><span class="p">[]):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">branches</span>

<span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

<span class="k">def</span> <span class="nf">is_tree</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="c1"># è¿™é‡Œçš„æ¡ä»¶åˆ¤æ–­è¯­å¥æ˜¯æœ‰å¿…è¦çš„ï¼Œå¦‚æœæˆ‘ä»¬å•å•è¿›è¡Œå¾ªç¯çš„è¯ï¼Œæœ€ååŠ¿å¿…ä¼šå›åˆ°å‡½æ•°æœ€ä¸‹ç«¯çš„è¿”å›å€¼é‚£é‡Œï¼Œé‚£åˆ¤æ–­ä¹Ÿå°±å¤±å»äº†æ„ä¹‰ï¼Œé€šè¿‡ifæ¡ä»¶ï¼Œç¨‹åºåœ¨æŸä¸€æ—¶åˆ»ç›´æ¥ç»“æŸ
</span>        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_tree</span><span class="p">(</span><span class="n">branch</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="c1"># åˆ¤æ–­æ˜¯å¦ä¸ºempty
</span>    
    <span class="k">return</span> <span class="ow">not</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
</code></pre></div></div>

<p>åˆ©ç”¨è¿™å‡ ä¸ªåŸºæœ¬çš„å‡½æ•°ï¼Œå¯ä»¥å¤„ç†ä¸€äº›æ›´ä¸ºå…·ä½“çš„<code class="language-plaintext highlighter-rouge">Tree Porcessing</code>ï¼Œæ¯”å¦‚æ„é€ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Fibonacci</code>æ ‘ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">left</span><span class="p">)</span><span class="o">+</span><span class="n">label</span><span class="p">(</span><span class="n">right</span><span class="p">),[</span><span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">])</span>
</code></pre></div></div>

<p>ä»¥åŠä¸€äº›æ›´é«˜é˜¶çš„<code class="language-plaintext highlighter-rouge">Tree Processing</code>å‡½æ•°ï¼Œæ¯”å¦‚å¯¹å¶(<code class="language-plaintext highlighter-rouge">leaves</code>)è¿›è¡Œçš„æ“ä½œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count_leaves</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="c1"># åˆ¤æ–­æ˜¯å¦ä¸ºå¶ç»“ç‚¹ï¼Œå¸¸ä½œä¸ºbase case
</span>    
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch_counts</span> <span class="o">=</span> <span class="p">[</span><span class="n">count_leaves</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">branch_counts</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">leaves</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="s">'''Return a list containing the leaf labels of tree.'''</span>
    
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># åˆ©ç”¨sum()å‡½æ•°å¯¹listæ“ä½œçš„ç‰¹æ®Šæ€§è´¨ï¼Œæ¯æ¬¡returné‡åˆ°sumå‡½æ•°å°±ä¼šè„±æ‰åœ¨sumå†…éƒ¨çš„list comprehensionå¤–è¾¹ä¸€å±‚æ‹¬å·,è¿™æ ·ä¾¿å¯ä»¥ä¿è¯è¾“å‡ºçš„leaveséƒ½åœ¨åŒä¸€ç»´åº¦å†…
</span>        
        <span class="c1"># List of leaf labels for each branch
</span>        
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">leaves</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">)],[])</span>
    
<span class="k">def</span> <span class="nf">increment_leaves</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">'''Return a tree like t but with leaf labels incremented.'''</span>
    
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># æ³¨æ„è¿™é‡Œå¿…é¡»ç”¨treeåŒ…è£¹é€’å½’å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰treeï¼Œé‚£ä¹ˆæœ€åè¿”å›çš„ä»…ä»…å°±æ˜¯å‡ ä¸ªå•ç‹¬çš„leafï¼Œæ— æ³•æ„æˆå®Œæ•´çš„æ ‘
</span>        
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">),[</span><span class="n">increment_leaves</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
    
<span class="k">def</span> <span class="nf">increment</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">'''Return a tree like t but with all labels incremented'''</span>
    
    <span class="c1"># é€’å½’ç»“æŸæ¡ä»¶ä¸ºforå¾ªç¯ç»ˆæ­¢ï¼Œä¸éœ€è¦å•ç‹¬è®¾ç½®base case
</span>    
    <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="n">increment_leaves</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
</code></pre></div></div>

<p>åœ¨æœ‰äº†ä¸€ç³»åˆ—<code class="language-plaintext highlighter-rouge">Tree Processing</code>çš„å‡½æ•°ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ ‘æ‰“å°å‡ºæ¥ï¼Œå¹¶æ§åˆ¶ç¼©è¿›ï¼Œä»¥æ›´å¥½çš„æ˜¾ç¤ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">print_tree</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'	'</span> <span class="o">*</span> <span class="n">indent</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="n">print_tree</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">indent</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>åœ¨è®¾è®¡é€’å½’æ—¶ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p>

  <ol>
    <li>ä½¿ç”¨returnçš„æ–¹æ³•æ§åˆ¶é€’å½’è¿›è¡Œ</li>
    <li>å°†éœ€è¦è·Ÿè¸ªçš„å˜é‡ä»¥å‡½æ•°å‚æ•°çš„å½¢å¼ä¼ å…¥</li>
  </ol>

  <p>å¯¹äºç¬¬äºŒç§æ–¹æ³•ï¼Œå¦‚ï¼š</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">numbers</span> <span class="o">=</span> <span class="n">tree</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="n">tree</span><span class="p">(</span><span class="mi">5</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">6</span><span class="p">)])])</span>

<span class="c1"># åˆ†åˆ«ç»Ÿè®¡ä»rootåˆ°æ¯ä¸€ä¸ªå¶ç»“ç‚¹çš„labelæ€»å’Œ
</span>
<span class="k">def</span> <span class="nf">print_nums</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">so_far</span><span class="p">):</span>
    <span class="n">so_far</span> <span class="o">=</span> <span class="n">so_far</span> <span class="o">+</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">so_far</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
    	<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">print_sums</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">so_far</span><span class="p">)</span>
</code></pre></div>  </div>
</blockquote>

<p><strong>åœ¨<code class="language-plaintext highlighter-rouge">Tree</code>çš„ç›¸å…³é€’å½’å‡½æ•°ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œä»–çš„æ€è·¯å…¶å®æ˜¯å’Œä¹‹å‰çš„é€’å½’ç±»ä¼¼çš„ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°åˆ†æ”¯çš„è¿‡ç¨‹ï¼Œå…¶å®å°±æ˜¯åœ¨è¿›è¡Œ<code class="language-plaintext highlighter-rouge">Recursion decomposition</code>ï¼ŒåŒå…ˆå‰çš„é€’å½’ä¸€æ ·ï¼Œåœ¨ä¹¦å†™å‡½æ•°æ—¶ä¹Ÿåªéœ€è¦è€ƒè™‘ä¸‹è¾¹ä¸€å±‚çš„æƒ…å†µå³å¯ï¼ˆå³ç¬¬(n-1)å±‚å¯èƒ½å­˜åœ¨çš„1ã€2ã€3ã€4â€¦ä¸ªèŠ‚ç‚¹å¦‚ä½•å¤„ç†ï¼‰</strong></p>

<h4 id="lab-05">lab 05<a id="anchor"></a></h4>

<blockquote>
  <p>Define the function <code class="language-plaintext highlighter-rouge">add_trees</code>, which takes in two trees and returns a new tree where each corresponding node from the first tree is added with the node from the second tree. If a node at any particular position is present in one tree but not the other, it should be present in the new tree as well.</p>
</blockquote>

<p>é¦–å…ˆæ€è€ƒä¸‹base caseï¼Œå¯ä»¥å°†<code class="language-plaintext highlighter-rouge">t1</code>ä¸<code class="language-plaintext highlighter-rouge">t2</code>ä¸ºå¶ç»“ç‚¹çš„æƒ…å†µåˆå¹¶åœ¨ä¸€èµ·ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_trees</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span><span class="o">+</span><span class="n">label</span><span class="p">(</span><span class="n">t2</span><span class="p">),</span><span class="n">branches</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span><span class="o">+</span><span class="n">branches</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">......</span>
</code></pre></div></div>

<p>å¦‚æœä¸¤è€…å‡ä¸æ˜¯å¶ç»“ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸¤ä¸ªæ ‘åŒæ—¶è¿›è¡Œéå†ï¼ˆé€’å½’ï¼‰ï¼Œè¿™å°±éœ€è¦ç”¨åˆ°æ‹‰é“¾å‡½æ•°ï¼ŒåŒæ—¶æœ€åçš„è¿”å›å€¼ä¸€å®šæ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">tree</code>å‡½æ•°è¿›è¡Œæ„é€ çš„ï¼Œæ‰€ä»¥åŸºæœ¬çš„æ¡†æ¶åº”è¯¥æ˜¯ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span><span class="o">+</span><span class="n">label</span><span class="p">(</span><span class="n">t2</span><span class="p">),[</span><span class="n">add_trees</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">branches</span><span class="p">(</span><span class="n">t1</span><span class="p">),</span><span class="n">branches</span><span class="p">(</span><span class="n">t2</span><span class="p">))])</span>
</code></pre></div></div>

<p>æ˜¾ç„¶ï¼Œå¦‚æœä¸¤æ ‘çš„æ„é€ å®Œå…¨ç›¸åŒï¼Œè¿™ä¹ˆåšæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å½“æ ‘çš„æ„é€ ä¸åŒæ—¶ï¼Œç›´æ¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">zip</code>å‡½æ•°ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸‹è¾¹è¦è§£å†³çš„é—®é¢˜æ˜¯å°†æ„é€ ä¸åŒçš„ä¸¤æ ‘å˜æˆç›¸åŒçš„ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span><span class="p">:</span>
        <span class="n">branch_t1</span> <span class="o">=</span> <span class="n">branches</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
        <span class="n">branch_t2</span> <span class="o">=</span> <span class="n">branches</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
        <span class="n">t1_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_t1</span><span class="p">)</span>
        <span class="n">t2_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_t2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t1_len</span> <span class="o">&lt;</span> <span class="n">t2_len</span><span class="p">:</span>
            <span class="n">branch_t1</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t2_len</span><span class="o">-</span><span class="n">t1_len</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">t1_len</span> <span class="o">&gt;</span> <span class="n">t2_len</span><span class="p">:</span>
            <span class="n">branch_t2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t1_len</span> <span class="o">-</span> <span class="n">t2_len</span><span class="p">)]</span>
</code></pre></div></div>

<p>æŠ€å·§å°±æ˜¯æŠŠåŸå…ˆä¸å­˜åœ¨çš„èŠ‚ç‚¹ç”¨0èŠ‚ç‚¹å¡«è¡¥ä¸Šã€‚</p>

<p>æœ€åå¾—åˆ°å®Œæ•´çš„é€’å½’å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">add_trees</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="ow">or</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t2</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span><span class="p">(</span><span class="n">t2</span><span class="p">),</span><span class="n">branches</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span> <span class="o">+</span> <span class="n">branches</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">branch_t1</span> <span class="o">=</span> <span class="n">branches</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
        <span class="n">branch_t2</span> <span class="o">=</span> <span class="n">branches</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
        <span class="n">t1_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_t1</span><span class="p">)</span>
        <span class="n">t2_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">branch_t2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">t1_len</span> <span class="o">&lt;</span> <span class="n">t2_len</span><span class="p">:</span>
            <span class="n">branch_t1</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t2_len</span> <span class="o">-</span> <span class="n">t1_len</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">t1_len</span> <span class="o">&gt;</span> <span class="n">t2_len</span><span class="p">:</span>
            <span class="n">branch_t2</span> <span class="o">+=</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">t1_len</span> <span class="o">-</span> <span class="n">t2_len</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span><span class="o">+</span><span class="n">label</span><span class="p">(</span><span class="n">t2</span><span class="p">),[</span><span class="n">add_trees</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">branch_t1</span><span class="p">,</span><span class="n">branch_t2</span><span class="p">)])</span>
</code></pre></div></div>

<h4 id="disc-05">disc 05<a id="anchor1"></a></h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730153747.png" alt="image-20210730153746665" style="zoom:67%;" /></p>

<p>è¿˜æ˜¯å…ˆæ¥æ€è€ƒbase caseï¼š</p>

<p>å› ä¸ºè¿™é“é¢˜æœ€ç»ˆå¹¶ä¸æ˜¯è¦æ„é€ ä¸€ä¸ªæ ‘ï¼Œæ‰€ä»¥<code class="language-plaintext highlighter-rouge">base case</code>ä¸è¦ç†æ‰€åº”å½“çš„å†™ä½œ<code class="language-plaintext highlighter-rouge">is_leaf</code>ï¼Œæ ¹æ®é¢˜ç›®ï¼Œåœ¨æˆ‘ä»¬æ‰¾åˆ°<code class="language-plaintext highlighter-rouge">x</code>æ—¶å°±åº”å½“è¿”å›å¸¦æœ‰<code class="language-plaintext highlighter-rouge">x</code>çš„åˆ—è¡¨ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥è€ƒè™‘æ˜¯å¦å¯ä»¥ç”¨<code class="language-plaintext highlighter-rouge">list comprehension</code>çš„å½¢å¼ç›´æ¥é€’å½’ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³åˆ°<code class="language-plaintext highlighter-rouge">list comprehension</code>ä¼šå°†æ‰€æœ‰èŠ‚ç‚¹å…¨éƒ¨è¾“å‡ºï¼Œä½†åœ¨é‡åˆ°ä¸å­˜åœ¨<code class="language-plaintext highlighter-rouge">x</code>çš„è·¯å¾„æ—¶ï¼Œæ ¹æ®é¢˜ç›®è¦æ±‚éœ€è¦è¿”å›<code class="language-plaintext highlighter-rouge">None</code>ï¼Œæ‰€ä»¥ä¸ºäº†æ›´åŠ æ¸…æ™°ï¼Œæˆ‘ä»¬å°†<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯æ‹‰å‡ºæ¥å†™ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_path</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">find_path</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># å¦‚æœå·²ç»æ‰¾åˆ°äº†xæ‰€åœ¨çš„ä½ç½®ï¼Œåˆ™è¿”å›ï¼Œå¦åˆ™ç»§ç»­forå¾ªç¯éå†åˆ†æ”¯
</span>        
        <span class="k">if</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">)]</span> <span class="o">+</span> <span class="n">path</span>
</code></pre></div></div>

<p>ä»¿ç…§ä¸Šè¾¹è¿™é“é¢˜ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730154947.png" alt="image-20210730154947851" style="zoom:67%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730155007.png" alt="image-20210730155007625" style="zoom:67%;" /></p>

<p><strong>æ³¨æ„è¿™é“é¢˜æœ€åæ˜¯è¦è¿”å›ä¸€ä¸ªtreeçš„ï¼Œä½†æ˜¯å’Œä¸Šä¸€é“é¢˜ç›®ç›¸åŒï¼Œä¹Ÿæ˜¯åªåŒ…å«äº†éƒ¨åˆ†æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç™½ä¸¤ä»¶äº‹ï¼š</strong></p>

<ol>
  <li>base caseæå¤§æ¦‚ç‡ä¸º<code class="language-plaintext highlighter-rouge">is_leaf()</code></li>
  <li>é€’å½’ä¸»ä½“ä¸­çš„forå¾ªç¯ä¸èƒ½ä½¿ç”¨<code class="language-plaintext highlighter-rouge">list comprehension</code>çš„å½¢å¼</li>
  <li>å‡½æ•°æœ€åè¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">tree</code>å‡½æ•°return</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prune_binary</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">None</span>
</code></pre></div></div>

<p>åœ¨é€’å½’ä¸»ä½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®Œæˆä¸¤ä»¶äº‹ï¼š</p>

<ol>
  <li>æŠŠåˆ—è¡¨ä¸­çš„å…ƒç´ çš„æŸå‡ ä¸ªå­—æ¯æŠ½å‡ºæ¥ï¼Œå’Œåˆ†æ”¯èŠ‚ç‚¹æ¯”å¯¹ï¼Œå¦‚æœä¸€æ ·ï¼Œå°±æŠŠå¯¹åº”å…ƒç´ ä¸­ä½™ä¸‹çš„å­—ç¬¦ä¼ ä¸‹å»ï¼Œå¦‚æœä¸ä¸€æ ·ï¼Œå°±æŠŠé‚£ä¸ªå…ƒç´ ç›´æ¥æ‰”æ‰å§</li>
  <li>å› ä¸ºå¯èƒ½å­˜åœ¨å¤šä¸ªè·¯å¾„ï¼Œæˆ‘ä»¬æœ€åè¦ç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„æ ‘</li>
</ol>

<p>é¦–å…ˆçœ‹ç¬¬äºŒç‚¹ï¼Œå…¶å®<code class="language-plaintext highlighter-rouge">list comprehension</code>çš„å¦ä¸€ç§å†™æ³•æ˜¯ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">next_branch</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="n">cur_f</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">next_branch</span> <span class="o">=</span> <span class="n">next_branch</span> <span class="o">+</span> <span class="p">[</span><span class="n">cur_f</span><span class="p">]</span>
<span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">),</span><span class="n">next_branch</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨è¿™ç§å†™æ³•ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">next_branch</code>çš„ä½œç”¨å°±æ˜¯å°†æŸä¸ªèŠ‚ç‚¹ä¸‹å¯¹åº”çš„æ‰€æœ‰<code class="language-plaintext highlighter-rouge">branch</code>ç»„åˆèµ·æ¥ï¼Œæˆ‘ä»¬æ­£æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹æ¥è§£å†³ä¸Šè¾¹è¿™é“é—®é¢˜ã€‚</p>

<p>å…¶æ¬¡å¯¹äºç¬¬ä¸€ç‚¹ï¼ŒæŠŠä¼ªä»£ç å®ç°å‡ºæ¥ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">next_valid_nums</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</code></pre></div></div>

<p>è‡³æ­¤ï¼Œç¨‹åºçš„å¤§è‡´ç»“æ„å·²ç»ç¡®å®šäº†ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prune_binary</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">next_valid_nums</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">next_branch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">pruned_branch</span> <span class="o">=</span> <span class="n">pruned_binary</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">next_valid_nums</span><span class="p">)</span>
            <span class="n">next_branch</span> <span class="o">=</span> <span class="n">next_branch</span> <span class="o">+</span> <span class="p">[</span><span class="n">pruned_branch</span><span class="p">]</span>
        <span class="c1">#æ­¤å¤„çš„returnè¯­å¥å¿…é¡»ç‹¬ç«‹äºforå¾ªç¯ä¹‹å¤–ï¼Œå¦åˆ™ä¸€æ¡åˆ†æ”¯ç»“æŸäº†å°±å›å®¶äº†
</span>        
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">),</span><span class="n">next_branch</span><span class="p">)</span>
</code></pre></div></div>

<p>ä½†åŒæ—¶æ³¨æ„åˆ°ï¼Œåœ¨base caseä¸­å­˜åœ¨è¿”å›<code class="language-plaintext highlighter-rouge">None</code>çš„å¯èƒ½æ€§ï¼Œå¦‚æœ<code class="language-plaintext highlighter-rouge">pruned_binary</code>ä¸€æ—¦è¿”å›<code class="language-plaintext highlighter-rouge">None</code>ï¼Œå…¶å®æ•´ä¸ªåˆ†æ”¯ä¹Ÿå°±æ²¡æœ‰ä¿ç•™çš„å¿…è¦äº†ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åŠ ä¸Šä¸€äº›åˆ¤æ–­è¯­å¥ï¼Œä¿è¯ç¨‹åºè¿è¡Œæ­£ç¡®ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prune_binary</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">nums</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="n">nums</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">next_valid_nums</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nums</span> <span class="k">if</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="n">nums</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">next_branch</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
            <span class="n">pruned_branch</span> <span class="o">=</span> <span class="n">pruned_binary</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">next_valid_nums</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">pruned_branch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            	<span class="n">next_branch</span> <span class="o">=</span> <span class="n">next_branch</span> <span class="o">+</span> <span class="p">[</span><span class="n">pruned_branch</span><span class="p">]</span>      
        <span class="k">if</span> <span class="ow">not</span> <span class="n">new_branches</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">tree</span><span class="p">),</span><span class="n">next_branch</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="f20-lecture16--qa--recursion-treehigher--order--function">F20 Lecture16  Q&amp;A  (Recursion-&gt;Tree+Higher  Order  Function)<a id="anchor7"></a></h2>

<h3 id="1">1</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210803195429.png" alt="image-20210803195428667" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">profit</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">'''Return the max profit'''</span>
    
    <span class="k">return</span> <span class="n">helper</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªhelperå‡½æ•°ï¼Ÿå› ä¸ºè€ƒè™‘åˆ°é¢˜ç›®è®¾ç½®ï¼šå¯¹äºæŸä¸ªèŠ‚ç‚¹<code class="language-plaintext highlighter-rouge">b</code>ï¼Œè‹¥å®ƒçš„çˆ¶èŠ‚ç‚¹å·²è¢«ä½¿ç”¨ï¼Œåˆ™<code class="language-plaintext highlighter-rouge">b</code>ä¸èƒ½è¢«ä½¿ç”¨ï¼›å¦‚æœçˆ¶èŠ‚ç‚¹æ²¡æœ‰ä½¿ç”¨ï¼Œé‚£æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨<code class="language-plaintext highlighter-rouge">b</code>æˆ–è€…ä¸ä½¿ç”¨<code class="language-plaintext highlighter-rouge">b</code>ï¼Œè¿™ä¹Ÿå†³å®šäº†æ¥ä¸‹æ¥<code class="language-plaintext highlighter-rouge">b</code>çš„å­èŠ‚ç‚¹èƒ½å¦è¢«ä½¿ç”¨ã€‚è¿™æ„å‘³ç€éœ€è¦è·Ÿè¸ªä¸€ä¸ªé¢å¤–çš„<code class="language-plaintext highlighter-rouge">çˆ¶èŠ‚ç‚¹æ˜¯å¦å·²è¢«ä½¿ç”¨</code>çš„å‚æ•°ï¼Œæ‰€ä»¥éœ€è¦å»ºç«‹ä¸€ä¸ªhelperå‡½æ•°ã€‚</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">used_parent</span><span class="p">):</span>
    <span class="c1"># å¦‚æœå·²ç»ä½¿ç”¨äº†çˆ¶èŠ‚ç‚¹,åˆ™ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆè¯¥èŠ‚ç‚¹ï¼‰ä¸å¯ä½¿ç”¨ï¼Œå°†flagè®¾ç½®ä¸ºFalseå°±ç›´æ¥è·³è¿‡è¿™ä¸ªif
</span>    
    <span class="k">if</span> <span class="n">used_parent</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># ä¸ä½¿ç”¨çˆ¶èŠ‚ç‚¹ï¼Œåˆ†ä¸ºç”¨è¯¥èŠ‚ç‚¹/ä¸ç”¨è¯¥èŠ‚ç‚¹ä¸¤ç§æƒ…å†µï¼Œå¦‚æœä½¿ç”¨æ­¤èŠ‚ç‚¹ï¼Œåˆ™ä¸‹æ¬¡é€’å½’ï¼ˆå…¶å­èŠ‚ç‚¹è¦è·³è¿‡ï¼Œå³è¿›å…¥ä¸Šè¾¹çš„ifé‡Œï¼‰
</span>        
        <span class="n">use_current_total</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
        <span class="c1"># ä¸ä½¿ç”¨æ­¤èŠ‚ç‚¹ï¼Œåˆ™è¿˜éœ€è¦è€ƒè™‘å…¶å­èŠ‚ç‚¹æ˜¯å¦è¦ä½¿ç”¨ï¼Œä¸‹æ¬¡è¿˜è¦è¿›å…¥è¿™é‡Œçš„else
</span>        
        <span class="n">skip_current_label</span><span class="o">=</span> <span class="mi">0</span>        <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)])</span>
        <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">use_current_total</span><span class="p">,</span> <span class="n">skip_current_label</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h3 id="2">2</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210803204027.png" alt="image-20210803204027282" style="zoom:50%;" /></p>

<p>é¢˜ç›®æä¾›äº†ä¸€äº›åŸºæœ¬çš„æ¡†æ¶ï¼Œè¿™é‡Œä¸å•ç‹¬åˆ—å‡ºæ¡†æ¶äº†ï¼Œç›´æ¥å†™ï¼ˆä¸¤ç§å†™æ³•ï¼Œæˆ‘çš„åšæ³•å’Œæ•™æˆçš„ä¸ä¸€æ ·ï¼‰:</p>

<p>å› ä¸ºè¦åŒæ—¶è·Ÿè¸ªå·²ç»åŠ ä¸Šçš„èŠ‚ç‚¹ï¼Œå°†å…¶ä½œä¸ºåŸæ¥çš„<code class="language-plaintext highlighter-rouge">branches</code>çš„<code class="language-plaintext highlighter-rouge">root</code>ï¼ŒåŒæ—¶è¿˜è¦è·Ÿè¸ªæœªå¤„ç†çš„<code class="language-plaintext highlighter-rouge">branches</code>ï¼Œæ‰€ä»¥å»ºç«‹åµŒå¥—å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">village</span><span class="p">(</span><span class="n">apple</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="s">'''Grafts the given branches 'bs' onto each leaf of the given tree 't', returning a new tree '''</span>
    
    <span class="k">def</span> <span class="nf">graft</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">bs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">bs</span><span class="p">)</span>
        <span class="n">new_branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">graft</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">new_branches</span><span class="p">)</span>
    <span class="n">base_t</span> <span class="o">=</span> <span class="n">apple</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="p">[</span><span class="n">village</span><span class="p">(</span><span class="n">apple</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">graft</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span><span class="n">bs</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå†™ï¼Ÿæƒ³æ³•æ˜¯é€šè¿‡å˜é‡<code class="language-plaintext highlighter-rouge">base_t</code>å°†èŠ‚ç‚¹æ‰©å±•ï¼Œåˆ©ç”¨<code class="language-plaintext highlighter-rouge">bs</code><strong>éå†åŸæ ‘</strong>ï¼Œä¹‹åé€šè¿‡<code class="language-plaintext highlighter-rouge">graft(base_t,bs)</code>å‡½æ•°ä¼ å…¥æ‰©å±•èŠ‚ç‚¹ï¼Œå¹¶æŠŠ<strong>æ·»åŠ èŠ‚ç‚¹</strong>çš„å·¥ä½œæ”¾åœ¨<code class="language-plaintext highlighter-rouge">graft</code>å‡½æ•°å†…éƒ¨ï¼Œä¸ä¹‹å‰ä¸€æ ·ä½¿ç”¨<code class="language-plaintext highlighter-rouge">list comprehension</code>çš„æ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´å¤§çš„ç›®æ ‡æœ‰ä¸¤ä¸ªï¼š</p>

<ul>
  <li>éå†åŸæ ‘ï¼Œkeep tracking of every nodes of the original tree</li>
  <li>æ ¹æ®è¦æ±‚æ·»åŠ èŠ‚ç‚¹å¹¶æ„é€ æ–°æ ‘</li>
</ul>

<p>è¿™é“é¢˜ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">village</span><span class="p">(</span><span class="n">apple</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">graft</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">bs</span><span class="p">):</span>
        <span class="c1"># å¶ç»“ç‚¹
</span>        
        <span class="k">if</span> <span class="n">bs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">t</span>
        <span class="n">new_branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">bs</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">base_t</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="p">[</span><span class="n">tree</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="p">[</span><span class="n">village</span><span class="p">(</span><span class="n">apple</span><span class="p">,</span> <span class="n">branch</span><span class="p">)</span> <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">b</span><span class="p">)])</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">new_branches</span><span class="p">])</span>
    <span class="n">base_t</span> <span class="o">=</span> <span class="n">apple</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">bs</span> <span class="o">=</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">graft</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">bs</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™ç§æ–¹æ³•çš„æƒ³æ³•æ˜¯æŠŠæ‰€æœ‰çš„é€’å½’å·¥ä½œæ”¾åˆ°å†…éƒ¨å‡½æ•°ä¸­å»ï¼Œæ‰€ä»¥åœ¨å¶ç»“ç‚¹çš„å¤„ç†æ¡ä»¶ä¸Šæœ‰äº›æ”¹å˜ï¼Œç›¸å¯¹ç›´è§‚ï¼Œå†…éƒ¨å‡½æ•°çš„<code class="language-plaintext highlighter-rouge">new_branch</code>ä»£è¡¨äº†ç»è¿‡<code class="language-plaintext highlighter-rouge">apple</code>å¤„ç†åçš„æ‰€æœ‰åˆ†æ”¯ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥è¦è€ƒå¯Ÿçš„å°±æ˜¯é™¤äº†<code class="language-plaintext highlighter-rouge">root</code>å’Œåˆšæ‰æ·»åŠ çš„<code class="language-plaintext highlighter-rouge">apple</code>ç”ŸæˆèŠ‚ç‚¹äº†ã€‚</p>

<hr />

<h3 id="3-summer--2020--mt2--q2">3 (Summer  2020  mt2  Q2)</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108181339773.png" alt="image-20210818133911561" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜ç›®æˆ‘å°è¯•è¿‡ä½¿ç”¨ä¸€èˆ¬çš„é€’å½’å½¢å¼å»åšï¼Œä½†æ˜¯å‘ç°ä¼šå¾ˆéº»çƒ¦â€¦è¦è¿”å›çš„å½¢å¼æ¯”è¾ƒå¤æ€ªï¼Œæ‰€ä»¥é¢˜ç›®æœ¬èº«ç»™å‡ºçš„æ¨¡æ¿é‡Œå¢åŠ ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">index</code>æ ‡å¿—è·Ÿè¸ªå­—ç¬¦ä½ç½®æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè¿™ä¼šå¤§å¤§å‡å°‘æ“ä½œéš¾åº¦ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_to</span><span class="p">,</span> <span class="n">max_digit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">galaxy</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sum_sofar</span> <span class="o">==</span> <span class="n">sum_to</span><span class="p">:</span>
            <span class="c1"># æ•é”æ•æ‰åˆ°ï¼Œè¿™ä¸ªå½¢å¼ä¸‹è¿”å›çš„galaxyæ˜¯å®Œæ•´çš„
</span>            
            <span class="k">return</span> <span class="p">[</span><span class="n">galaxy</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">sum_sofar</span> <span class="o">&gt;</span> <span class="n">sum_to</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sum_sofar</span> <span class="o">&lt;</span> <span class="n">sum_to</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">galaxy</span><span class="p">)):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">elif</span> <span class="n">galaxy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'?'</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">galaxy</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_digit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># å…³é”®çš„å¤„ç†è¡Œ
</span>            
            <span class="n">modified_galaxy</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">galaxy</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="n">schedule_helper</span><span class="p">(</span><span class="n">modified_galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ans</span>

    <span class="k">return</span> <span class="n">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>å¡ä½çš„ç‚¹ä¸»è¦æœ‰ä¸‰ä¸ªï¼š</p>

<ol>
  <li>æ•é”æ•æ‰åˆ°ï¼Œbase caseä¸­è¿™ä¸ª<code class="language-plaintext highlighter-rouge">[]</code>è¿”å›å€¼å½¢å¼ä¸‹çš„<code class="language-plaintext highlighter-rouge">galaxy</code>æ˜¯å®Œæ•´çš„</li>
  <li><code class="language-plaintext highlighter-rouge">index</code>å¯¹å‡†çš„æ˜¯ä¸‹ä¸€ä¸ªå³å°†å¤„ç†çš„æ•°å­—ä½ç½®ï¼Œè€Œä¸æ˜¯å·²ç»å¤„ç†è¿‡çš„æ•°å­—ä½ç½®</li>
  <li>å¦‚æœè¦ä¿æŒ<code class="language-plaintext highlighter-rouge">galaxy</code>æ•°ç»„é•¿åº¦ä¸€è‡´ï¼Œå¦‚ä½•å»æ›´æ”¹å…¶ä¸­çš„æŸä¸€ä½å­—ç¬¦ï¼Ÿ</li>
</ol>

<p>å†è€ƒè™‘æ¸…æ¥šè¿™ä¸‰ç‚¹ä¹‹åï¼Œä½™ä¸‹çš„å·¥ä½œå°±æ¯”è¾ƒæ¸…æ¥šäº†ï¼š</p>

<ul>
  <li><strong>Base Case</strong>: å½“éå†å®Œæœ€åä¸€ä½æ•°å­—ï¼Œå¹¶ä¸”æ•°å­—ä¹‹å’Œæ°å¥½ä¸º<code class="language-plaintext highlighter-rouge">sum_to</code>æ—¶ï¼ŒæŠŠå·²ç»è°ƒæ•´å®Œæ¯•çš„<code class="language-plaintext highlighter-rouge">galaxy</code>å­—ç¬¦ä¸²ä»¥<code class="language-plaintext highlighter-rouge">list</code>çš„å½¢å¼è¿”å›ï¼›</li>
  <li><strong>ERROR</strong>: å¦‚æœå·²ç»éå†å®Œä½†æ˜¯<code class="language-plaintext highlighter-rouge">sum</code>è¿˜æ˜¯ä¸åˆ°è®¾å®šå€¼æˆ–è€…å·²ç»è¶…è¿‡è®¾å®šå€¼çš„æƒ…å†µä¸‹ï¼Œèˆå¼ƒç»“æœï¼Œè¿”å›ç©ºæ•°ç»„ï¼›</li>
  <li>å¦‚æœæŒ‡å®šä½ç½®çš„å­—ç¬¦ä¸ä¸º<code class="language-plaintext highlighter-rouge">'?'</code>ï¼Œåˆ™ä¿æŒ<code class="language-plaintext highlighter-rouge">galaxy</code>ä¸åŠ¨ï¼›</li>
  <li>åä¹‹ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">max_digit</code>çš„é™åˆ¶ä¸‹å¯¹æ‰€æœ‰å¯èƒ½çš„æ•°å­—é€’å½’é€‰æ‹©ï¼Œå¹¶ä½¿ç”¨åˆ‡ç‰‡æ“ä½œæ›´æ”¹æŒ‡å®šä½ç½®çš„<code class="language-plaintext highlighter-rouge">'?'</code>ä¸ºæˆ‘ä»¬å½“å‰é€‰å®šçš„æ•°å­—<code class="language-plaintext highlighter-rouge">x</code></li>
</ul>

<blockquote>
  <p>å› ä¸ºæºå­—ç¬¦ä¸²ä¸­è‡³å°‘å­˜åœ¨ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">'?'</code>ï¼Œæ‰€ä»¥åªéœ€è¦åœ¨<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯å†…éƒ¨å¯¹<code class="language-plaintext highlighter-rouge">ans</code>è¿›è¡Œæ“ä½œå³å¯</p>
</blockquote>

<blockquote>
  <p>è¿™é“é¢˜ä¹Ÿå¯ä»¥ç”¨<code class="language-plaintext highlighter-rouge">yield</code>åšï¼š</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_to</span><span class="p">,</span> <span class="n">max_digit</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">galaxy</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sum_sofar</span> <span class="o">==</span> <span class="n">sum_to</span><span class="p">:</span>
            <span class="c1"># æ•é”æ•æ‰åˆ°ï¼Œè¿™ä¸ªå½¢å¼ä¸‹è¿”å›çš„galaxyæ˜¯å®Œæ•´çš„
</span>            
            <span class="c1"># return [galaxy]
</span>            
            <span class="k">yield</span> <span class="n">galaxy</span>
        <span class="k">elif</span> <span class="n">sum_sofar</span> <span class="o">&gt;</span> <span class="n">sum_to</span> <span class="ow">or</span> <span class="p">(</span><span class="n">sum_sofar</span> <span class="o">&lt;</span> <span class="n">sum_to</span> <span class="ow">and</span> <span class="n">index</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">galaxy</span><span class="p">)):</span>
            <span class="c1"># return []
</span>            
            <span class="k">return</span> 
        <span class="k">elif</span> <span class="n">galaxy</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">!=</span> <span class="s">'?'</span><span class="p">:</span>
            <span class="c1"># return schedule_helper(galaxy, sum_sofar + int(galaxy[index]), index + 1)
</span>            
            <span class="k">yield</span> <span class="k">from</span> <span class="n">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">galaxy</span><span class="p">[</span><span class="n">index</span><span class="p">]),</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># ans = []
</span>        
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_digit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="c1"># å…³é”®çš„å¤„ç†è¡Œ
</span>            
            <span class="n">modified_galaxy</span> <span class="o">=</span> <span class="n">galaxy</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="n">galaxy</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
            <span class="c1"># ans = ans + schedule_helper(modified_galaxy, sum_sofar + x, index + 1)
</span>            
            <span class="k">yield</span> <span class="k">from</span> <span class="n">schedule_helper</span><span class="p">(</span><span class="n">modified_galaxy</span><span class="p">,</span> <span class="n">sum_sofar</span> <span class="o">+</span> <span class="n">x</span><span class="p">,</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># return ans (å¯ä»¥å‚è€ƒä¸‹è¾¹yieldä»¥listä»£å†™çš„ç®€å•ä¾‹å­)
</span>
    <span class="c1"># return schedule_helper(galaxy, 0, 0)
</span>    
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">schedule_helper</span><span class="p">(</span><span class="n">galaxy</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div>  </div>
</blockquote>

<p>ä¸ºä»€ä¹ˆä¸Šè¾¹ç»“æŸé€’å½’æ—¶ä½¿ç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">yield from</code>è€Œé<code class="language-plaintext highlighter-rouge">yield</code>ï¼Ÿå¦‚æœæ€è€ƒé€’å½’è¿”å›çš„æµç¨‹å¯ä»¥å‘ç°ï¼Œå•ç‹¬çš„<code class="language-plaintext highlighter-rouge">yield</code>ä¼šå¯¼è‡´å½¢æˆä¸€ä¸ªåµŒå¥—çš„<code class="language-plaintext highlighter-rouge">generator</code>ï¼›ä½†æ˜¯<code class="language-plaintext highlighter-rouge">yield from</code>å¯ä»¥ä¿è¯æ¯æ¬¡éƒ½è¿”å›ä¸€å±‚çš„ç”Ÿæˆå™¨ã€‚</p>

<hr />

<h3 id="4">4<a id="anchor2"></a></h3>

<blockquote>
  <p>Print all the paths from the root of a tree to one of its leaves</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">tree</span><span class="p">(</span><span class="mi">1</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="n">tree</span><span class="p">(</span><span class="mi">3</span><span class="p">)]),</span><span class="n">tree</span><span class="p">(</span><span class="mi">4</span><span class="p">)])</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">print_all_paths</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
</code></pre></div>  </div>
</blockquote>

<p>ä¹‹å‰æˆ‘å¯¹è¿™é“é¢˜ç›®çš„æƒ³æ³•æ˜¯ï¼šä½¿ç”¨é€’å½’éå†èŠ‚ç‚¹ï¼Œæ¯å½“å›åˆ°æœ€å¤–å±‚å¾ªç¯æ—¶ï¼Œå°±ä½¿ç”¨<code class="language-plaintext highlighter-rouge">[]</code>å°†å·²ç»éå†çš„èŠ‚ç‚¹åŒ…è£¹èµ·æ¥ï¼Œä½†æ˜¯è¿™ä¹ˆåšå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š</p>

<ol>
  <li>ç¨‹åºæœ¬èº«æ— æ³•å¾—çŸ¥ä½•æ—¶è¿”å›åˆ°æœ€å¤–å±‚å¾ªç¯ï¼Œæˆ‘ä»¬ä¹Ÿæ— æ³•å¾—çŸ¥æ ‘çš„æ·±åº¦ï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨<code class="language-plaintext highlighter-rouge">helper</code>å‡½æ•°æ·»åŠ <code class="language-plaintext highlighter-rouge">index</code>éå†</li>
  <li>æŒ‰ç…§ä¸€èˆ¬çš„<code class="language-plaintext highlighter-rouge">tree</code>çš„éå†æ–¹å¼ï¼Œæ¯æ¬¡è¿”å›æœ€å¤–å±‚å¾ªç¯æ—¶ï¼Œå·²ç»æ˜¯åœ¨<code class="language-plaintext highlighter-rouge">root</code>çš„åˆ†æ”¯é‡Œäº†ï¼Œä½†æ˜¯ä¸ºäº†ç»Ÿè®¡æ‰€æœ‰çš„è·¯å¾„ï¼Œè¿˜éœ€è¦æŠŠ<code class="language-plaintext highlighter-rouge">root</code>åŠ è¿›å»æ‰è¡Œ</li>
</ol>

<p>æ‰€ä»¥æ•™æˆçš„è§£æ³•æ˜¯ï¼Œä¸€ä¸Šæ¥å…ˆåšä¸€ä¸ªç¨‹åºæŠ½è±¡ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">print_all_paths</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">'''Print all the paths from the root to a leaf'''</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¸‹è¾¹æˆ‘ä»¬éœ€è¦è€ƒè™‘<code class="language-plaintext highlighter-rouge">all_paths</code>è¿™ä¸ªå‡½æ•°å¦‚ä½•å®ç°ã€‚</p>

<p>é¦–å…ˆæŒ‰ç…§<code class="language-plaintext highlighter-rouge">tree</code>çš„åˆ†æ”¯éå†æ–¹å¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">all_paths</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="c1"># What should be done next?
</span>
</code></pre></div></div>

<p>å¦‚æœè¿™é‡Œè®©æˆ‘æ¥å†™çš„è¯ï¼Œä¼°è®¡ä¼šå†™æˆ<code class="language-plaintext highlighter-rouge">path = path + all_path(b)</code>çš„å½¢å¼ï¼Œä½†ä»”ç»†æ€è€ƒè¿™ç§æ–¹æ³•ä¼šå¯¼è‡´å„ä¸ªç‹¬ç«‹çš„<code class="language-plaintext highlighter-rouge">path</code>æ— æ³•åˆ†éš”ã€‚æ‰€ä»¥ä¸ºäº†åœ¨<code class="language-plaintext highlighter-rouge">branches</code>ä¸­ä¹Ÿèƒ½å°†<code class="language-plaintext highlighter-rouge">path</code>åˆ†éš”å¼€ï¼Œæˆ‘ä»¬é€‰æ‹©å†åŠ ä¸€å±‚<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">all_paths</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">all_paths</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="k">yield</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">)]</span> <span class="o">+</span> <span class="n">path</span>
</code></pre></div></div>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§å†™æ³•åªé€‚ç”¨äº<code class="language-plaintext highlighter-rouge">yield</code></strong>ï¼Œå› ä¸º<code class="language-plaintext highlighter-rouge">yield</code>ä¼šè‡ªåŠ¨ä¿å­˜éå†ä¿¡æ¯ï¼Œè¿™ç»™æ­¤ç±»çš„<strong>éå†å¹¶ä¿å­˜æ‰€æœ‰å·²éå†ä¿¡æ¯</strong>çš„é¢˜ç›®å¸¦æ¥äº†å¾ˆå¤§ä¾¿åˆ©ï¼Œåä¹‹å¦‚æœä½¿ç”¨<code class="language-plaintext highlighter-rouge">return</code>ï¼Œé‚£ä¹ˆéœ€è¦ä¸€ä¸ªæ•°ç»„æ¥å…¨ç¨‹è·Ÿè¿›(<strong>è´¯ç©¿</strong>)å·²ç»éå†è¿‡çš„èŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å‚æ•°ä¸­åŠ ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">res</code>ï¼Œç”¨äºè·Ÿè¸ªéå†èŠ‚ç‚¹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">all_paths2</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">is_leaf</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">res</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="n">ans</span> <span class="o">+=</span> <span class="n">all_paths</span><span class="p">(</span><span class="n">res</span><span class="p">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">b</span><span class="p">)</span>
           <span class="k">return</span> <span class="n">ans</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸Šè¾¹çš„ç¨‹åºä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">res.copy()</code>æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºpythonæ˜¯ä¼ é€’å¼•ç”¨ï¼Œä¸ºäº†å°†åŒä¸€å±‚çš„èŠ‚ç‚¹éå†æ•°ç»„åˆ†éš”å¼€ï¼Œå¿…é¡»ä½¿ç”¨<code class="language-plaintext highlighter-rouge">copy()</code>ä»¥å…æŠŠæ‰€æœ‰çš„èŠ‚ç‚¹æ·»åŠ åˆ°åŒä¸€ä¸ªæ•°ç»„ä¸­ã€‚</p>

<h2 id="f20-lecture-15list--tuple-mutable">F20 Lecture 15ï¼ˆList &amp; Tuple Mutableï¼‰</h2>

<blockquote>
  <p>Listçš„Mutableæ€§è´¨ &amp; Tupleçš„unmutableæ€§è´¨</p>
</blockquote>

<ul>
  <li>Mutable Default Arguments are Dangerous</li>
</ul>

<p>å‡½æ•°çš„é»˜è®¤å‚æ•°éšå‡½æ•°æœ¬ä½“ä¸€èµ·åˆ›å»ºï¼Œåœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å§‹ç»ˆç»´æŠ¤åŒä¸€å—å†…å­˜ç©ºé—´</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730165126.png" alt="image-20210730165126008" style="zoom: 50%;" /></p>

<ul>
  <li>List-addition &amp; slicing</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span>
<span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">9</span><span class="p">,[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="mi">3</span><span class="p">,[</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
</code></pre></div></div>

<p>è¿™é‡Œéœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜ï¼š</p>

<ol>
  <li>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
   
<span class="c1"># ä¸åŒäºc.append(a)
</span></code></pre></div>    </div>
  </li>
</ol>

<p>è¿™æ¡<code class="language-plaintext highlighter-rouge">+</code>è¯­å¥ä¼šä¸ºç­‰å¼å³ä¾§çš„<code class="language-plaintext highlighter-rouge">a</code>ä¸<code class="language-plaintext highlighter-rouge">b</code>åˆ†åˆ«åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„listï¼Œæ‰€ä»¥æ”¹å˜åŸå§‹çš„<code class="language-plaintext highlighter-rouge">a</code>ä¸<code class="language-plaintext highlighter-rouge">b</code>çš„å€¼å¹¶ä¸ä¼šå½±å“ç›¸åŠ ç”Ÿæˆåçš„åˆ—è¡¨<code class="language-plaintext highlighter-rouge">a</code>ï¼Œè¿™ä¸<code class="language-plaintext highlighter-rouge">append</code>å‡½æ•°ä¸åŒã€‚</p>

<ol>
  <li>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">+=</span> <span class="n">b</span>
   
<span class="c1"># ä¸åŒäºa = a + b
</span></code></pre></div>    </div>
  </li>
</ol>

<p>pythonä¸­çš„<code class="language-plaintext highlighter-rouge">+=</code>å·ä¸å®Œå…¨ç­‰åŒäº<code class="language-plaintext highlighter-rouge">+</code>ï¼Œåœ¨è¿™é‡Œï¼Œå¦‚æœåç»­æ”¹å˜äº†<code class="language-plaintext highlighter-rouge">b</code>çš„å€¼ï¼Œåˆ™ç”Ÿæˆçš„<code class="language-plaintext highlighter-rouge">a</code>ä¹Ÿä¼šè¢«æ”¹å˜ã€‚</p>

<ol>
  <li>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
</ol>

<p><code class="language-plaintext highlighter-rouge">[t]</code>ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯<code class="language-plaintext highlighter-rouge">[]</code>ç»è¿‡<code class="language-plaintext highlighter-rouge">append</code>æ“ä½œçš„äº§ç‰©ï¼Œæ‰€ä»¥åœ¨è¿™æ ·çš„<code class="language-plaintext highlighter-rouge">+</code>æ“ä½œä¸­ï¼Œåˆ›å»ºçš„æ˜¯<code class="language-plaintext highlighter-rouge">[]</code>ï¼Œä¹‹åæŒ‡å‘åŸå…ˆçš„<code class="language-plaintext highlighter-rouge">t</code>æ•°ç»„æ‰€åœ¨çš„ä½ç½®ï¼Œæ‰€ä»¥æ­¤æ—¶æ”¹å˜<code class="language-plaintext highlighter-rouge">t</code>ï¼Œåˆ™ä¼šæ”¹å˜ç”Ÿæˆçš„<code class="language-plaintext highlighter-rouge">a</code>çš„å€¼ã€‚</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730170109.png" alt="image-20210730170109139" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span>
</code></pre></div></div>

<p>æ„ä¸ºåœ¨0å¤„æ’å…¥æ•´ä¸ªtåºåˆ—ï¼ˆ<code class="language-plaintext highlighter-rouge">s[1:1]</code>åŒç†ï¼Œä¸è®ºæ’å…¥åºåˆ—çš„é•¿åº¦å¤šå°‘ï¼Œå› ä¸ºä½¿ç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">slicing</code>è¯­æ³•ï¼‰</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">list()</code>ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡</li>
  <li>Lists in Lists in Lists in Environment Diagrams</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210730171704.png" alt="image-20210730171704192" style="zoom:50%;" /></p>

<ul>
  <li>Tupleä¸­çš„listæ•°æ®å¯ä»¥è¢«æ›´æ”¹ï¼ˆå› ä¸ºæŒ‡å‘çš„æ˜¯å•ç‹¬å¼€è¾Ÿçš„å¦ä¸€å—å†…å­˜åŒºåŸŸè€Œä¸ç›´æ¥ä½äº<code class="language-plaintext highlighter-rouge">tuple</code>çš„å†…å­˜å—å†…ï¼‰</li>
</ul>

<h2 id="f20-lecture-16---nonlocal">F20 Lecture 16 - Nonlocal</h2>

<h3 id="python-particulars">Python Particulars</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210803214128.png" alt="image-20210803214128250" style="zoom:50%;" /></p>

<p>ä½†æ˜¯<code class="language-plaintext highlighter-rouge">nonlocal</code>å…³é”®å­—è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_withdraw</span><span class="p">(</span><span class="n">balance</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">withdraw</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">balance</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&gt;</span> <span class="n">balance</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">'Insufficient funds'</span>
        <span class="n">balance</span> <span class="o">=</span> <span class="n">balance</span> <span class="o">-</span> <span class="n">amount</span>
        <span class="k">return</span> <span class="n">balance</span>
    <span class="k">return</span> <span class="n">withdraw</span>

<span class="n">wd</span> <span class="o">=</span> <span class="n">make_withdraw</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">wd</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div></div>

<h2 id="f20-lecture-17-iterator--generator">F20 Lecture 17 (Iterator &amp; Generator)</h2>

<h3 id="iterator">Iterator</h3>

<ul>
  <li>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">iter</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span><span class="o">-</span><span class="n">è¿”å›è¿­ä»£å™¨å¯¹è±¡</span>
<span class="nb">next</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span><span class="o">-</span><span class="n">å–å‡ºå…¶ä¸­çš„å€¼</span>
</code></pre></div>    </div>
  </li>
  <li>
    <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Dictionary Iteration
</span>  
<span class="nb">iter</span><span class="p">(</span><span class="n">dic</span><span class="p">.</span><span class="n">keys</span><span class="p">())</span>
<span class="nb">iter</span><span class="p">(</span><span class="n">dic</span><span class="p">.</span><span class="n">values</span><span class="p">())</span>
<span class="nb">iter</span><span class="p">(</span><span class="n">dic</span><span class="p">.</span><span class="n">items</span><span class="p">())</span>
</code></pre></div>    </div>
  </li>
  <li>Built-in Functions for Iteration</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/20210804225957.png" alt="image-20210804225950289" style="zoom:50%;" /></p>

<ul>
  <li>è¿­ä»£å™¨å¯¹è±¡åœ¨è¢«è¯»å–å…ƒç´ ä¹‹åï¼Œå³ä¼šå°†è¢«è¯»å–çš„å…ƒç´ ä»è¿­ä»£å™¨å¯¹è±¡ä¸­å»é™¤</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">t</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>è‹¥å­—å…¸å·²è¢«å¼€å§‹è¯»å–ï¼Œåˆ™ä¸­é€”ä¸å¯ä»¥æ”¹å˜<code class="language-plaintext highlighter-rouge">size</code>ï¼Œä½†æ˜¯å¯ä»¥æ”¹å˜æœªè¯»å–å…ƒç´ çš„å€¼</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s">'one'</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s">'two'</span><span class="p">:</span><span class="mi">2</span><span class="p">}</span>
<span class="n">k</span><span class="o">=</span><span class="nb">iter</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="c1"># ä¸‹è¾¹è¿™å¥ä¼šæŠ¥é”™ï¼Œdictionary changed size during iteration
</span>
<span class="n">d</span><span class="p">[</span><span class="s">'zero'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></div>

<ul>
  <li>forå¾ªç¯æ—¢å¯ä»¥éå†<code class="language-plaintext highlighter-rouge">list</code>ï¼Œä¹Ÿå¯ä»¥éå†è¿­ä»£å™¨ï¼Œä½†æ˜¯è¿­ä»£å™¨åœ¨éå†å®Œæ¯•ä¹‹åä¸èƒ½å†æ¬¡ä½¿ç”¨äº†</li>
</ul>

<hr />

<p>To better understand the iterator, here is an example in the disc:</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108052149343.png" alt="image-20210805214941253" style="zoom:50%;" /></p>

<h3 id="generator">Generator</h3>

<p><strong>yieldè¿”å›ç»™è°ƒç”¨è€…ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</strong></p>

<p><code class="language-plaintext highlighter-rouge">generator function is a function that yields values instead of returning them</code></p>

<p><code class="language-plaintext highlighter-rouge">A normal function returns once; a generator function can yield multiple times</code></p>

<p><code class="language-plaintext highlighter-rouge">A generator is an iterator created automatically by calling a generator function</code></p>

<p><code class="language-plaintext highlighter-rouge">When a generator function is called, it returns a generator that iterates over its yields</code></p>

<p>åœ¨é‡åˆ°<code class="language-plaintext highlighter-rouge">yield</code>æ—¶ï¼Œç¨‹åºä¼šæš‚åœï¼ˆä¿å­˜å±€éƒ¨å˜é‡ï¼‰ï¼Œæ‰€ä»¥æ¯æ¬¡æ‰§è¡Œï¼Œéƒ½åªä¼šæ‰§è¡Œä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plus_minus</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">yield</span> <span class="n">x</span>
    <span class="k">yield</span> <span class="o">-</span><span class="n">x</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">plus_minus</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">next</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="o">-</span><span class="mi">3</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">yield from</code>ä»ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡æˆ–è€…è¿­ä»£å™¨ä¸­<code class="language-plaintext highlighter-rouge">yield</code>æ‰€æœ‰å€¼</p>

<h4 id="yield--recursion">Yield &amp; Recursion<a id="anchor11"></a></h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">yield</span> <span class="k">from</span> <span class="n">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">yield</span> <span class="n">s</span>
</code></pre></div></div>

<p>ä¸ºäº†æ›´åŠ æ·±åˆ»çš„ç†è§£<code class="language-plaintext highlighter-rouge">yield</code>ï¼Œæˆ‘ä»¬å¯ä»¥å±•å¼€åˆ†æä¸€ä¸‹ä¸Šè¾¹è¿™ä¸ªç®€å•çš„é€’å½’ï¼š</p>

<p>é¦–å…ˆå†™æˆæ ‡å‡†<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯çš„å½¢å¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="k">yield</span> <span class="n">x</span>
        <span class="k">yield</span> <span class="n">s</span>
</code></pre></div></div>

<p>æ¯ä¸€æ¬¡å‡½æ•°è¿”å›ï¼Œéƒ½ä¼šæŠŠå‡½æ•°ä½“ä¸­æ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">generator</code>å¯¹è±¡ä¼ é€’å›å»ï¼Œå¹¶ä¸”åœ¨ä¸Šä¸€çº§å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œç”Ÿæˆå™¨å¯¹è±¡åˆå¤šäº†ä¸€ä¸ªï¼ˆ<code class="language-plaintext highlighter-rouge">yield s</code>ï¼‰ï¼Œé€æ¬¡é€’å¢ã€‚</p>

<p>å¦‚æœä¸ä½¿ç”¨<code class="language-plaintext highlighter-rouge">yield</code>ï¼Œä¹Ÿå¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">prefixes</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<p><strong>è¿™æ˜¯ä¸€ç§å¸¸è§çš„é€æ¬¡å‡å°‘ï¼ˆå¢å¤šï¼‰é¡ºåºæ‰“å°å­—ç¬¦é—®é¢˜ï¼Œåœ¨ä»£ç ä¸­æœªä½¿ç”¨é€’å½’çš„å•ç‹¬è¯­å¥å¯ä»¥è¢«è§†ä¸º<code class="language-plaintext highlighter-rouge">base case</code>ï¼Œå…¶ä½ç½®å†³å®šäº†æˆ‘ä»¬æ‰“å°å­—ç¬¦çš„é¡ºåº</strong>ï¼Œå› ä¸ºæ¯ä¸€æ¬¡é€’å½’éƒ½è¦å»æ‰ä¸€ä¸ªæœ«å°¾çš„å­—ç¬¦ï¼Œ<strong>è€Œæœ€ç»ˆè¦å¾—åˆ°æ‰€æœ‰çš„é€æ¬¡è¾“å‡ºç»“æœï¼Œæ‰€ä»¥åº”è¯¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯çš„å½¢å¼ï¼Œé€’å½’<code class="language-plaintext highlighter-rouge">prefixes(s[:-1])</code></strong></p>

<h5 id="a-difficult-questionhw-04">A difficult Questionï¼ˆHW 04ï¼‰</h5>

<p>æœ‰äº†ä¸Šè¾¹ä½¿ç”¨<code class="language-plaintext highlighter-rouge">yield</code>åšé€’å½’çš„ç»éªŒï¼Œæ¥çœ‹è¿™æ ·ä¸€é“é¢˜ï¼š</p>

<blockquote>
  <h3 id="q4-generate-permutations">Q4: Generate Permutations</h3>

  <p>Given a sequence of unique elements, a <em>permutation</em> of the sequence is a list containing the elements of the sequence in some arbitrary order. For example, <code class="language-plaintext highlighter-rouge">[2, 1, 3]</code>, <code class="language-plaintext highlighter-rouge">[1, 3, 2]</code>, and <code class="language-plaintext highlighter-rouge">[3, 2, 1]</code> are some of the permutations of the sequence <code class="language-plaintext highlighter-rouge">[1, 2, 3]</code>.</p>

  <p>Implement <code class="language-plaintext highlighter-rouge">permutations</code>, a generator function that takes in a sequence <code class="language-plaintext highlighter-rouge">seq</code> and returns a generator that yields all permutations of <code class="language-plaintext highlighter-rouge">seq</code>.</p>

  <p>Permutations may be yielded in any order. Note that the doctests test whether you are yielding all possible permutations, but not in any particular order. The built-in <code class="language-plaintext highlighter-rouge">sorted</code> function takes in an iterable object and returns a list containing the elements of the iterable in non-decreasing order.</p>

  <blockquote>
    <p><em>Hint:</em> If you had the permutations of all the elements in <code class="language-plaintext highlighter-rouge">seq</code> not including the first element, how could you use that to generate the permutations of the full <code class="language-plaintext highlighter-rouge">seq</code>?</p>

    <p><em>Hint:</em> If youâ€™re having trouble getting started, see the hints video for this question for tips on how to approach this question.</p>
  </blockquote>
</blockquote>

<p>è¿™é“é¢˜ç›®çš„è§£é¢˜æ€è·¯æœ‰å¾ˆå¤šï¼Œè¯´ä¸¤ç§è§£æ³•ï¼š</p>

<h6 id="è§£æ³•1">è§£æ³•1</h6>

<p>å…ˆæ’<code class="language-plaintext highlighter-rouge">permutations</code>çš„ç¬¬ä¸€ä¸ªä½ç½®ï¼Œæœ‰<code class="language-plaintext highlighter-rouge">1,2,3</code>ä¸‰ç§æ–¹å¼ï¼Œåœ¨æ’å®Œç¬¬ä¸€ä½åï¼Œé—®é¢˜è½¬åŒ–æˆä¸ºä½™ä¸‹ä¸¤ä¸ªæ•°å­—çš„<code class="language-plaintext highlighter-rouge">permutations</code>é—®é¢˜ã€‚ä¸ä¹‹å‰ä¸€æ ·ï¼Œå› ä¸ºæˆ‘ä»¬è¦å¾—åˆ°æ‰€æœ‰çš„å¯èƒ½æ€§ï¼Œæ¯”å¦‚åœ¨ç¡®å®šäº†ç¬¬ä¸€ä½ä¸º<code class="language-plaintext highlighter-rouge">1</code>åï¼Œå­˜åœ¨<code class="language-plaintext highlighter-rouge">[1,2,3]</code>ä¸<code class="language-plaintext highlighter-rouge">[1,3,2]</code>ä¸¤ç§æƒ…å†µï¼Œå…¨éƒ¨éœ€è¦ä¿å­˜ï¼Œæ•…è¿˜æ˜¯ç”¨ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯æ¥è¿›è¡Œé€’å½’å¤„ç†,é¢˜ç›®æ¡†æ¶åº”ä¸ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">permutations</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="c1"># base case
</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">seq</span><span class="p">:</span>
    	<span class="k">yield</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># å…ˆé€‰å®šç¬¬ä¸€ä¸ªä½ç½®
</span>        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># ä¹Ÿå¯ä»¥å†™æˆï¼šrest = [seq[j] for j in range(len(s)) if i != j]
</span>            
            <span class="n">rest</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">seq</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">rest_permutation</span> <span class="ow">in</span> <span class="n">premutations</span><span class="p">(</span><span class="n">rest</span><span class="p">):</span>
                <span class="k">yield</span> <span class="p">[</span><span class="n">start</span><span class="p">]</span> <span class="o">+</span> <span class="n">rest_permutation</span>        
</code></pre></div></div>

<h6 id="è§£æ³•2">è§£æ³•2</h6>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨<code class="language-plaintext highlighter-rouge">insert</code>çš„æ€è·¯æ¥çœ‹å¾…è¿™é“é¢˜ç›®ï¼Œæ¯”å¦‚å…ˆç¡®å®š<code class="language-plaintext highlighter-rouge">2,3</code>çš„å…ˆåé¡ºåºï¼Œå³å…ˆ<code class="language-plaintext highlighter-rouge">permutate (n-1)ä¸ª</code>ï¼Œå†å°†<code class="language-plaintext highlighter-rouge">1</code>æ’ç©ºï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">permutations</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">seq</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rest</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">for</span> <span class="n">rest_permutation</span> <span class="ow">in</span> <span class="n">permutations</span><span class="p">(</span><span class="n">rest</span><span class="p">):</span>
            <span class="c1"># é€‰ç©ºæ’å…¥
</span>            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)):</span>
                <span class="k">yield</span> <span class="n">rest_permutation</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">first</span><span class="p">]</span> <span class="o">+</span> <span class="n">rest_permutation</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
                <span class="c1"># æˆ–è€…å†™ä½œï¼š
</span>                
                <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rest_permutation</span><span class="p">)</span>
                <span class="n">result</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">first</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">result</span>
</code></pre></div></div>

<h5 id="notice">NOTICE!</h5>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">filter_link</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">yield</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
    <span class="c1"># ä¸ä¼šå¦‚æœŸæ‰§è¡Œifè¯­å¥    
</span>        
    <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">first</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">link</span><span class="p">.</span><span class="n">first</span>
        <span class="n">filter_link</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filter_link</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>


<span class="n">link</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">)))</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">filter_link</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</code></pre></div></div>

<p>ä¸Šè¾¹è¿™ä¸ªå‡½æ•°çš„æ‰§è¡Œç»“æœå¹¶ä¸ä¼šå¦‚é¢„æœŸï¼Œ<code class="language-plaintext highlighter-rouge">f(link.first)</code>ä»…ä¼šåœ¨ç¬¬ä¸€æ¬¡è¿è¡Œæ—¶æ‰§è¡Œï¼Œä¹‹åçš„é€’å½’è¿‡ç¨‹ä¸ä¼šæ‰§è¡Œè¯¥å‡½æ•°ï¼ŒåŸå› æ˜¯å› ä¸ºå‡½æ•°æ•´ä½“ä¸­å«æœ‰<code class="language-plaintext highlighter-rouge">yield</code>ï¼Œå®ƒçš„è¿è¡Œä¸ä¼šå’Œæ™®é€šå‡½æ•°ä¸€æ ·ï¼Œæ¯æ¬¡<code class="language-plaintext highlighter-rouge">filter_link</code>çš„è¿”å›å€¼éƒ½æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">generator object</code>ï¼Œé™¤éæˆ‘ä»¬è¿­ä»£è¯¥ç”Ÿæˆå™¨å¯¹è±¡ï¼Œå¦åˆ™å…¶ä¸­çš„å†…å®¹å‡ä¸ä¼šæ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å†è¿›å…¥ä¸‹ä¸€ä¸ªé€’å½’åï¼Œè¯¥å‡½æ•°æ ¹æœ¬ä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Œæ‰€ä»¥è‡ªç„¶ä¸ä¼šè¿›å…¥<code class="language-plaintext highlighter-rouge">if</code>åˆ¤æ–­è¯­å¥äº†ã€‚</p>

<h2 id="f20-lecture-18-classes">F20 Lecture 18 (Classes)</h2>

<p>åœ¨è®¾è®¡ç±»æ—¶å‡ ä¸ªéœ€è¦æ³¨æ„çš„äº‹é¡¹ï¼š</p>

<h3 id="init-method"><strong>init</strong> method</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108051645833.png" alt="image-20210805164532691" style="zoom:50%;" /></p>

<h3 id="accessing-attributes">Accessing Attributes</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108051648180.png" alt="image-20210805164817037" style="zoom:50%;" /></p>

<h3 id="bound-methods">Bound methods</h3>

<p>å½“è¿›è¡Œå®ä¾‹è°ƒç”¨æ—¶ï¼Œéšå¼åœ°å°†å®ä¾‹åç§°ç»‘å®šåˆ°ç±»æ–¹æ³•çš„<code class="language-plaintext highlighter-rouge">self</code>å‚æ•°ä¸Šï¼Œæ¯”å¦‚ç°åœ¨æœ‰ä¸€ä¸ªç±»<code class="language-plaintext highlighter-rouge">Account</code>ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">method</code>åä¸º<code class="language-plaintext highlighter-rouge">deposit</code>ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è°ƒç”¨è¯¥æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># as a function
</span>
<span class="n">Account</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">spock_account</span><span class="p">,</span> <span class="mi">1001</span><span class="p">)</span>
<span class="c1"># as a bound method
</span>
<span class="n">spock_account</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="evaluating-a-dot-expression">Evaluating a dot expression</h3>

<blockquote>
  <expression> . <name>
</name></expression>
</blockquote>

<ol>
  <li>Evaluate the <expression> to the left of the dot, which yields the object of
the dot expression</expression></li>
  <li>
    <name> is matched against the instance attributes of that object; if an
attribute with that name exists, its value is returned
</name>
  </li>
  <li>If not, <name> is looked up in the class, which yields a class attribute value</name></li>
  <li>That value is returned unless it is a function, in which case a bound method is
returned instead</li>
</ol>

<blockquote>
  <p>å…ˆåœ¨å®ä¾‹å½“ä¸­å¯»æ‰¾å¯¹åº”çš„å±æ€§ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå†åˆ°ç±»å®ç°ä¸­å¯»æ‰¾</p>
</blockquote>

<h3 id="class-attributes">Class Attributes</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Account</span><span class="p">:</span>
    <span class="n">interest</span> <span class="o">=</span> <span class="mf">0.02</span> 
    <span class="c1"># A class attribute
</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">account_holder</span><span class="p">):</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">balance</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">holder</span> <span class="o">=</span> <span class="n">account_holder</span>
    <span class="c1"># Additional methods would be defined here
</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tom_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Tom'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jim_account</span> <span class="o">=</span> <span class="n">Account</span><span class="p">(</span><span class="s">'Jim'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">tom_account</span><span class="p">.</span><span class="n">interest</span>
<span class="mf">0.02</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">jim_account</span><span class="p">.</span><span class="n">interest</span>
<span class="mf">0.02</span>
</code></pre></div></div>

<blockquote>
  <p>ä½†æ˜¯è€ƒè™‘åˆ°<code class="language-plaintext highlighter-rouge">dot expression</code>çš„å®ç°è¿‡ç¨‹ï¼ˆ2 &amp; 3ï¼‰ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ç¤ºä¾‹ä¸­çš„<code class="language-plaintext highlighter-rouge">class attribute</code>è¿›è¡Œæ›´æ”¹ï¼Œåˆ™æ­¤åç›´æ¥æ›´æ”¹<code class="language-plaintext highlighter-rouge">class attribute</code>ä¸ä¼šå¯¹æ­¤å®ä¾‹ä¸­çš„è¯¥<code class="language-plaintext highlighter-rouge">attribute</code>é€ æˆä»»ä½•å½±å“:</p>
</blockquote>

<blockquote>
  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">kirk_account</span><span class="p">.</span><span class="n">interest</span> <span class="o">=</span> <span class="mf">0.08</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kirk_account</span><span class="p">.</span><span class="n">interest</span>
<span class="mf">0.08</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">spock_account</span><span class="p">.</span><span class="n">interest</span>
<span class="mf">0.04</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Account</span><span class="p">.</span><span class="n">interest</span> <span class="o">=</span> <span class="mf">0.05</span>  
<span class="c1"># changing the class attribute
</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">spock_account</span><span class="p">.</span><span class="n">interest</span>     
<span class="c1"># changes instances without like-named instance attributes
</span>
<span class="mf">0.05</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">kirk_account</span><span class="p">.</span><span class="n">interest</span>     
<span class="c1"># but the existing instance attribute is unaffected
</span>
<span class="mf">0.08</span>
</code></pre></div>  </div>
</blockquote>

<blockquote>
  <p>classä¹Ÿå¯ä»¥è®¾ç«‹<code class="language-plaintext highlighter-rouge">@staticmethod</code>æ–¹æ³•ï¼Œå¯ä»¥ç†è§£ä¸ºC++ç±»ä¸­çš„é™æ€æˆå‘˜å‡½æ•°</p>
</blockquote>

<h2 id="f20-lecture-19-classes-attributes--inheritance">F20 Lecture 19 (Classes-Attributes &amp; Inheritance)</h2>

<h3 id="assignments-to-attributes">Assignments to Attributes</h3>

<p>å½“æˆ‘ä»¬å¯¹<code class="language-plaintext highlighter-rouge">instance</code>çš„<code class="language-plaintext highlighter-rouge">attributes</code>è¿›è¡Œèµ‹å€¼æ“ä½œæ—¶ï¼Œé¦–å…ˆä¼šåœ¨æœ¬<code class="language-plaintext highlighter-rouge">instance</code>å†…å¯»æ‰¾æ˜¯å¦å­˜åœ¨è¯¥<code class="language-plaintext highlighter-rouge">attribute</code>ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å»æ‰¾å¯¹åº”çš„<code class="language-plaintext highlighter-rouge">class attribute</code>ï¼Œæˆ–è€…æ˜¯åœ¨ç»§æ‰¿å…³ç³»å½“ä¸­çš„çˆ¶ç±»çš„<code class="language-plaintext highlighter-rouge">attribute</code>ï¼Œå†æŠŠæ‰¾åˆ°çš„<code class="language-plaintext highlighter-rouge">attribute</code>åŠ å…¥ä¸€å¼€å§‹çš„<code class="language-plaintext highlighter-rouge">instance</code>å½“ä¸­ã€‚åä¹‹å¦‚æœ<code class="language-plaintext highlighter-rouge">instance</code>ä¸­å·²ç»å»ºç«‹äº†è¯¥<code class="language-plaintext highlighter-rouge">attribute</code>ï¼Œåˆ™ç›´æ¥å¯¹å…¶è¿›è¡Œæ›´æ”¹ã€‚</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071820732.png" alt="image-20210807182024595" style="zoom:50%;" /></p>

<h3 id="inheritance">Inheritance</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071821040.png" alt="image-20210807182154909" style="zoom:50%;" /></p>

<p>åœ¨è®¾è®¡ç»§æ‰¿æ—¶ï¼Œè¦å°½é‡åšåˆ°<code class="language-plaintext highlighter-rouge">Look up attributes on instances whenever possible</code>ï¼Œå¦‚æœæ­¤ä¾‹ä¸­ä½¿ç”¨çš„æ˜¯<code class="language-plaintext highlighter-rouge">withdraw</code>è€Œé<code class="language-plaintext highlighter-rouge">self.withdraw</code>ï¼Œåˆ™å‡å®šæœ‰ä¸€æ‰¹ç±»å®ä¾‹ï¼Œç°åœ¨æƒ³æ›´æ”¹å…¶ä¸­æŸä¸€ä¸ªå®ä¾‹ä¸­çš„<code class="language-plaintext highlighter-rouge">withdraw_fee</code>ï¼Œæ˜¯ä¸å¯å®ç°çš„ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰æ›´æ”¹ç±»å®ç°ä¸­çš„<code class="language-plaintext highlighter-rouge">withdraw_fee</code>å€¼æ‰å¯ä»¥å¯¹ç»“æœåšå‡ºæ”¹å˜ï¼Œè€Œè¿™å°†å½±å“æ‰€æœ‰çš„ç±»å®ä¾‹ç»“æœã€‚</p>

<p>åœ¨ç»§æ‰¿å…³ç³»ä¸­å¯»æ‰¾<code class="language-plaintext highlighter-rouge">attribute</code>ä¹Ÿæ˜¯ä¸Šä¸ªå°èŠ‚ä¸€æ ·çš„é“ç†ï¼Œåªæ˜¯è¦æ³¨æ„<strong>åŸºç±»çš„<code class="language-plaintext highlighter-rouge">attributes</code>ä¸ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å­ç±»çš„å®ç°ä¸­ã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œå¯¹äºä¸€ä¸ªå­ç±»å®ä¾‹ï¼Œè‹¥è°ƒç”¨äº†çˆ¶ç±»çš„æŸ<code class="language-plaintext highlighter-rouge">attribute</code>ï¼Œåˆ™ç¨‹åºä¼šåˆ°çˆ¶ç±»ä¸­æ‰¾åˆ°è¯¥<code class="language-plaintext highlighter-rouge">attribute</code>ï¼Œå¹¶å°†å…¶åŠ å…¥æ­¤å­ç±»å®ä¾‹ä¸­ï¼Œä¸ä¹‹å‰çš„ä»<code class="language-plaintext highlighter-rouge">instance</code>æ‰¾<code class="language-plaintext highlighter-rouge">class attribute</code>æ˜¯ç±»ä¼¼çš„æµç¨‹</strong>ã€‚</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071823491.png" alt="image-20210807182333407" style="zoom:50%;" /></p>

<h4 id="inheritance--composition">Inheritance &amp; Composition</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071832455.png" alt="image-20210807183243354" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bank</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">accounts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">open_account</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">holder</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">Account</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="n">kind</span><span class="p">(</span><span class="n">holder</span><span class="p">)</span>
        <span class="n">account</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
        <span class="c1"># Composition
</span>        
        <span class="bp">self</span><span class="p">.</span><span class="n">account</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">account</span>
    <span class="k">def</span> <span class="nf">pay_interest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">accounts</span><span class="p">:</span>
            <span class="n">a</span><span class="p">.</span><span class="n">deposit</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">balance</span> <span class="o">*</span> <span class="n">a</span><span class="p">.</span><span class="n">interest</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="an-example">An Example</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071837971.png" alt="image-20210807183715824" style="zoom:50%;" /></p>

<p>è¿™é‡Œæ³¨æ„ä¸¤ä¸ªç‚¹ï¼š</p>

<ol>
  <li>åœ¨å­˜åœ¨ç»§æ‰¿å…³ç³»æ—¶ï¼ŒæŸä¸€æ­¥ä¸­çš„<code class="language-plaintext highlighter-rouge">self</code>ç©¶ç«ŸæŒ‡ä»£è°</li>
  <li><code class="language-plaintext highlighter-rouge">C(2)</code>æ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">instance</code>ï¼Œæ‰¾åˆ°çˆ¶ç±»<code class="language-plaintext highlighter-rouge">B</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">__init___</code>ï¼Œ<code class="language-plaintext highlighter-rouge">self</code>æ­¤æ—¶æŒ‡ä»£<code class="language-plaintext highlighter-rouge">C</code>ï¼Œå¹¶æŠŠçˆ¶ç±»<code class="language-plaintext highlighter-rouge">B</code>çš„<code class="language-plaintext highlighter-rouge">z attribute</code>åŠ å…¥åˆ©ç”¨<code class="language-plaintext highlighter-rouge">C(2)</code>åˆ›å»ºçš„<code class="language-plaintext highlighter-rouge">C instance</code>ä¸­</li>
</ol>

<h4 id="multiple-inheritance">Multiple Inheritance</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071844847.png" alt="image-20210807184401725" style="zoom:50%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108071844530.png" alt="image-20210807184420455" style="zoom:50%;" /></p>

<p>å¦‚æœå¤šä¸ªçˆ¶ç±»ä¸­å­˜åœ¨ç›¸åŒçš„<code class="language-plaintext highlighter-rouge">Attribute</code>è¯¥æ€ä¹ˆåŠï¼Ÿ</p>

<blockquote>
  <p>In multiple inheritance, the attribute is first looked up in the current class. If it fails (which it does in this case since AsSeenOnTVAccount has no interest attribute), then the next place to search is in the parent class, and so on. If there are multiple parent classes (which there are in this case: CheckingAccount, SavingsAccount), then it returns the first one it finds by depth-first going from left to right between the parents.</p>
</blockquote>

<p>å¯ä»¥ç”¨ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è¯¥é—®é¢˜ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Employee</span><span class="p">():</span>
    <span class="n">test1</span> <span class="o">=</span><span class="mi">1</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span>  <span class="c1"># the employee id
</span>
<span class="k">class</span> <span class="nc">Student</span><span class="p">():</span>
    <span class="n">test1</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">test</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">test1</span> <span class="o">=</span> <span class="n">test</span>
        <span class="bp">self</span><span class="p">.</span><span class="nb">id</span> <span class="o">=</span> <span class="nb">id</span>  <span class="c1"># the student id, different from employee id
</span>
<span class="k">class</span> <span class="nc">firm</span><span class="p">(</span><span class="n">Employee</span><span class="p">,</span><span class="n">Student</span><span class="p">):</span>
    <span class="n">test1</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Eid</span><span class="p">,</span><span class="n">Sid</span><span class="p">,</span><span class="n">test</span><span class="p">):</span>
        <span class="n">Employee</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Eid</span><span class="p">)</span>
        <span class="n">Student</span><span class="p">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Sid</span><span class="p">,</span><span class="n">test</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">firm</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">test1</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="nb">id</span><span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>é¦–å…ˆå¯¹äº<strong>ä¸¤ä¸ªå­ç±»çš„åŒåçš„<code class="language-plaintext highlighter-rouge">instance attribute</code></strong>ï¼Œè·å–åˆ°çš„è¡¨è¾¾å¼å€¼<strong>å–å†³äºçˆ¶ç±»åˆå§‹åŒ–çš„é¡ºåº</strong>ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">firm</code>ç±»ä¸­ï¼Œå¦‚æœå…ˆåˆå§‹åŒ–<code class="language-plaintext highlighter-rouge">Employee</code>ï¼Œåˆ™<code class="language-plaintext highlighter-rouge">result.id</code>ä¸º<code class="language-plaintext highlighter-rouge">Employee</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">id</code>å€¼ï¼Œåä¹‹ä¸º<code class="language-plaintext highlighter-rouge">Student</code>ã€‚</li>
  <li>å¦‚æœ<strong>çˆ¶ç±»ä¸­çš„<code class="language-plaintext highlighter-rouge">class attribute</code>ä¸<code class="language-plaintext highlighter-rouge">instance attribute</code>åŒæ—¶å­˜åœ¨ï¼Œä¸”åŒå</strong>ï¼Œå½“æˆ‘ä»¬è¯•å›¾è·å–å­ç±»ä¸­ä¸å­˜åœ¨ä½†åœ¨çˆ¶ç±»ä¸­å­˜åœ¨çš„<code class="language-plaintext highlighter-rouge">attribute</code>æ—¶ï¼Œä¼šé¦–<strong>å…ˆè€ƒè™‘<code class="language-plaintext highlighter-rouge">class attribute</code></strong>ï¼Œå› ä¸ºå­ç±»å»ºç«‹æ—¶å°±å·²ç»æ¥å—äº†<code class="language-plaintext highlighter-rouge">Student</code>å’Œ<code class="language-plaintext highlighter-rouge">Employee</code>ä¸¤ä¸ªçˆ¶ç±»åå‚æ•°ï¼Œæ­¤åæ‰è°ƒç”¨äº†<code class="language-plaintext highlighter-rouge">__init__</code>æ–¹æ³•ã€‚</li>
  <li>å¦‚æœ<strong>å¤šä¸ªçˆ¶ç±»ä¸­çš„åŒåçš„<code class="language-plaintext highlighter-rouge">class attribute</code></strong>ï¼Œè·å–åˆ°çš„è¡¨è¾¾å¼çš„æ–¹æ³•æ˜¯ä»å·¦å‘å³æœç´¢ç»§æ‰¿çš„çˆ¶ç±»åå­—ï¼Œä¹Ÿå³ä¸Šè¾¹çš„è‹±æ–‡è§£é‡Šæ‰€å¯¹åº”çš„æ–¹æ³•ã€‚</li>
</ol>

<h2 id="f20-lecture-20-representation">F20 Lecture 20 (Representation)</h2>

<h3 id="string-representations">String Representations</h3>

<h4 id="str">str</h4>

<p>å¯¹åº”ç€<code class="language-plaintext highlighter-rouge">print</code>å‡½æ•°æ‰“å°çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯æ–¹ä¾¿äººç±»é˜…è¯»</p>

<h4 id="repr">repr</h4>

<p>å¯¹åº”ç€<code class="language-plaintext highlighter-rouge">interative python</code>ä¸­æ‰“å°çš„æ–¹æ³•ï¼Œç›®çš„æ˜¯æ–¹ä¾¿ç¨‹åºé˜…è¯»</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">half</span> <span class="o">=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">repr</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>
<span class="s">'Fraction(1, 2)'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">str</span><span class="p">(</span><span class="n">half</span><span class="p">)</span>
<span class="s">'1/2'</span>
</code></pre></div></div>

<h3 id="polymorphic-functions">Polymorphic Functions</h3>

<p><code class="language-plaintext highlighter-rouge">str</code>ä¸<code class="language-plaintext highlighter-rouge">repr</code>é€šè¿‡åœ¨å†…éƒ¨å®ç°å¹¶è°ƒç”¨<code class="language-plaintext highlighter-rouge">__repr__</code>å’Œ<code class="language-plaintext highlighter-rouge">__str__</code>æ–¹æ³•ï¼Œå¯ä»¥å¯¹å¤šç§æ•°æ®ç±»å‹æ“ä½œï¼ˆç±»ä¼¼äºC++ä¸­çš„æ“ä½œç¬¦é‡è½½ï¼‰</p>

<p>å®ç°çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108092151148.png" alt="image-20210809215140985" style="zoom:50%;" /></p>

<h3 id="interfaces">Interfaces</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108092152303.png" alt="image-20210809215216177" style="zoom:50%;" /></p>

<p>æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°æ­¤ç±»æ“ä½œç¬¦é‡è½½ï¼ˆ<code class="language-plaintext highlighter-rouge">interface</code>ï¼‰ï¼Œè¿™æ ·åœ¨ç¨‹åºè°ƒç”¨<code class="language-plaintext highlighter-rouge">repr</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">str</code>æ—¶ï¼Œå°±ä¼šä½¿ç”¨æˆ‘ä»¬çš„æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Bear</span><span class="p">():</span>
    <span class="s">'''A Bear'''</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__repr__</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s">'oski'</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">__str__</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="s">'this bear'</span>
        
    <span class="k">def</span> <span class="nf">__repr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'Bear()'</span>
    
    <span class="k">def</span> <span class="nf">__str</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'a bear'</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">oski</span> <span class="o">=</span> <span class="n">Bear</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">oski</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="n">bear</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">oski</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="n">bear</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">oski</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Bear</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">oski</span><span class="p">.</span><span class="n">__str__</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">this</span> <span class="n">bear</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">oski</span><span class="p">.</span><span class="n">__repr__</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">oski</span>
</code></pre></div></div>

<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªè¡Œå®ç°<code class="language-plaintext highlighter-rouge">str</code>ä¸<code class="language-plaintext highlighter-rouge">repr</code>æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">repr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="c1"># å› ä¸ºæ˜¯class attribute
</span>    
    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">).</span><span class="n">__repr__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">str</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="s">'__str__'</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">__str__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="special-method-names-in-python--example">Special Method Names in Python &amp; Example</h3>

<p>ä¸€ä¸ªæ›´ç»¼åˆçš„ä¾‹å­ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Ratio</span><span class="err">ï¼š</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">numer</span> <span class="o">=</span> <span class="n">n</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">denom</span> <span class="o">=</span> <span class="n">d</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'Ratio({0},{1})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">numer</span><span class="p">,</span><span class="bp">self</span><span class="p">.</span><span class="n">denom</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'{0}/{1}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">numer</span><span class="p">,</span><span class="bp">self</span><span class="p">.</span><span class="n">denom</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">numer</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">denom</span> <span class="o">+</span> <span class="n">other</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">denom</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Ratio</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">numer</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">denom</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">denom</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">numer</span>
            <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">denom</span> <span class="o">*</span> <span class="n">other</span><span class="p">.</span><span class="n">denom</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">gcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Ratio</span><span class="p">(</span><span class="n">n</span><span class="o">//</span><span class="n">g</span><span class="p">,</span> <span class="n">d</span><span class="o">//</span><span class="n">g</span><span class="p">)</span>
    <span class="c1"># ä»¤å†…ç½®æ–¹æ³•ç­‰ä»·
</span>    
    <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>
    
    <span class="k">def</span> <span class="nf">__float__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">.</span><span class="n">numer</span> <span class="o">/</span> <span class="bp">self</span><span class="p">.</span><span class="n">denom</span>

<span class="c1"># è¾—è½¬ç›¸é™¤æ³•æ±‚æœ€å¤§å…¬çº¦æ•°
</span>
<span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">d</span><span class="p">:</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></div>

<h2 id="f20-lecture-21-linked-lists--trees">F20 Lecture 21 (Linked Lists &amp; Trees)</h2>

<ul>
  <li><code class="language-plaintext highlighter-rouge">isinstance</code>ï¼š<code class="language-plaintext highlighter-rouge">Return whether an object is an instance of a class or of a subclass thereof.</code></li>
</ul>

<h3 id="linked-lists-implementation-recursion">Linked Lists Implementation (Recursion)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Link</span><span class="p">:</span>
    <span class="s">"""A linked list."""</span>
    <span class="n">empty</span> <span class="o">=</span> <span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">empty</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">rest</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">Link</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">first</span> <span class="o">=</span> <span class="n">first</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">rest</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">rest</span><span class="p">:</span>
            <span class="n">rest_repr</span> <span class="o">=</span> <span class="s">', '</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rest_repr</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="s">'Link('</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="n">rest_repr</span> <span class="o">+</span> <span class="s">')'</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">string</span> <span class="o">=</span> <span class="s">'&lt;'</span>
        <span class="k">while</span> <span class="bp">self</span><span class="p">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s">' '</span>
            <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">rest</span>
        <span class="k">return</span> <span class="n">string</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s">'&gt;'</span>


<span class="n">square</span><span class="p">,</span> <span class="n">odd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>
<span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="nb">filter</span><span class="p">(</span><span class="n">odd</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">))))</span>  <span class="c1"># [1, 9, 25]
</span>

<span class="k">def</span> <span class="nf">range_link</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="s">"""Return a Link containing consecutive integers from start to end."""</span>    
    <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;=</span> <span class="n">end</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">range_link</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">map_link</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="s">"""Return a Link that contains f(x) for each x in Link s."""</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">first</span><span class="p">),</span> <span class="n">map_link</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">filter_link</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="s">"""Return a Link that contains only the elements x of Link s for which f(x)
    is a true value."""</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="n">filtered_rest</span> <span class="o">=</span> <span class="n">filter_link</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">first</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">filtered_rest</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">filtered_rest</span>


<span class="n">map_link</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">filter_link</span><span class="p">(</span><span class="n">odd</span><span class="p">,</span> <span class="n">range_link</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>  <span class="c1"># Link(1, Link(9, Link(25)))
</span>

<span class="s">"""test1"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="o">&lt;</span><span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">first</span>
<span class="mi">3</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">first</span>
<span class="mi">4</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">first</span> <span class="o">=</span> <span class="mi">6</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">s</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="o">&lt;</span><span class="mi">6</span> <span class="mi">7</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span>
<span class="o">&lt;</span><span class="mi">7</span><span class="o">&gt;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="n">Link</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">)),</span> <span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">)))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="o">&lt;</span><span class="mi">1</span> <span class="o">&lt;</span><span class="mi">2</span> <span class="mi">3</span><span class="o">&gt;</span> <span class="mi">4</span><span class="o">&gt;</span>

<span class="s">"""test2"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">range_link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">)))</span>

<span class="s">"""test3"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">map_link</span><span class="p">(</span><span class="n">square</span><span class="p">,</span> <span class="n">range_link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">25</span><span class="p">)))</span>

<span class="s">"""test4"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">filter_link</span><span class="p">(</span><span class="n">odd</span><span class="p">,</span> <span class="n">range_link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">Link</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">Link</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">__repr__</code>å‡½æ•°è¿˜æœ‰å¦ä¸€ç§å®ç°æ–¹æ³•ï¼š</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="c1"># base case:
</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">rest</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'Link('</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s">')'</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">'Link('</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">first</span><span class="p">)</span> <span class="o">+</span> <span class="s">', '</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span> <span class="o">+</span> <span class="s">')'</span>
</code></pre></div></div>

<p>è¿™ç§æ€è·¯æ˜¯ç›´æ¥ä»<code class="language-plaintext highlighter-rouge">base case</code>å¼€å§‹å†™çš„ï¼Œå¹¶åœ¨ç¡®å®šäº†<code class="language-plaintext highlighter-rouge">recursive case</code>çš„åŸºæœ¬å½¢å¼åå¯¹<code class="language-plaintext highlighter-rouge">base case</code>è¿›è¡Œè°ƒæ•´ï¼Œè€Œè€å¸ˆç»™å‡ºçš„åšæ³•æ˜¯å…ˆå†™å¤§æ¡†æ¶ï¼Œå…¶ä¸­çš„<code class="language-plaintext highlighter-rouge">rest_repr</code>ä½œä¸ºå˜é‡è¿›è¡Œé€’å½’ã€‚</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">__str__</code>å‡½æ•°çš„æ€è·¯ï¼š</li>
</ul>

<p>åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»å¼€å¤´è‡³æœ«å°¾éƒ½æ˜¯ä¸éœ€è¦æœ‰<code class="language-plaintext highlighter-rouge">&lt;/&gt;</code>ç¬¦å·çš„ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">while</code>å¾ªç¯</p>

<h3 id="tree-class-implementation-recursion">Tree Class Implementation (Recursion)</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Tree</span><span class="p">:</span>
    <span class="s">"""A tree is a label and a list of branches."""</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">branches</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="k">for</span> <span class="n">branch</span> <span class="ow">in</span> <span class="n">branches</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">branch</span><span class="p">,</span> <span class="n">Tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">branches</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">branches</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
            <span class="n">branch_str</span> <span class="o">=</span> <span class="s">', '</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">branches</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">branch_str</span> <span class="o">=</span> <span class="s">''</span>
        <span class="k">return</span> <span class="s">'Tree({0}{1})'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">label</span><span class="p">),</span> <span class="n">branch_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">indented</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">indented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
            <span class="c1"># æ¯ä¸€ä¸ªåˆ†æ”¯éƒ½ä¼šæœ‰å¥½å‡ è¡Œï¼ˆåŒ…å«å¥½å‡ å±‚èŠ‚ç‚¹ï¼‰
</span>            
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">b</span><span class="p">.</span><span class="n">indented</span><span class="p">():</span>
                <span class="c1"># ä¿è¯åŒä¸€å±‚èŠ‚ç‚¹æ‹¥æœ‰åŒæ ·çš„ç¼©è¿›ï¼ŒåŠ ä¸€å±‚åˆ™å¤šä¸€ä¸ªç¼©è¿›
</span>                
                <span class="n">lines</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'  '</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">label</span><span class="p">)]</span> <span class="o">+</span> <span class="n">lines</span>

    <span class="k">def</span> <span class="nf">is_leaf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">.</span><span class="n">branches</span>


<span class="k">def</span> <span class="nf">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""A Fibonacci tree."""</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">fib_tree</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fib_n</span> <span class="o">=</span> <span class="n">left</span><span class="p">.</span><span class="n">label</span> <span class="o">+</span> <span class="n">right</span><span class="p">.</span><span class="n">label</span>
        <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">fib_n</span><span class="p">,</span> <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">leaves</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="s">"""Return the leaf values of a tree."""</span>
    <span class="k">if</span> <span class="n">tree</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">tree</span><span class="p">.</span><span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">leaves</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">.</span><span class="n">branches</span><span class="p">],</span> <span class="p">[])</span>


<span class="k">def</span> <span class="nf">height</span><span class="p">(</span><span class="n">tree</span><span class="p">):</span>
    <span class="s">"""The height of a tree."""</span>
    <span class="k">if</span> <span class="n">tree</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">([</span><span class="n">height</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">tree</span><span class="p">.</span><span class="n">branches</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">prune</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="s">"""Prune sub-trees whose label value is n."""</span>
    
    <span class="c1"># å…ˆè£å‰ªå†éå†
</span>    
    <span class="n">t</span><span class="p">.</span><span class="n">branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span> <span class="k">if</span> <span class="n">b</span><span class="p">.</span><span class="n">label</span> <span class="o">!=</span> <span class="n">n</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="n">prune</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        
<span class="s">"""test1"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">fib_tree</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="mi">3</span>
  <span class="mi">1</span>
    <span class="mi">0</span>
    <span class="mi">1</span>
  <span class="mi">2</span>
    <span class="mi">1</span>
    <span class="mi">1</span>
      <span class="mi">0</span>
      <span class="mi">1</span>
    
<span class="s">"""test2"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">leaves</span><span class="p">(</span><span class="n">fib_tree</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
<span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

<span class="s">"""test3"""</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="n">fib_tree</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">prune</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">print</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="mi">5</span>
  <span class="mi">2</span>
  <span class="mi">3</span>
    <span class="mi">2</span>
</code></pre></div></div>

<h2 id="ants--optional-problem-4-status--abstraction-barrier">Ants â€“ Optional Problem 4 (Status &amp; Abstraction Barrier)</h2>

<p><a href="https://inst.eecs.berkeley.edu/~cs61a/fa20/proj/ants/#optional-problem-4">Optional Problem 4</a></p>

<p>è¿™é“é¢˜å¯ä»¥æ€»ç»“ä¸¤ä¸ªå€¼å¾—æ³¨æ„çš„ç‚¹ï¼š</p>

<ol>
  <li>ç¨‹åºæŠ½è±¡å’Œ<code class="language-plaintext highlighter-rouge">abstraction barrier</code></li>
</ol>

<p>ç¨‹åºéœ€è¦æˆ‘ä»¬åœ¨å››ä¸ªä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œåˆ†åˆ«æ˜¯<code class="language-plaintext highlighter-rouge">make_slow</code>ï¼Œ<code class="language-plaintext highlighter-rouge">make_scare</code>ï¼Œ<code class="language-plaintext highlighter-rouge">apply_status</code>å’Œ<code class="language-plaintext highlighter-rouge">bee</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">action</code>æˆå‘˜å‡½æ•°ã€‚åšå¥½ç¨‹åºæŠ½è±¡çš„è¡¨ç°ï¼Œæˆ–è€…è¯´ç»´æŒ<code class="language-plaintext highlighter-rouge">abstraction barrier</code>çš„è¡¨ç°å°±æ˜¯æˆ‘ä»¬åœ¨<code class="language-plaintext highlighter-rouge">make_slow</code>å’Œ<code class="language-plaintext highlighter-rouge">make_scare</code>ä¸­è™½ç„¶ä¹Ÿè¦å‡ºç°<code class="language-plaintext highlighter-rouge">action</code>çš„è¡Œä¸ºï¼Œä½†ä¸ä¼šæŠŠ<code class="language-plaintext highlighter-rouge">action</code>é‡Œçš„å†…å®¹åœ¨è¿™ä¸¤ä¸ªå‡½æ•°é‡Œå¤åˆ¶ç²˜è´´ä¸€éï¼Œæˆ‘ä»¬è¦åšçš„ä¸€å®šæ˜¯è°ƒç”¨<code class="language-plaintext highlighter-rouge">action</code>å‡½æ•°ï¼Œä½†è¾…ä¹‹ä»¥ä¸€å®šçš„é™å®šæ¡ä»¶ã€‚</p>

<p>æ¢å¥è¯è¯´ï¼Œç‰µæ‰¯åˆ°çŠ¶æ€æ”¹å˜çš„æ“ä½œåº”å½“åœ¨<code class="language-plaintext highlighter-rouge">make_slow</code>ä¸<code class="language-plaintext highlighter-rouge">make_scare</code>ä¸­å®Œæˆï¼ŒåŸæœ¬çš„<code class="language-plaintext highlighter-rouge">action</code>ä¸­åªè´Ÿè´£å®Œæˆå¯¹åº”çŠ¶æ€åº”å½“å®Œæˆçš„äº‹æƒ…ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_slow</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">bee</span><span class="p">):</span>
    <span class="s">"""Return a new action method that calls ACTION every other turn."""</span>
    <span class="c1"># BEGIN Problem Optional 4
</span>
    <span class="k">def</span> <span class="nf">do_change</span><span class="p">(</span><span class="n">gamestate</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">gamestate</span><span class="p">.</span><span class="n">time</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">action</span><span class="p">(</span><span class="n">gamestate</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">do_change</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">make_scare</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">bee</span><span class="p">):</span>
    <span class="s">"""Return a new action method that makes the bee go backwards."""</span>
    <span class="c1"># BEGIN Problem Optional 4
</span>
    <span class="k">def</span> <span class="nf">do_change</span><span class="p">(</span><span class="n">gamestate</span><span class="p">):</span>
        <span class="n">bee</span><span class="p">.</span><span class="n">backwards</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># è¿™é‡Œçš„actionæœªå¿…æ˜¯ä¸€å¼€å§‹çš„action
</span>        
        <span class="n">action</span><span class="p">(</span><span class="n">gamestate</span><span class="p">)</span>
        <span class="n">bee</span><span class="p">.</span><span class="n">backwards</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="n">do_change</span>
</code></pre></div></div>

<p>æ¯”å¦‚ï¼Œä¸€ä¸ªå…¸å‹çš„ä¾‹å­å°±æ˜¯è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">bee.backwards</code>çš„è®¾ç½®ï¼Œæœ‰å¾ˆå¤šç½‘ä¸Šçš„ç­”æ¡ˆå†™çš„æ˜¯æœ‰é—®é¢˜çš„ï¼Œä»–ä»¬å°†<code class="language-plaintext highlighter-rouge">bee.backwards=False</code>è¿™ä¸€æ­¥æ”¾åˆ°äº†<code class="language-plaintext highlighter-rouge">bee.action</code>çš„å®ç°é‡Œï¼Œç ´åäº†<code class="language-plaintext highlighter-rouge">abstraction barrier</code>ã€‚è¿™æ ·çš„è®¾è®¡ä¼šåœ¨å¦‚ä¸‹çš„æƒ…å†µå‡ºç°é—®é¢˜ï¼š</p>

<blockquote>
  <p>å¦‚æœæ‰§è¡Œé¡ºåºæ˜¯<code class="language-plaintext highlighter-rouge">make_scary-&gt;make_slow</code>ï¼Œè‡ª<code class="language-plaintext highlighter-rouge">gamestate.time=0</code>èµ·å§‹ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">gamestate.time=1</code>æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">slow</code>ä¸åšåŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰è¿›å…¥<code class="language-plaintext highlighter-rouge">bee.action</code>æ–¹æ³•é‡Œï¼Œåˆ™æ­¤æ—¶å½“<code class="language-plaintext highlighter-rouge">gamestate.time=1</code>çš„æ‰€æœ‰åŠ¨ä½œå®Œæ¯•åï¼Œ<code class="language-plaintext highlighter-rouge">bee.backwards</code>ä»ä¿æŒ<code class="language-plaintext highlighter-rouge">True</code>çš„çŠ¶æ€ï¼Œå¯æ˜¯ä¸‹æ¬¡å½“<code class="language-plaintext highlighter-rouge">gamestate.time=2</code>æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">make_scary</code>åŠ¨ä½œç»“æŸï¼Œæ­¤æ—¶æœ¬åº”å½“è¿”å›å‰è¡Œï¼Œå³<code class="language-plaintext highlighter-rouge">bee.backwards=False</code>ï¼Œå¯æ˜¯æ­¤æ—¶çš„<code class="language-plaintext highlighter-rouge">bee.backwards</code>ä»ç»´æŒäº†<code class="language-plaintext highlighter-rouge">True</code>çš„çŠ¶æ€ï¼Œä¼šé€ æˆé”™è¯¯</p>
</blockquote>

<ol>
  <li>çŠ¶æ€æœº</li>
</ol>

<p>è¿™é‡Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„çŠ¶æ€æœºçš„å®ç°æ¡ˆä¾‹ï¼Œå› ä¸ºä¼šé‡åˆ°çŠ¶æ€å åŠ çš„æƒ…å†µï¼Œè€Œæ¯ä¸€æ¬¡å¢åŠ <code class="language-plaintext highlighter-rouge">status</code>ï¼Œéƒ½ä¼šè°ƒç”¨<code class="language-plaintext highlighter-rouge">apply_status</code>å‡½æ•°ã€‚æ­¤åï¼ŒåŠ¨ä½œ<code class="language-plaintext highlighter-rouge">bee.action</code>ä¼šè°ƒç”¨å­˜å‚¨çš„ä¸åŒçš„<code class="language-plaintext highlighter-rouge">status</code>ï¼Œä»æœ€å¤–å±‚çš„<code class="language-plaintext highlighter-rouge">status</code>å¼€å§‹ã€‚æ‰€ä»¥æˆ‘ä»¬è¦ç”¨<code class="language-plaintext highlighter-rouge">bee.action</code>å°†ä¸åŒçš„çŠ¶æ€æŒ‰ç…§å…ˆåé¡ºåºè¿æ¥æˆå®Œæ•´çš„çŠ¶æ€æœºã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼šæ¯æ¬¡è°ƒç”¨<code class="language-plaintext highlighter-rouge">apply_status</code>ï¼Œå³å‘çŠ¶æ€æœºä¸­å¢åŠ çŠ¶æ€æ—¶ï¼Œå…ˆå°†å½“å‰çš„çŠ¶æ€ï¼Œå³<code class="language-plaintext highlighter-rouge">bee.action</code>å­˜å‚¨èµ·æ¥ï¼Œæ¥ç€æŠŠå¢åŠ çš„çŠ¶æ€(<code class="language-plaintext highlighter-rouge">status</code>)èµ‹ç»™<code class="language-plaintext highlighter-rouge">bee.action</code>ã€‚é‚£ä¹ˆå½“ä¸‹æ¬¡å†å‘çŠ¶æ€æœºä¸­å¢åŠ <code class="language-plaintext highlighter-rouge">status</code>æ—¶ï¼Œæ­¤æ—¶å½“å‰çŠ¶æ€<code class="language-plaintext highlighter-rouge">bee.action</code>å¯¹åº”çš„æ˜¯ä¸Šä¸€ä¸ªè¢«åŠ å…¥çŠ¶æ€æœºçš„<code class="language-plaintext highlighter-rouge">status</code>ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>

<p>æ»¡è¶³é¢˜æ„çš„è®¾è®¡å¦‚ä¸‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">apply_status</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">bee</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
    <span class="s">"""Apply a status to a BEE that lasts for LENGTH turns."""</span>
    <span class="c1"># BEGIN Problem Optional 4
</span>
    <span class="n">previous_behavior</span> <span class="o">=</span> <span class="n">bee</span><span class="p">.</span><span class="n">action</span>
    <span class="n">do_change</span> <span class="o">=</span> <span class="n">status</span><span class="p">(</span><span class="n">bee</span><span class="p">.</span><span class="n">action</span><span class="p">,</span> <span class="n">bee</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">action</span><span class="p">(</span><span class="n">gamestate</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">length</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">do_change</span><span class="p">(</span><span class="n">gamestate</span><span class="p">)</span>
            <span class="n">length</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">previous_behavior</span><span class="p">(</span><span class="n">gamestate</span><span class="p">)</span>
    <span class="n">bee</span><span class="p">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
</code></pre></div></div>

<p>æœ€åï¼Œåœ¨<code class="language-plaintext highlighter-rouge">bee.action</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å®ç°<code class="language-plaintext highlighter-rouge">make_scary</code>å¯¹åº”çŠ¶æ€å³å¯ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="bp">self</span><span class="p">.</span><span class="n">backwards</span><span class="p">:</span>
   	<span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">place</span><span class="p">.</span><span class="n">entrance</span>
	<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">Hive</span><span class="p">):</span>
   		<span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">place</span>
</code></pre></div></div>

<h2 id="hw05-linked-lists--trees-oop">HW05 (Linked Lists &amp; Trees OOP)<a id="anchor12"></a></h2>

<h3 id="è¿­ä»£æ„å»ºlinked-lists">è¿­ä»£æ„å»ºLinked Lists</h3>

<p>é€šè¿‡è¿­ä»£çš„æ–¹æ³•éå†ï¼ˆæ„å»ºï¼‰é“¾è¡¨ï¼Œæ˜¯ä»åˆ—è¡¨æœ«å°¾å¼€å§‹å‰å¾€åˆ—è¡¨å¤´éƒ¨çš„ï¼Œå¦‚æœä½¿ç”¨é€’å½’åˆ™æ˜¯åè¿‡æ¥ï¼š</p>

<p>(åœ¨ä¸ä½¿ç”¨å­—ç¬¦ä¸²ç›¸å…³æ“ä½œçš„æƒ…å†µä¸‹)</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">store_digits</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s">"""Stores the digits of a positive number n in a linked list."""</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
    <span class="k">while</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Link</span><span class="p">(</span><span class="n">n</span> <span class="o">%</span> <span class="mi">10</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">//=</span> <span class="mi">10</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h3 id="lr-fold-function-of-linked-lists">L/R Fold Function of Linked Lists</h3>

<p>å‡½æ•°æ„é€ ç›¸å¯¹ç®€å•ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ï¼Œä½†æ˜¯åœ¨æŸäº›é¢˜ç›®ä¸­ä¼šç”¨åˆ°ï¼š</p>

<ul>
  <li>LFOLD:</li>
</ul>

<blockquote>
  <p><code class="language-plaintext highlighter-rouge">&gt;&gt;&gt; lst = Link(3, Link(2, Link(1)))    </code></p>

  <p><code class="language-plaintext highlighter-rouge">&gt;&gt;&gt; foldl(lst, sub, 0) # (((0 - 3) - 2) - 1)    </code></p>

  <p><code class="language-plaintext highlighter-rouge">-6    </code></p>

  <p><code class="language-plaintext highlighter-rouge">&gt;&gt;&gt; foldl(lst, add, 0) # (((0 + 3) + 2) + 1)    </code></p>

  <p>â€‹    <code class="language-plaintext highlighter-rouge">6</code></p>

  <p><code class="language-plaintext highlighter-rouge">&gt;&gt;&gt; foldl(lst, mul, 1) # (((1 * 3) * 2) * 1)    </code></p>

  <p>â€‹    <code class="language-plaintext highlighter-rouge">6 </code></p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foldl</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fn</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">link</span><span class="p">.</span><span class="n">first</span><span class="p">))</span>
</code></pre></div></div>

<ul>
  <li>RFOLD:</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">link</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">foldr</span><span class="p">(</span><span class="n">link</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">z</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="filter-with-fold">Filter with Fold</h3>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">fold</code>å‡½æ•°å®Œæˆ<code class="language-plaintext highlighter-rouge">filter</code>åŠŸèƒ½ï¼Œå…¶å®ä¸»è¦éš¾ç‚¹åœ¨äºå¯¹<code class="language-plaintext highlighter-rouge">fn</code>å‡½æ•°çš„è®¾è®¡ï¼Œæˆ‘ä»¬éœ€è¦ä»ä¸€ç§æŠ½è±¡çš„è§’åº¦æ¥æ€è€ƒå¦‚ä½•è®¾è®¡è¯¥å‡½æ•°ï¼šæˆ‘ä»¬è§‚å¯Ÿ<code class="language-plaintext highlighter-rouge">foldr</code>çš„è¿”å›ç»“æ„ï¼Œ<code class="language-plaintext highlighter-rouge">fn</code>æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯å½“å‰é“¾è¡¨çš„å¤´éƒ¨èŠ‚ç‚¹å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯å³å°†è¦å¤„ç†çš„<code class="language-plaintext highlighter-rouge">rest</code>åºåˆ—ï¼Œé‚£ä¹ˆ<code class="language-plaintext highlighter-rouge">filter</code>çš„<code class="language-plaintext highlighter-rouge">fn</code>å°±åº”è¯¥å®šä¹‰ä¸ºï¼šå¦‚æœæ»¡è¶³<code class="language-plaintext highlighter-rouge">pred</code>ï¼Œåˆ™ä¿ç•™<code class="language-plaintext highlighter-rouge">link.first</code>ï¼Œå¹¶ç»§ç»­é€’å½’<code class="language-plaintext highlighter-rouge">rest</code>éƒ¨åˆ†ï¼›å¦åˆ™èˆå¼ƒ<code class="language-plaintext highlighter-rouge">link.first</code>ï¼Œç›´æ¥é€’å½’<code class="language-plaintext highlighter-rouge">rest</code>ã€‚</p>

<p>æˆ–è€…è¯´å¾—ç›´æ¥ä¸€ç‚¹ï¼š<code class="language-plaintext highlighter-rouge">fn</code>åœ¨è¿™é‡Œçš„åŠŸèƒ½å°±åº”è¯¥æ˜¯ï¼Œåˆ¤å®šæŸä¸ªå…ƒç´ æ˜¯å¦åº”å½“è¢«æ»¤é™¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">filterl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="s">""" Filters LST based on PRED """</span>
    <span class="k">def</span> <span class="nf">filtered</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="c1"># å¦‚æœæ»¡è¶³è¦æ±‚ï¼Œåˆ™ä¿ç•™
</span>        
        <span class="k">if</span> <span class="n">pred</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">foldr</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">filtered</span><span class="p">,</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="é“¾è¡¨ç¿»è½¬">é“¾è¡¨ç¿»è½¬</h3>

<p>è¿™é“é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼Œç¬¬ä¸€ç§æ˜¯åˆ©ç”¨<code class="language-plaintext highlighter-rouge">foldl</code>å‡½æ•°ï¼Œè¿˜æ˜¯ä»æŠ½è±¡è§’åº¦å…¥æ‰‹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reverse</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="s">""" Reverses LST with foldl """</span>
    <span class="k">return</span> <span class="n">foldl</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">Link</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>åœ¨è¿™é‡Œï¼Œ<code class="language-plaintext highlighter-rouge">x</code>ä¼šæ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">link list</code>ï¼Œ<code class="language-plaintext highlighter-rouge">y</code>æ˜¯è¦åè½¬çš„å€¼</p>
</blockquote>

<p>äº¦æˆ–è€…ï¼Œè¿˜æœ‰ä¸€ç§æ›´ç»å…¸çš„é€’å½’ç®—æ³•ï¼Œå¯ä»¥å‚è§è¿™é‡Œï¼š</p>

<p><a href="https://zhuanlan.zhihu.com/p/86745433">é“¾è¡¨åè½¬é€’å½’ç®—æ³•</a></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reverse2</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lst</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lst</span>
    <span class="k">elif</span> <span class="n">lst</span><span class="p">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">second</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="n">lst</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">lst</span>
        <span class="n">lst</span> <span class="o">=</span> <span class="n">reverse2</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
        <span class="n">second</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">last</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">last</span><span class="p">,</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
    <span class="k">return</span> <span class="n">lst</span>
</code></pre></div></div>

<h3 id="åˆ¤å®švalid-bst">åˆ¤å®šValid BST</h3>

<p>æ ‡å‡†äºŒå‰æ ‘è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108141816212.png" alt="image-20210814181621064" style="zoom:50%;" /></p>

<p>æ³¨æ„ï¼Œæ ‡å‡†äºŒå‰æ ‘è¦æ±‚å¯¹æŸèŠ‚ç‚¹<strong>å·¦ä¾§å­æ ‘å’Œå³ä¾§å­æ ‘</strong>çš„æœ€å¤§å€¼å’Œæœ€å°å€¼ä½ç½®æœ‰è¦æ±‚ï¼Œè€Œä¸æ˜¯ä»…ä»…è€ƒå¯Ÿç›´æ¥è¿æ¥çš„å·¦å³èŠ‚ç‚¹ã€‚</p>

<p>è¿™é“é¢˜å¯ä»¥æœ‰ä¸¤ç§è§£æ³•ï¼Œé¦–å…ˆæˆ‘ä»¬å¯ä»¥å‡å®šæ ‘ç¬¦åˆè¦æ±‚ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‡½æ•°åˆ†åˆ«è·å–æœ€å¤§å€¼ä¸æœ€å°å€¼ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">bst_min</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">"""Returns the min of t, if t has the structure of a valid BST."""</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">bst_min</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">bst_max</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">"""Returns the max of t, if t has the structure of a valid BST."""</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">bst_max</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</code></pre></div></div>

<p>æ­¤ååˆ†æƒ…å†µé€’å½’è®¨è®ºå³å¯ã€‚</p>

<p>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œä¸å…ˆåšæ ‘ä¸º<code class="language-plaintext highlighter-rouge">Valid BST</code>çš„å‡è®¾ï¼Œç›´æ¥è®¡ç®—å­æ ‘çš„æœ€å€¼ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡éå†å‡ºæ‰€æœ‰å­æ ‘èŠ‚ç‚¹å®ç°ã€‚æ–¹æ³•å¯ä»¥ç›´æ¥çœ‹<code class="language-plaintext highlighter-rouge">preorder</code>é‚£é“é¢˜ã€‚</p>

<h3 id="å‰åºéå†treeæ–¹æ³•">å‰åºéå†Treeæ–¹æ³•</h3>

<p>é¦–å…ˆï¼Œå¯ä»¥å€Ÿé‰´<code class="language-plaintext highlighter-rouge">Tree</code>ç±»ä¸­çš„æ‰“å°å‡½æ•°å®ç°æ–¹æ³•ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">indented</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="c1"># æ¯ä¸€ä¸ªåˆ†æ”¯éƒ½ä¼šæœ‰å¥½å‡ è¡Œï¼ˆåŒ…å«å¥½å‡ å±‚èŠ‚ç‚¹ï¼‰
</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">b</span><span class="p">.</span><span class="n">indented</span><span class="p">():</span>
            <span class="c1"># ä¿è¯åŒä¸€å±‚èŠ‚ç‚¹æ‹¥æœ‰åŒæ ·çš„ç¼©è¿›ï¼ŒåŠ ä¸€å±‚åˆ™å¤šä¸€ä¸ªç¼©è¿›
</span>
            <span class="n">lines</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'  '</span> <span class="o">+</span> <span class="n">line</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">label</span><span class="p">)]</span> <span class="o">+</span> <span class="n">lines</span>
</code></pre></div></div>

<blockquote>
  <p>æ ¹æ®æ³¨é‡Šä¸­çš„æ€è·¯ç†è§£è¿™ç§é€’å½’ï¼ŒåŒæ—¶æŒ‰ç…§é€’å½’é—®é¢˜çš„ä¸€èˆ¬æ€è·¯ï¼Œè¿™é‡Œä¹Ÿåªè€ƒè™‘ç¬¬ä¸€å±‚éå†çš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯<code class="language-plaintext highlighter-rouge">root</code>çš„æˆ‘ä¸‹ä¸€å±‚èŠ‚ç‚¹ï¼šå‡è®¾åœ¨å†…å±‚<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯ä¸­<code class="language-plaintext highlighter-rouge">b.indented</code>å¯ä»¥è¿”å›æ­£ç¡®çš„å€¼ï¼ˆ<strong>å…¶å®è¿™ä¸€æ­¥ç”¨äº†æ•°å­¦å½’çº³æ³•</strong>ï¼‰é‚£ä¹ˆå†…å±‚çš„<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯ä¼šæŠŠæ‰€æœ‰çš„èŠ‚ç‚¹å‰è¾¹åŠ ä¸Šä¸€ä¸ªç¼©è¿›ï¼Œå­˜å‚¨åˆ°<code class="language-plaintext highlighter-rouge">lines</code>é‡Œï¼Œä¹‹åå¾ªç¯ä¸‹ä¸€ä¸ªä¹Ÿåœ¨ç¬¬ä¸€å±‚çš„èŠ‚ç‚¹åŠå…¶å­æ ‘ï¼Œæœ€åæŠŠ<code class="language-plaintext highlighter-rouge">root</code>åŠ åœ¨æœ€å‰è¾¹ï¼Œè¯´æ˜ç®—æ³•æˆç«‹ï¼</p>
</blockquote>

<p>ç±»ä¼¼åœ°ï¼Œå†™å‡ºå‰åºéå†äºŒå‰æ ‘çš„å‡½æ•°ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">preorder</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">label_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="c1"># å‡è®¾bstå¯ä»¥æ­£ç¡®è¿”å›ç¬¬ä¸€å±‚ä»¥ä¸‹æŸä¸ªåˆ†æ”¯çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œåˆ™ç»è¿‡æ¨å¯¼ï¼Œç»“æœæ­£ç¡®
</span>        
        <span class="k">for</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">bst</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
            <span class="n">label_lst</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">label_lst</span>
</code></pre></div></div>

<p>æˆ–è€…å†™ä½œï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">preorder</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">]</span>
    <span class="n">flattened_children</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="c1"># å‡è®¾preorderåœ¨è¿™é‡Œå¯ä»¥è¿”å›ç¬¬ä¸€å±‚ä»¥ä¸‹æŸåˆ†æ”¯æ‰€æœ‰èŠ‚ç‚¹
</span>        
        <span class="n">flattened_children</span> <span class="o">+=</span> <span class="n">preorder</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">flattened_children</span>
</code></pre></div></div>

<blockquote>
  <p>ä¹Ÿå¯ä»¥åˆ©ç”¨pythonçš„å†…ç½®å‡½æ•°å®ç°ï¼Œä¸è¯¦ç»†è®¨è®ºï¼š</p>

  <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">preorder_alt</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="p">[</span><span class="n">preorder</span><span class="p">(</span><span class="n">child</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">],</span> <span class="p">[</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">])</span>
</code></pre></div>  </div>
</blockquote>

<h3 id="å®Œå…¨äºŒå‰æ ‘-å·²çŸ¥å¶ç»“ç‚¹æ±‚æ ‘ç»“æ„æ•°é‡">å®Œå…¨äºŒå‰æ ‘ å·²çŸ¥å¶ç»“ç‚¹ï¼Œæ±‚æ ‘ç»“æ„æ•°é‡</h3>

<p>æˆ‘ä»¬å°†ä¸€æ£µå®Œå…¨äºŒå‰æ ‘åˆ†ä¸ºå·¦åŠæ ‘å’Œå³åŠæ ‘ï¼Œé‚£ä¹ˆåœ¨<code class="language-plaintext highlighter-rouge">n</code>ä¸ªå¶ç»“ç‚¹ä¸­ï¼Œæ‰€æœ‰çš„æƒ…å†µé‡Œå·¦åŠæ ‘å¯ä»¥æœ‰<code class="language-plaintext highlighter-rouge">1-(n-1)</code>ä¸ªèŠ‚ç‚¹ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">num_trees</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">num_of_left_trees</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">num_of_right_trees</span> <span class="o">=</span> <span class="n">n</span> <span class="o">-</span> <span class="n">num_of_left_trees</span>
        <span class="c1"># æ ¹æ®é€’å½’åŸåˆ™ï¼š
</span>        
        <span class="n">num_left_trees</span> <span class="o">=</span> <span class="n">num_trees</span><span class="p">(</span><span class="n">num_of_left_trees</span><span class="p">)</span>
        <span class="n">num_right_trees</span> <span class="o">=</span> <span class="n">num_trees</span><span class="p">(</span><span class="n">num_of_right_trees</span><span class="p">)</span>
        <span class="c1"># æ€»æ•°æ˜¯ç›¸ä¹˜
</span>        
        <span class="k">return</span> <span class="n">num_left_trees</span> <span class="o">*</span> <span class="n">num_right_trees</span>
</code></pre></div></div>

<p>å¦‚æœæˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">num_trees</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">num_trees</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">*</span> <span class="n">num_trees</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="æ ‘çš„è£å‰ª-lab-09">æ ‘çš„è£å‰ª (lab 09)<a id="anchor19"></a></h3>

<blockquote>
  <p>å…ˆè£å‰ªï¼Œå†éå†</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">prune_small</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="s">"""Prune the tree mutatively, keeping only the n branches
    of each node with the smallest label."""</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">)</span> <span class="o">&gt;</span>  <span class="n">n</span><span class="p">:</span>
        <span class="c1"># æ³¨æ„è¿™é‡Œkeyå¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°
</span>        
        <span class="n">largest</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">largest</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="n">prune_small</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="æ ‘çš„æ¨ªå‘é€’å½’éå†">æ ‘çš„æ¨ªå‘é€’å½’/éå†</h3>

<h4 id="disc-14-1">disc 14</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109030345952.png" alt="image-20210903034532780" style="zoom:50%;" /></p>

<p>ä¸æ™®é€šçš„æ·±åº¦æœç´¢æ–¹æ³•ä¸åŒï¼Œè¿™é“é¢˜ä½¿ç”¨çš„æ˜¯å¹¿åº¦æœç´¢ï¼Œæ‰€ä»¥è‡ªç„¶è€Œç„¶çš„ï¼Œæˆ‘ä»¬å°è¯•ä½¿ç”¨<code class="language-plaintext highlighter-rouge">while</code>å¾ªç¯ï¼Œé¢˜ç›®ç»™å‡ºçš„<code class="language-plaintext highlighter-rouge">template</code>ä¹Ÿæ˜¯è¿™æ ·å†™çš„ã€‚æ€è€ƒ<code class="language-plaintext highlighter-rouge">while</code>å¾ªç¯çš„åŠŸèƒ½ï¼š<strong>éå†åŒä¸€å±‚çš„æ‰€æœ‰åˆ†æ”¯ï¼Œå¹¶æŠŠè¿™äº›åˆ†æ”¯çš„<code class="language-plaintext highlighter-rouge">label</code>æŒ‰ç…§ä¸€å±‚ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">list</code>çš„å½¢å¼å‚¨å­˜èµ·æ¥ï¼Œæœ€ç»ˆé€‰æ‹©æ•°é‡æœ€å¤šçš„é‚£ä¸€ä¸ª</strong>ã€‚</p>

<p>äºæ˜¯æˆ‘ä»¬æƒ³ï¼Œéœ€è¦ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">levels</code>å‚¨å­˜èŠ‚ç‚¹<code class="language-plaintext highlighter-rouge">label</code>ã€‚åœ¨è¿™ä¹‹åï¼Œè¦æƒ³çš„é—®é¢˜æ˜¯ï¼Œéå†å®Œä¸€å±‚ä¹‹åï¼Œå¦‚ä½•æŠŠä¸‹ä¸€å±‚çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå­æ ‘ï¼‰å­˜å‚¨èµ·æ¥ï¼Œå†éå†ï¼Ÿ</p>

<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å†å€ŸåŠ©ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥å‚¨å­˜æ¯æ¬¡æˆ‘ä»¬è¦éå†çš„ä¸‹ä¸€å±‚æ‰€æœ‰å­æ ‘ï¼Œç›´åˆ°ç©ºä¸ºæ­¢ï¼Œ<code class="language-plaintext highlighter-rouge">while</code>å¾ªç¯ç»“æŸã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">widest_level</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">levels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">]</span>
    <span class="k">while</span> <span class="n">x</span><span class="p">:</span>
        <span class="n">levels</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">t</span><span class="p">.</span><span class="n">branches</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">x</span><span class="p">],[])</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>è¿™é‡Œ<code class="language-plaintext highlighter-rouge">sum</code>çš„ä½œç”¨æ˜¯æŠŠåŸæœ¬åœ¨ä¸åŒçš„<code class="language-plaintext highlighter-rouge">list</code>é‡Œçš„å¾ˆå¤šä¸ª<code class="language-plaintext highlighter-rouge">branches</code>æ”¾åˆ°åŒä¸€å±‚çš„å¤§liståº•ä¸‹</p>
</blockquote>

<h3 id="smalls--bigs">Smalls &amp; Bigs</h3>

<h4 id="bigs">bigs</h4>

<blockquote>
  <p>Implement bigs, which takes a Tree instance t containing integer labels. It returns the number of nodes in t whose labels are larger than all labels of their ancestor nodes.</p>
</blockquote>

<p>è¿™é“é¢˜çš„åˆ‡å…¥ç‚¹åº”å½“æ˜¯ï¼Œéœ€è¦<code class="language-plaintext highlighter-rouge">track a list of ancestors</code>ï¼Œå¾—åˆ°<code class="language-plaintext highlighter-rouge">max(ancestors)</code>ï¼Œå¦‚æœæ»¡è¶³<code class="language-plaintext highlighter-rouge">node.label &gt; max(ancestors)</code>ï¼Œåˆ™ç¬¦åˆè¦æ±‚ã€‚æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Higher Order Function</code>ï¼Œç”¨ä¸€ä¸ªå‚æ•°ä¿å­˜å½“å‰æœ€å¤§çš„èŠ‚ç‚¹å€¼ï¼Œä¹‹ååˆ†ä¸¤ç§æƒ…å†µè®¨è®ºï¼Œåˆ©ç”¨<strong>æ•°å­¦å½’çº³æ³•</strong>å‡å®š<code class="language-plaintext highlighter-rouge">bigs(b, a.label)</code>ä¼šè¿”å›æ­£ç¡®çš„å€¼ï¼Œä»è€Œéœ€è¦<code class="language-plaintext highlighter-rouge">sum()</code>å¤„ç†ç»Ÿè®¡ç»“æœï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">bigs</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="n">label</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">sum</span><span class="p">([</span><span class="n">bigs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">.</span><span class="n">label</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">bigs</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é“é¢˜ä¹Ÿå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">Recursion Accumulation</code>çš„æ–¹æ³•å»åšï¼Œä¹Ÿå³ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥ä¿å­˜èŠ‚ç‚¹æ•°é‡ï¼Œ<code class="language-plaintext highlighter-rouge">x</code>ä»£è¡¨<code class="language-plaintext highlighter-rouge">the largest ancestor</code>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">bigs</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">n</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">.</span><span class="n">label</span> <span class="o">&gt;</span> <span class="n">x</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
            <span class="n">f</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
    <span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></div>

<h4 id="smalls">smalls</h4>

<blockquote>
  <p>Implement smalls, which takes a Tree instance t containing integer labels. It returns the non-leaf nodes in t whose labels are smaller than any labels of their descendant nodes.</p>

  <p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202109031721596.png" alt="image-20210903172117415" style="zoom:50%;" /></p>
</blockquote>

<p>ä¸<code class="language-plaintext highlighter-rouge">bigs</code>æ‰€ä¸åŒçš„æ˜¯ï¼Œè¿™é‡Œçš„è¦æ±‚é’ˆå¯¹çš„ï¼ˆæˆ–è€…è¯´è€ƒå¯Ÿå¯¹è±¡ï¼‰æ˜¯æ‰€æœ‰çš„å­èŠ‚ç‚¹ã€‚</p>

<p>å¯¹äºæŸä¸ªå­æ ‘<code class="language-plaintext highlighter-rouge">t</code>ï¼Œæˆ‘ä»¬æƒ³è¦å®Œæˆå¦‚ä¸‹ä¸¤ä¸ªåŠŸèƒ½ï¼š</p>

<ul>
  <li><strong>Find smallest label in t</strong></li>
  <li><strong>Maybe add t to result</strong></li>
</ul>

<p>ç”±äºéå†è¿‡ç¨‹æ˜¯è‡ªé¡¶å‘ä¸‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„è¿‡ç¨‹ä¸€å®šæ˜¯ï¼Œå…ˆéå†åˆ°å¶ç»“ç‚¹ï¼Œä¹‹åå­˜å‚¨è¿”å›çš„æ»¡è¶³è¦æ±‚çš„èŠ‚ç‚¹ï¼ˆè®¾ç«‹ä¸€ä¸ªæ•°ç»„<code class="language-plaintext highlighter-rouge">result</code>ï¼‰ï¼ŒåŒæ—¶å®Œæˆæ¯”è¾ƒå¤§å°çš„å·¥ä½œï¼ˆä¸€èˆ¬åœ¨è¿”å›å€¼å¤„ä½¿ç”¨<code class="language-plaintext highlighter-rouge">min</code>ï¼‰ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">smalls</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># find the smallest
</span>            
            <span class="n">smallest</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">process</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="o">&lt;</span> <span class="n">smallest</span><span class="p">:</span>
                <span class="c1"># add t to the result
</span>                
                <span class="n">result</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">smallest</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">process</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<h2 id="f20-lecture-22-efficiency">F20 Lecture 22 (Efficiency)</h2>

<h3 id="é€’å½’ä¼˜åŒ–">é€’å½’ä¼˜åŒ–</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">n</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Time
</span>
<span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s">"""Return a counted version of f with a call_count attribute."""</span>
    <span class="k">def</span> <span class="nf">counted</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">counted</span><span class="p">.</span><span class="n">call_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
    <span class="n">counted</span><span class="p">.</span><span class="n">call_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">counted</span>

<span class="c1"># Memoization
</span>
<span class="k">def</span> <span class="nf">memo</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
    <span class="s">"""Memoize f."""</span>
    <span class="n">cache</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">def</span> <span class="nf">memoized</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cache</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">memoized</span>
</code></pre></div></div>

<blockquote>
  <p>åœ¨pythonä¸­ï¼Œå‡½æ•°å¯ä»¥è®¾ç½®å±æ€§å¦‚<code class="language-plaintext highlighter-rouge">function.attribute</code>ï¼Œä¸”ä¸éœ€è¦<code class="language-plaintext highlighter-rouge">nonlocal</code>ç­‰å­—çœ¼</p>
</blockquote>

<p>é€šè¿‡è®¾ç½®<code class="language-plaintext highlighter-rouge">memo</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¤§å¤§æå‡è¿è¡Œé€Ÿåº¦ï¼Œå°†å·²ç»è®¡ç®—è¿‡çš„å€¼å‚¨å­˜èµ·æ¥ã€‚åœ¨è°ƒç”¨æ—¶ï¼ŒæŠ€å·§æ˜¯ä»¤<code class="language-plaintext highlighter-rouge">fib=count(fib)</code>ä»¥åŠ<code class="language-plaintext highlighter-rouge">fib=memo(fib)</code>ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œé€šè¿‡å˜é‡<code class="language-plaintext highlighter-rouge">fib</code>è°ƒç”¨çš„å¯¹è±¡å°±ä¼šå˜æˆå¦å¤–ä¸€ä¸ªå‡½æ•°ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108142151705.png" alt="image-20210814215141513" style="zoom:50%;" /></p>

<p>åœ¨<code class="language-plaintext highlighter-rouge">fib=count(fib)</code>ä¸­ï¼Œç­‰å¼å³ä¾§çš„å‚æ•°<code class="language-plaintext highlighter-rouge">fib</code>å…ˆè¢«ç»‘å®šåˆ°å‡½æ•°<code class="language-plaintext highlighter-rouge">count</code>çš„å‚æ•°<code class="language-plaintext highlighter-rouge">f</code>ä¸Šï¼Œæ¥ä¸‹æ¥ç­‰å¼å·¦ä¾§ï¼ŒåŸæœ¬æ˜¯å…¨å±€å‡½æ•°åçš„<code class="language-plaintext highlighter-rouge">fib</code>ç»‘å®šåˆ°äº†<code class="language-plaintext highlighter-rouge">count</code>å‡½æ•°çš„è¿”å›å€¼ï¼Œä¹Ÿå³<code class="language-plaintext highlighter-rouge">counted(*args)</code>ä¸Šï¼Œæ­¤åï¼Œæˆ‘ä»¬æ‰§è¡Œ<code class="language-plaintext highlighter-rouge">fib(x)</code>æ‰§è¡Œçš„éƒ½æ˜¯<code class="language-plaintext highlighter-rouge">counted</code>å‡½æ•°ï¼Œè€Œåœ¨è¿›å…¥<code class="language-plaintext highlighter-rouge">counted</code>å†…éƒ¨åï¼Œ<code class="language-plaintext highlighter-rouge">f(*args)</code>åˆ™ä¼šæ‰§è¡Œ<strong>åŸæœ¬</strong>çš„<code class="language-plaintext highlighter-rouge">fib</code>å‡½æ•°ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fib</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
<span class="n">counted_fib</span> <span class="o">=</span> <span class="n">fib</span>
<span class="n">fib</span> <span class="o">=</span> <span class="n">memo</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
<span class="n">fib</span> <span class="o">=</span> <span class="n">count</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨<code class="language-plaintext highlighter-rouge">memo</code>ä¸­ï¼Œæœ‰äº›èµ°åˆ°äº†<code class="language-plaintext highlighter-rouge">original fib function</code>ï¼Œæœ‰äº›åˆ™èµ°åˆ°äº†<code class="language-plaintext highlighter-rouge">cache</code></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">counted_fib.call_count</code>è¾“å‡ºçš„æ˜¯èµ°åˆ°äº†<code class="language-plaintext highlighter-rouge">original fib function</code>çš„æƒ…å†µï¼Œç”±äº<code class="language-plaintext highlighter-rouge">cache</code>çš„å­˜åœ¨ï¼Œä¸ä¼šé‡å¤è·¯å¾„</li>
  <li><code class="language-plaintext highlighter-rouge">fib.call_count</code>è¾“å‡ºçš„æ˜¯<code class="language-plaintext highlighter-rouge">memo</code>çš„æ€»æ¬¡æ•°</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108142226682.png" alt="image-20210814222554815" style="zoom:50%;" /></p>

<h3 id="æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–">æ—¶é—´å¤æ‚åº¦ä¼˜åŒ–</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108142228055.png" alt="image-20210814222813914" style="zoom:50%;" /></p>

<p>ä»çº¿æ€§-&gt;å¯¹æ•°å¤æ‚åº¦ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108142233710.png" alt="image-20210814223321574" style="zoom:50%;" /></p>

<h3 id="space">Space</h3>

<p>ä»¥<code class="language-plaintext highlighter-rouge">fib</code>ä¸ºä¾‹ï¼Œæœ€å¤§å ç”¨ç©ºé—´ï¼Œæˆ–è€…è¯´<code class="language-plaintext highlighter-rouge">active environment</code>æ˜¯å¤šå°‘ï¼Ÿ</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">count_frames</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="s">"""Return a counted version of f with a max_count attribute."""</span>
    <span class="k">def</span> <span class="nf">counted</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="n">counted</span><span class="p">.</span><span class="n">open_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">counted</span><span class="p">.</span><span class="n">max_count</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">counted</span><span class="p">.</span><span class="n">max_count</span><span class="p">,</span> <span class="n">counted</span><span class="p">.</span><span class="n">open_count</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">counted</span><span class="p">.</span><span class="n">open_count</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="n">counted</span><span class="p">.</span><span class="n">open_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">counted</span><span class="p">.</span><span class="n">max_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">counted</span>
</code></pre></div></div>

<p>æ­¤æ—¶ï¼Œ<code class="language-plaintext highlighter-rouge">counted.max_count</code>åº”å½“ä¸º<code class="language-plaintext highlighter-rouge">fib</code>æ ‘çš„æœ€é•¿è·¯å¾„ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108142240924.png" alt="image-20210814224000781" style="zoom:50%;" /></p>

<h4 id="lab-08-optional-problem-1">Lab 08 Optional Problem 1</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161432466.png" alt="image-20210816143219334" style="zoom:50%;" /></p>

<p>å¦‚æœä½¿ç”¨çº¿æ€§ç©ºé—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå³å°†éå†çš„æ¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">s.rest</code>éƒ½åŠ å…¥åˆ—è¡¨ä¸­ï¼Œç›´åˆ°å‘ç°äº†é‡å¤çš„<code class="language-plaintext highlighter-rouge">s.rest</code>ä¸ºæ­¢ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">has_cycle</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
    <span class="s">"""Return whether link contains a cycle."""</span>
    <span class="n">Link_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="n">link</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># å…¶å®è¿™é‡Œæ¯”è¾ƒçš„ç›¸å½“äºæ˜¯åœ°å€äº†
</span>        
        <span class="k">if</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">Link_lst</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">Link_lst</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">link</span><span class="p">.</span><span class="n">rest</span>
    <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<p>ä½†æ˜¯è¿˜æœ‰ä¸€ç§å¸¸æ•°ç©ºé—´å¤æ‚åº¦çš„å®ç°æ–¹æ³•ï¼Œæ¯”è¾ƒå·§å¦™ï¼Œæ€è·¯æ˜¯ç”¨ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶éå†é“¾è¡¨ï¼Œä¸€ä¸ªæŒ‡é’ˆèµ°çš„ä¸€å®šè¦æ¯”å¦ä¸€æŒ‡é’ˆå¿«ä¸€æ­¥ï¼Œè¿™æ„å‘³ç€ä¸¤è€…ä¸€å®šä¼šåœ¨æŸä¸€ç‚¹ç›¸é‡ï¼Œç»è¿‡è¯æ˜ï¼Œç›¸é‡ä½ç½®ä¸€å®šæ˜¯é“¾è¡¨çš„æœ€åä¸€ä½ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161541540.png" alt="image-20210816154108401" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">has_cycle_constant</span><span class="p">(</span><span class="n">link</span><span class="p">):</span>
    <span class="s">"""Return whether link contains a cycle."""</span>
    <span class="n">slow</span><span class="p">,</span> <span class="n">fast</span> <span class="o">=</span> <span class="n">link</span><span class="p">,</span> <span class="n">link</span><span class="p">.</span><span class="n">rest</span>
    <span class="k">while</span> <span class="n">fast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">fast</span><span class="p">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="c1"># å¦‚æœslowå·²ç»ä¸fast.restç›¸åŒï¼Œåˆ™ä¸éœ€è¦ç»§ç»­éå†äº†
</span>        
        <span class="k">if</span> <span class="n">slow</span> <span class="ow">is</span> <span class="n">fast</span> <span class="ow">or</span> <span class="n">slow</span> <span class="ow">is</span> <span class="n">fast</span><span class="p">.</span><span class="n">rest</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="n">slow</span><span class="p">,</span> <span class="n">fast</span> <span class="o">=</span> <span class="n">slow</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">fast</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">rest</span>
    <span class="k">return</span> <span class="bp">False</span>
</code></pre></div></div>

<h2 id="lab-08-trees--linked-lists">Lab 08 (Trees &amp; Linked Lists)<a id="anchor13"></a></h2>

<h3 id="mutate-itself-problem">Mutate itself problem</h3>

<h4 id="q4-tree">Q4 (Tree)</h4>

<p>è¿™ç§ç±»å‹çš„é¢˜ç›®è¦æ±‚åœ¨åŸæ•°æ®ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥<strong>ä¸å¯ä»¥è¿”å›ä»»ä½•å€¼</strong>ã€‚</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">cumulative_mul</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">"""Mutates t so that each node's label becomes the product of all labels in
    the corresponding subtree rooted at t."""</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
        <span class="n">cumulative_mul</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="o">*=</span> <span class="n">b</span><span class="p">.</span><span class="n">label</span>
</code></pre></div></div>

<p>åœ¨è¿™é‡Œé€’å½’çš„ä½œç”¨ä»…ä»…æ˜¯<strong>ä¸²è”ä¸åŒæ·±åº¦ï¼ˆæˆ–è€…å‰åä½ç½®ï¼‰</strong>ï¼Œä»–ä¸è¿”å›ä»»ä½•å€¼ï¼Œæ‰€ä»¥ä¸å¯èƒ½å‡ºç°ç±»ä¼¼äº<code class="language-plaintext highlighter-rouge">a=f(b)</code>çš„é€’å½’èµ‹å€¼è¡¨è¾¾å¼ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯ä¸­ä½œä¸ºè¿­ä»£å™¨ä½¿ç”¨ã€‚</p>

<h4 id="q3-linked-lists">Q3 (Linked Lists)</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161450117.png" alt="image-20210816144943625" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">every_other</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="s">"""Mutates a linked list so that all the odd-indiced elements are removed
    (using 0-based indexing)."""</span>
    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">rest</span>
        <span class="n">every_other</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span>
</code></pre></div></div>

<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥æ€è€ƒä¸ºä»€ä¹ˆåœ¨<code class="language-plaintext highlighter-rouge">Q3</code>ä¸­ï¼Œé€’å½’éƒ¨åˆ†æ”¾åœ¨å¯¹<code class="language-plaintext highlighter-rouge">S</code>æ“ä½œä¹‹åï¼Œè¿™æ˜¯å› ä¸ºè¿™é‡Œå¯¹<code class="language-plaintext highlighter-rouge">link list</code>çš„å¤„ç†æ˜¯ä»å‰å¾€åçš„ï¼Œè€Œåœ¨<code class="language-plaintext highlighter-rouge">Q4</code>ä¸­å¯¹<code class="language-plaintext highlighter-rouge">Tree</code>çš„å¤„ç†åˆ™æ˜¯ä»å¶ç»“ç‚¹é€æ¸ä¸Šå‡åˆ°<code class="language-plaintext highlighter-rouge">root</code>çš„ã€‚</p>

<h4 id="mutation--combination">Mutation &amp; Combination</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">combine_mutate</span><span class="p">(</span><span class="n">lnk1</span><span class="p">,</span><span class="n">lnk2</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">lnk1</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lnk2</span>
    <span class="k">if</span> <span class="n">lnk2</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">lnk1</span>
    <span class="k">if</span> <span class="n">lnk1</span><span class="p">.</span><span class="n">first</span> <span class="o">&lt;=</span> <span class="n">lnk2</span><span class="p">.</span><span class="n">first</span><span class="p">:</span>
        <span class="n">s</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">combine_mutate</span><span class="p">(</span><span class="n">lnk1</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span><span class="n">lnk2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">t</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">combine_mutate</span><span class="p">(</span><span class="n">lnk1</span><span class="p">,</span><span class="n">lnk2</span><span class="p">.</span><span class="n">rest</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>
</code></pre></div></div>

<h3 id="every-other-problem">Every-other problem</h3>

<p>å¤„ç†æ­¤ç±»é—®é¢˜æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>

<ol>
  <li>è·Ÿè¸ªç›®å‰æ‰€åœ¨çš„æ·±åº¦æˆ–è€…ä½ç½®</li>
  <li>åªå¤„ç†éœ€è¦å¤„ç†çš„å±‚ï¼ˆè¶Šè¿‡ä¸éœ€å¤„ç†çš„ä½ç½®ï¼‰</li>
</ol>

<p>ä¸Šè¾¹çš„<code class="language-plaintext highlighter-rouge">Q3</code>å°±æ˜¯é‡‡ç”¨äº†ç¬¬äºŒç§æ–¹æ³•ï¼Œå¯¹äºæ ‘ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿›è¡Œç±»ä¼¼çš„æ“ä½œï¼š</p>

<h4 id="optional-problem-2">Optional Problem 2</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">reverse_other</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="s">"""Mutates the tree such that nodes on every other (odd-depth) level
    have the labels of their branches all reversed."""</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
        <span class="k">return</span>
    <span class="n">label_of_branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">b</span><span class="p">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">label_of_branches</span><span class="p">)):</span>
        <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">label</span> <span class="o">=</span> <span class="n">label_of_branches</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># è¶Šè¿‡å¶æ•°å±‚
</span>        
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">branches</span><span class="p">:</span>
            <span class="n">reverse_other</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="disc-08">disc 08</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108171757041.png" alt="image-20210817175751914" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜ç›®å¦‚æœæˆ‘ä»¬é€šè¿‡ç¬¬ä¸€ç§æ–¹æ³•å®ç°ï¼Œåˆ™å¯ä»¥è®¾ç«‹<code class="language-plaintext highlighter-rouge">helper</code>å‡½æ•°è¿½è¸ªæ‰€åœ¨æ·±åº¦ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">alt_tree_map</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">map_fn</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">depth</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">depth</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">map_fn</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span>
        <span class="n">branches</span> <span class="o">=</span> <span class="p">[</span><span class="n">helper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">branches</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">helper</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="intersection-linked-list-problem">Intersection Linked List Problem</h3>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108162118629.png" alt="image-20210816211836540" style="zoom:50%;" /></p>

<p><strong>ä¸ªäººæ„Ÿè§‰è¿™æ˜¯ä¸€é“æœ‰å‚è€ƒæ„ä¹‰çš„é“¾è¡¨æ“ä½œé¢˜ç›®ï¼Œç›®çš„æ˜¯å°†åŸé“¾è¡¨ä¸­çš„æŸä¸€æ®µæ›¿æ¢ä¸ºæ–°çš„é“¾è¡¨å…ƒç´ </strong></p>

<p>é¦–å…ˆä¸ºäº†æ–¹ä¾¿åº”ç”¨<code class="language-plaintext highlighter-rouge">s.rest</code>è¿›è¡Œæ“ä½œï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘æŠŠé“¾è¡¨æŒ‡é’ˆç§»åŠ¨åˆ°<code class="language-plaintext highlighter-rouge">i==1</code>çš„ä½ç½®ï¼Œè¿™æ ·<code class="language-plaintext highlighter-rouge">s.rest</code>å°±ç›´æ¥å¯¹åº”ç€éœ€è¦æ“ä½œçš„éƒ¨åˆ†ï¼Œæ‰€ä»¥åœ¨<code class="language-plaintext highlighter-rouge">i&gt;1</code>æ—¶åº”å½“ä½¿ç”¨é€’å½’ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">replace</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åº”ç”¨<code class="language-plaintext highlighter-rouge">lab 08 Q3</code>ä¸­çš„æ“ä½œæŠ€å·§ï¼Œå°†éœ€è¦æ›¿æ¢çš„é“¾è¡¨æ®µå»é™¤ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="p">):</span>
    <span class="n">s</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">.</span><span class="n">rest</span>
</code></pre></div></div>

<p>ç°åœ¨ï¼Œè¦æŠŠ<code class="language-plaintext highlighter-rouge">t</code>æ’å…¥åˆ°å½“å‰çš„<code class="language-plaintext highlighter-rouge">s.rest</code>ä½ç½®ï¼ŒåŒæ—¶æŠŠä½™ä¸‹çš„<code class="language-plaintext highlighter-rouge">s</code>çš„å…ƒç´ æ’å…¥åˆ°å·²ç»è¢«è¿æ¥åˆ°<code class="language-plaintext highlighter-rouge">s</code>çš„<code class="language-plaintext highlighter-rouge">t</code>çš„æœ«å°¾ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬è¦æ‰¾åˆ°<code class="language-plaintext highlighter-rouge">t</code>çš„æœ«å°¾ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">end</span> <span class="o">=</span> <span class="n">t</span>
<span class="k">while</span> <span class="n">end</span><span class="p">.</span><span class="n">rest</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">end</span><span class="p">.</span><span class="n">rest</span>
</code></pre></div></div>

<p>ä¹‹ååšé“¾æ¥ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="n">rest</span><span class="p">,</span> <span class="n">end</span><span class="p">.</span><span class="n">rest</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">s</span><span class="p">.</span><span class="n">rest</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">environment diagram</code>ç”»å‡ºæ¥æ˜¯è¿™æ ·ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108162133696.png" alt="image-20210816213313660" style="zoom:50%;" /></p>

<h3 id="combine-problem">Combine Problem</h3>

<p>åœ¨<a href="#anchor">lab 05</a>ä¸­ï¼Œæœ‰ä¸€é“ç±»ä¼¼çš„ç»„åˆç»“æ„ç±»é¢˜ç›®ï¼Œä½¿ç”¨<code class="language-plaintext highlighter-rouge">zip</code>å‡½æ•°å°†ä¸¤æ£µæ ‘åˆå¹¶åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‹¿åˆ°é¢˜ç›®ç”¨æ›´æ™®éçš„å½¢å¼å†™å‡ºæ¥ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108171514913.png" alt="image-20210817151414785" style="zoom:50%;" /></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">combine_tree</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">combiner</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">combiner</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">label</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">label</span><span class="p">),[</span><span class="n">combine_tree</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">,</span><span class="n">combiner</span><span class="p">)</span> <span class="k">for</span> <span class="n">b1</span><span class="p">,</span><span class="n">b2</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">branches</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">branches</span><span class="p">)])</span>
</code></pre></div></div>

<p>åŒæ ·åœ°ï¼Œé¢å¯¹<code class="language-plaintext highlighter-rouge">lined lists</code>æ—¶æˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°è¿™ç§ç»„åˆç±»é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108171518981.png" alt="image-20210817151814869" style="zoom:50%;" /></p>

<p>å› ä¸ºæœ¬é¢˜ä¸­é“¾è¡¨çš„æ•°ç›®ä¸å®šï¼Œæ‰€ä»¥ä¸å¤ªæ–¹ä¾¿ä½¿ç”¨<code class="language-plaintext highlighter-rouge">zip</code>å‡½æ•°ï¼Œèƒ½æƒ³åˆ°çš„æ–¹æ³•æ˜¯è¦éå†<code class="language-plaintext highlighter-rouge">lst_of_lnks</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiply_lnks</span><span class="p">(</span><span class="n">lst_of_lnks</span><span class="p">):</span>
    <span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">lnk</span> <span class="ow">in</span> <span class="n">lst_of_lnks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lnk</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
</code></pre></div></div>

<p>ä¸ºäº†åŒæ—¶éå†å¤šä¸ªé“¾è¡¨ï¼Œæˆ‘ä»¬é¦–å…ˆè¦æŠŠå¤šä¸ªé“¾è¡¨çš„å¤´éƒ¨å…ƒç´ å…¨éƒ¨å¤„ç†å®Œï¼Œä¹‹åå»ºç«‹ä¸€ä¸ªå…¨éƒ¨ä¸º<code class="language-plaintext highlighter-rouge">link.rest</code>çš„é“¾è¡¨å¹¶é€’å½’ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">multiply_lnks</span><span class="p">(</span><span class="n">lst_of_lnks</span><span class="p">):</span>
    <span class="n">product</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">lnk</span> <span class="ow">in</span> <span class="n">lst_of_lnks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lnk</span> <span class="ow">is</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Link</span><span class="p">.</span><span class="n">empty</span>
        <span class="n">product</span> <span class="o">*=</span> <span class="n">lnk</span><span class="p">.</span><span class="n">first</span>
	<span class="n">lst_of_lnk_rest</span> <span class="o">=</span> <span class="p">[</span><span class="n">lnk</span><span class="p">.</span><span class="n">rest</span> <span class="k">for</span> <span class="n">lnk</span> <span class="ow">in</span> <span class="n">lst_of_lnks</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Link</span><span class="p">(</span><span class="n">product</span><span class="p">,</span><span class="n">multiply_lnks</span><span class="p">(</span><span class="n">lst_of_lnk_rest</span><span class="p">))</span>
</code></pre></div></div>

<h3 id="find-paths-problem">Find-Paths Problem</h3>

<p>ä¹‹å‰çš„ç›¸å…³ä¾‹å­ï¼š</p>

<ul>
  <li><a href="#anchor1">disc 05</a></li>
  <li><a href="#anchor2">4</a></li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108171647904.png" alt="image-20210817164711782" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜ä¸<a href="#anchor1">disc 05</a>ä¸åŒä¹‹å¤„åœ¨äºï¼Œæ ‘ä¸­å¯èƒ½å­˜åœ¨å¤šæ¡ç¬¦åˆé¢˜æ„çš„è·¯å¾„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ²¡æ³•ä½¿ç”¨å‰åºéå†äºŒå‰æ ‘çš„æ–¹æ³•ï¼Œå› ä¸ºæ ¹èŠ‚ç‚¹éœ€è¦å‡ºç°åœ¨æ¯ä¸€ä¸ªç¬¦åˆé¢˜æ„çš„è·¯å¾„æœ€å‰ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æ¯ä¸€æ¬¡å¾ªç¯ä¸­éƒ½æŠŠå½“å‰çš„æ ¹èŠ‚ç‚¹åŠ ä¸Šï¼Œè®¾ç«‹ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">paths</code>æ•°ç»„å®Œæˆæ­¤ç›®æ ‡ï¼Œé¦–å…ˆè€ƒè™‘<code class="language-plaintext highlighter-rouge">base case</code>ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">find_paths</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">entry</span><span class="p">):</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">t</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">entry</span><span class="p">:</span>
        <span class="n">paths</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">])</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">base case</code>ä¸å¯ä»¥ç›´æ¥è¿”å›<code class="language-plaintext highlighter-rouge">[t.label]</code>ï¼Œæˆ‘ä»¬è¦æŠŠç»“æœå‚¨å­˜åœ¨<code class="language-plaintext highlighter-rouge">paths</code>ä¸­ï¼Œæœ€åè¿”å›<code class="language-plaintext highlighter-rouge">paths</code></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">t</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
    <span class="c1"># è€ƒå¯Ÿbranchesä¸‹çš„å¤šä¸ªè·¯å¾„ï¼š
</span>    
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">find_paths</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
        <span class="c1"># å¯¹äºæ¯ä¸€ä¸ªè·¯å¾„ï¼Œéƒ½è¦åŠ ä¸Šæ ¹èŠ‚ç‚¹çš„å€¼
</span>        
        <span class="n">paths</span><span class="p">.</span><span class="n">append</span><span class="p">([</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">paths</span>
</code></pre></div></div>

<blockquote>
  <p>è¿™é“é¢˜ç›®ä¹Ÿä¸º<a href="#anchor2">4</a>çš„è§£æ³•æä¾›äº†æ–°çš„æ€è·¯</p>
</blockquote>

<h3 id="matching-problem">Matching Problem</h3>

<blockquote>
  <p>fa18-mt2</p>
</blockquote>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192258678.png" alt="image-20210819225824522" style="zoom:50%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192307437.png" alt="image-20210819230739254" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜ç›®åº”å½“è¿˜æœ‰å¦ä¸€ç§åšæ³•ï¼šå…ˆé€šè¿‡<code class="language-plaintext highlighter-rouge">zip</code>å‡½æ•°æŠŠä¸¤ä¸ªæ ‘ç»„åˆèµ·æ¥ï¼Œç»„åˆæ ‘çš„èŠ‚ç‚¹å€¼ä¸ºåŒ…å«ä¸¤ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå¯ä»¥é€šè¿‡æœç´¢ç»„åˆæ ‘èŠ‚ç‚¹å€¼ï¼Œæ¥ç¡®å®šå¯¹åº”çš„å­—å…¸å€¼ä¸ºå¤šå°‘ã€‚</p>

<p>é¢˜ç›®ä¸­çš„åšæ³•æ˜¯å…ˆå¤„ç†ä¸€æ£µæ ‘ï¼Œå¤„ç†çš„å…³é”®éƒ¨åˆ†åœ¨äºå‡½æ•°<code class="language-plaintext highlighter-rouge">lookups</code>é‡Œ<code class="language-plaintext highlighter-rouge">for</code>å¾ªç¯çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸¤æ¡æ€è·¯æ¥å¡«è¿™ä¸ªç©ºï¼š</p>

<ol>
  <li>è€ƒå¯Ÿå¯»æ‰¾çš„å€¼å°±ä½äºæ ¹èŠ‚ç‚¹ä¸‹è¾¹ä¸€å±‚çš„æƒ…å†µï¼ˆè¿™ä¸ªæƒ³æ³•è¿˜å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç¡®å®š<code class="language-plaintext highlighter-rouge">new_lookup</code>çš„å†…å®¹ï¼‰</li>
  <li>åœ¨ä¸€ä¸ªåˆ†æ”¯ä¸­ï¼Œè¿˜è¦ç»§ç»­å¯»æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ°å¯¹åº”çš„å€¼ä¸ºæ­¢ï¼Œæ‰€ä»¥éœ€è¦å»ºç«‹ä¸€ä¸ªé€’å½’</li>
</ol>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">lookups</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">k</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">key</span><span class="p">:</span>
        <span class="k">yield</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span><span class="p">.</span><span class="n">label</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">branches</span><span class="p">)):</span>
        <span class="c1"># å¯ä»¥åªè€ƒè™‘å¯¹åº”å€¼ä½äºæ ¹èŠ‚ç‚¹ä¸‹è¾¹ä¸€å±‚çš„æƒ…å†µ
</span>        
        <span class="k">for</span> <span class="n">lookup</span> <span class="ow">in</span> <span class="n">lookups</span><span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">new_lookup</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">lookup</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">new_lookup</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">branches</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">g</span>
</code></pre></div></div>

<blockquote>
  <p>å¦‚æœè¦å®Œå…¨éªŒè¯è¯¥é€’å½’çš„æ­£ç¡®æ€§ï¼Œæˆ‘ä»¬ä¼šå‘ç°<code class="language-plaintext highlighter-rouge">lookups</code>è¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå…¶ä¸­å†…å®¹ä¸º<code class="language-plaintext highlighter-rouge">new_lookup(i1,new_lookup(i2,...))</code>ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œå½“<code class="language-plaintext highlighter-rouge">v</code>ä½œä¸ºå‚æ•°ç»™å…¥æ—¶ï¼Œå°±ä¼šæŒç»­è¢«æ›´æ–°ä¸º<code class="language-plaintext highlighter-rouge">v.branches[i1].branches[i2]...</code></p>
</blockquote>

<h3 id="prune-trees-problem">Prune trees Problem</h3>

<p>åŸºæœ¬çš„<a href="#anchor19">è£å‰ªé—®é¢˜</a>çš„è¿›åŒ–ç‰ˆ</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192323973.png" alt="image-20210819232322853" style="zoom: 50%;" /></p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108192324689.png" alt="image-20210819232413529" style="zoom:50%;" /></p>

<p>è¿™é¢˜ç›®å¥½é•¿â€¦â€¦</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">pluck</span><span class="p">(</span><span class="n">pine</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">plucker</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">pluck_one_leaf</span><span class="p">(</span><span class="n">cyprus</span><span class="p">):</span>
            <span class="s">"""Return a copy of cyprus without leaf k and check that k is a
            leaf label, not an interior node label.
            """</span>
            <span class="c1"># base case, it will not be a leaf
</span>            
            <span class="k">if</span> <span class="n">cyprus</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">'Hey, not valid!'</span>
            <span class="n">plucked_branches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">cyprus</span><span class="p">.</span><span class="n">branches</span><span class="p">:</span>
                <span class="c1"># è·³è¿‡æŸä¸ªå¶ç»“ç‚¹
</span>                
                <span class="n">skip_this_leaf</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">k</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">b</span><span class="p">.</span><span class="n">branches</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_this_leaf</span><span class="p">:</span>
                    <span class="n">plucked_branch_or_error</span> <span class="o">=</span> <span class="n">pluck_one_leaf</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plucked_branch_or_error</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="k">return</span> <span class="n">plucked_branch_or_error</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plucked_branches</span> <span class="o">+=</span> <span class="p">[</span><span class="n">plucked_branch_or_error</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">Tree</span><span class="p">(</span><span class="n">cyprus</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">plucked_branches</span><span class="p">)</span>
        <span class="k">nonlocal</span> <span class="n">pine</span>
        <span class="k">if</span> <span class="n">pine</span><span class="p">.</span><span class="n">is_leaf</span><span class="p">():</span>
            <span class="k">assert</span> <span class="n">k</span> <span class="o">==</span> <span class="n">pine</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="s">'all k must appear in pine'</span>
            <span class="k">return</span> <span class="s">'success!'</span>
        <span class="c1"># æ¯æ¬¡è¿”å›ä¸€ä¸ªè¢«è£å‰ªä¹‹åçš„æ–°æ ‘ï¼Œåˆ°è¿™ä¸€æ­¥çš„ä¸€å®šå·²ç»ä¸æ˜¯å¶ç»“ç‚¹äº†
</span>        
        <span class="n">pine</span> <span class="o">=</span> <span class="n">pluck_one_leaf</span><span class="p">(</span><span class="n">pine</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pine</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">pine</span>
        <span class="k">return</span> <span class="n">plucker</span>
    <span class="k">return</span> <span class="n">plucker</span>
</code></pre></div></div>

<blockquote>
  <p>æ³¨æ„åˆ°å‡½æ•°å†…éƒ¨è£å‰ªæŸä¸ªèŠ‚ç‚¹æ‰€ä½¿ç”¨çš„æ–¹æ³•</p>
</blockquote>

<h2 id="f20-lecture-23-modular-programming">F20 Lecture 23 (Modular Programming)</h2>

<p>åœ¨æ•™æˆç»™å‡ºçš„ä¾‹å­å½“ä¸­ï¼Œä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ„å»º<code class="language-plaintext highlighter-rouge">restuarant</code>åˆ—è¡¨+æ„å»º<code class="language-plaintext highlighter-rouge">reviewers</code>åˆ—è¡¨ï¼ˆä¸»è¦å‚è€ƒå…¶<strong>å¯¹<code class="language-plaintext highlighter-rouge">json</code>æ–‡ä»¶çš„æ“ä½œæµç¨‹</strong>ï¼‰</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">load_reviews</span><span class="p">(</span><span class="n">reviews_file</span><span class="p">):</span>
    <span class="n">reviewers_by_restaurant</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">reviews_file</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">business_id</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="s">'business_id'</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">business_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">reviewers_by_restaurant</span><span class="p">:</span>
            <span class="n">reviewers_by_restaurant</span><span class="p">[</span><span class="n">business_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">reviewers_by_restaurant</span><span class="p">[</span><span class="n">business_id</span><span class="p">].</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s">'user_id'</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">reviewers_by_restaurant</span>

<span class="k">def</span> <span class="nf">load_restaurants</span><span class="p">(</span><span class="n">reviewers_by_restaurant</span><span class="p">,</span> <span class="n">restaurants_file</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">restaurants_file</span><span class="p">):</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">reviewers</span> <span class="o">=</span> <span class="n">reviewers_by_restaurant</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s">'business_id'</span><span class="p">],</span> <span class="p">[])</span>
        <span class="n">Restaurant</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="s">'name'</span><span class="p">],</span> <span class="n">b</span><span class="p">[</span><span class="s">'stars'</span><span class="p">],</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">reviewers</span><span class="p">))</span>

<span class="n">load_restaurants</span><span class="p">(</span><span class="n">load_reviews</span><span class="p">(</span><span class="s">'reviews.json'</span><span class="p">),</span> <span class="s">'restaurants.json'</span><span class="p">)</span>
</code></pre></div></div>

<p>åŒæ—¶ï¼Œæ¡ˆä¾‹ä¸­å¯¹<code class="language-plaintext highlighter-rouge">similarity</code>çš„è€ƒå¯Ÿå‡½æ•°è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°†å…¶ä»<code class="language-plaintext highlighter-rouge">quadortic time</code>å˜åŒ–ä¸º<code class="language-plaintext highlighter-rouge">linear time</code>ï¼Œæ–¹æ³•æ˜¯å¯¹ä¸¤ä¸ªä»¥åŠ<strong>è¢«æ’åºå¥½çš„åˆ—è¡¨</strong>ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶éå†ï¼Œå¹¶æ ¹æ®æ•°æ®å¤§å°å†³å®šç§»åŠ¨å“ªä¸€ä¸ªæŒ‡é’ˆï¼š</p>

<blockquote>
  <p>Linear time Intersection of Sorted Lists:</p>

  <p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108161602713.png" alt="image-20210816160219593" style="zoom:50%;" /></p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fast_overlap</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="s">"""Return the overlap between sorted S and sorted T."""</span>
    <span class="n">count</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">count</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">count</span>
</code></pre></div></div>

<h2 id="f20-lecture-27-functional-programming">F20 Lecture 27 (Functional Programming)</h2>

<h3 id="basic-definition">Basic Definition</h3>

<p>ä½¿ç”¨<strong>scheme</strong>è¯­è¨€è¿›è¡Œå‡½æ•°å¼ç¼–ç¨‹ï¼ŒåŸºæœ¬çš„æ¦‚å¿µå¦‚ä¸‹ï¼š</p>

<ul>
  <li>Scheme Expressions</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261419639.png" alt="image-20210826141911958" style="zoom:50%;" /></p>

<ul>
  <li>Special Forms</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261420911.png" alt="image-20210826142031787" style="zoom:50%;" /></p>

<blockquote>
  <p>è¿™é‡Œçš„proceduresä¹Ÿå³functions</p>
</blockquote>

<ul>
  <li>Lambda Expressions</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261425540.png" alt="image-20210826142521407" style="zoom:50%;" /></p>

<ul>
  <li>More Special Forms</li>
</ul>

<blockquote>
  <p>Let\cons\car\cdr\nil\cond\beginâ€¦</p>
</blockquote>

<ul>
  <li>Symbolic Programming</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261431274.png" alt="image-20210826143132167" style="zoom:50%;" /></p>

<ul>
  <li>Quasiquotation</li>
</ul>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261436376.png" alt="image-20210826143609252" style="zoom:50%;" /></p>

<blockquote>
  <div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">atom?</span> <span class="ss">'a</span><span class="p">)</span>
<span class="no">#t</span>
</code></pre></div>  </div>
</blockquote>

<h3 id="interpreters">Interpreters</h3>

<h4 id="parsing-expressions">Parsing Expressions</h4>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108261451480.png" alt="image-20210826145113359" style="zoom:50%;" /></p>

<p>åŒ…å«è¯æ³•åˆ†æä¸å¥æ³•åˆ†æä¸¤éƒ¨åˆ†ï¼š</p>

<ul>
  <li>Lexical analysis: interprets a string as a token sequence is called a <em>tokenizer</em> or <em>lexical analyzer</em></li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">tokenize_line</span><span class="p">(</span><span class="s">'(+ 1 (* 2.3 45))'</span><span class="p">)</span>
<span class="p">[</span><span class="s">'('</span><span class="p">,</span> <span class="s">'+'</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'('</span><span class="p">,</span> <span class="s">'*'</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s">')'</span><span class="p">,</span> <span class="s">')'</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>Syntactic analysis: The component that interprets a token sequence as an expression tree is called a <em>syntactic analyzer</em>. Syntactic analysis is a tree-recursive process, and it must consider an entire expression that may span multiple lines.</li>
</ul>

<p>å› ä¸ºåœ¨å¥æ³•åˆ†ææ—¶ï¼Œè¦åŒ…å«åˆ†æå¯èƒ½å­˜åœ¨çš„<code class="language-plaintext highlighter-rouge">subexpression</code>ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">tree recursion</code></p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">scheme_read</code> function first checks for various base cases, including empty input (which raises an end-of-file exception, called <code class="language-plaintext highlighter-rouge">EOFError</code> in Python) and primitive expressions. A recursive call to <code class="language-plaintext highlighter-rouge">read_tail</code> is invoked whenever a <code class="language-plaintext highlighter-rouge">(</code> token indicates the beginning of a list.</p>

  <p>The <code class="language-plaintext highlighter-rouge">read_tail</code> function continues to read from the same input <code class="language-plaintext highlighter-rouge">src</code>, but expects to be called after a list has begun. Its base cases are an empty input (an error) or a closing parenthesis that terminates the list. Its recursive call reads the first element of the list with <code class="language-plaintext highlighter-rouge">scheme_read</code>, reads the rest of the list with <code class="language-plaintext highlighter-rouge">read_tail</code>, and then returns a list represented as a <code class="language-plaintext highlighter-rouge">Pair</code>.</p>
</blockquote>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Scheme list parser, without quotation or dotted lists.
</span>
<span class="k">def</span> <span class="nf">scheme_read</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="s">"""Read the next expression from src, a Buffer of tokens."""</span>
    <span class="k">if</span> <span class="n">src</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">EOFError</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">src</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s">'nil'</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nil</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DELIMITERS</span><span class="p">:</span>  <span class="c1"># ( ) ' .
</span>        <span class="k">return</span> <span class="n">val</span>
    <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="s">"("</span><span class="p">:</span>
        <span class="c1"># å¼€å§‹ä¸€å±‚æ‹¬å·çš„é€’å½’
</span>        
        <span class="k">return</span> <span class="n">read_tail</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">SyntaxError</span><span class="p">(</span><span class="s">"unexpected token: {0}"</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">read_tail</span><span class="p">(</span><span class="n">src</span><span class="p">):</span>
    <span class="s">"""Return the remainder of a list in src, starting before an element or )."""</span>
    <span class="k">if</span> <span class="n">src</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nb">SyntaxError</span><span class="p">(</span><span class="s">"unexpected end of file"</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">src</span><span class="p">.</span><span class="n">current</span><span class="p">()</span> <span class="o">==</span> <span class="s">")"</span><span class="p">:</span>
        <span class="n">src</span><span class="p">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">nil</span>
        <span class="c1"># åªæœ‰åˆå‡ºç°ä¸€å±‚parenthesisæ—¶æ‰ä¼šå‡ºç°å†…å±‚é€’å½’ï¼Œå¦åˆ™æ˜¯scheme_readçš„base caseï¼Œè¿”å›val
</span>        
        <span class="c1"># å¦‚æœåœ¨æŸä¸€å±‚é€’å½’å†…æ‰¾åˆ°äº†')'ï¼Œåˆ™æœ¬å±‚é€’å½’ç»“æŸ
</span>        
    <span class="n">first</span> <span class="o">=</span> <span class="n">scheme_read</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="n">rest</span> <span class="o">=</span> <span class="n">read_tail</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Pair</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
</code></pre></div></div>

<p>é€šè¿‡å¥æ³•åˆ†æï¼Œå°†è¯æ³•åˆ†ææ„æˆçš„<code class="language-plaintext highlighter-rouge">token_list</code>è½¬åŒ–ä¸º<code class="language-plaintext highlighter-rouge">Pair Object</code>. ä¹‹åæˆ‘ä»¬è¦æ ¹æ®<code class="language-plaintext highlighter-rouge">scheme_list</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">operator</code>å¯¹<code class="language-plaintext highlighter-rouge">operands</code>é‡‡å–é€‚å½“çš„æ“ä½œï¼š</p>

<h4 id="evaluation--apply">Evaluation &amp; Apply</h4>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scheme_eval</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">_</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">"""Evaluate Scheme expression EXPR in environment ENV."""</span>
    <span class="c1"># Evaluate atoms
</span>    
    <span class="k">if</span> <span class="n">scheme_symbolp</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">env</span><span class="p">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">self_evaluating</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">expr</span>
    <span class="c1"># All non-atomic expressions are lists (combinations)
</span>    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">scheme_listp</span><span class="p">(</span><span class="n">expr</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SchemeError</span><span class="p">(</span><span class="s">'malformed list: {0}'</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">repl_str</span><span class="p">(</span><span class="n">expr</span><span class="p">)))</span>
    <span class="n">first</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">expr</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">expr</span><span class="p">.</span><span class="n">rest</span>
    <span class="k">if</span> <span class="n">scheme_symbolp</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="ow">and</span> <span class="n">first</span> <span class="ow">in</span> <span class="n">SPECIAL_FORMS</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SPECIAL_FORMS</span><span class="p">[</span><span class="n">first</span><span class="p">](</span><span class="n">rest</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># é€šè¿‡scheme_eval(first, env)å°†strè½¬åŒ–ä¸ºprocedureï¼Œä¹Ÿå°±æ˜¯å‡½æ•°ï¼Œåˆ©ç”¨çš„æ˜¯base caseçš„è¿”å›å€¼
</span>
        <span class="n">operator1</span> <span class="o">=</span> <span class="n">scheme_eval</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operator1</span><span class="p">,</span> <span class="n">MacroProcedure</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">scheme_eval</span><span class="p">(</span><span class="n">operator1</span><span class="p">.</span><span class="n">apply_macro</span><span class="p">(</span><span class="n">rest</span><span class="p">,</span> <span class="n">env</span><span class="p">),</span> <span class="n">env</span><span class="p">)</span>
        <span class="n">validate_procedure</span><span class="p">(</span><span class="n">operator1</span><span class="p">)</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">rest</span><span class="p">.</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x1</span><span class="p">:</span> <span class="n">scheme_eval</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">env</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">scheme_apply</span><span class="p">(</span><span class="n">operator1</span><span class="p">,</span> <span class="n">arguments</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">scheme_eval</code>çš„è®¾è®¡æ¥å—åµŒå¥—å½¢å¼çš„è¡¨è¾¾å¼ï¼Œæœ€ååªéœ€æŠŠå·²ç»è®¡ç®—è¿‡çš„å­è¡¨è¾¾å¼ä¼ é€’ç»™<code class="language-plaintext highlighter-rouge">scheme_apply</code>å³å¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº”å¯¹ç€ä¸‰ç§ä¸åŒçš„å‚æ•°ä¼ å…¥å½¢å¼ï¼š<code class="language-plaintext highlighter-rouge">primitive expressionsã€call expressionsã€special forms</code>ï¼Œåªæœ‰<code class="language-plaintext highlighter-rouge">call expressions</code>ä¼šç›´æ¥åœ¨<code class="language-plaintext highlighter-rouge">scheme_eval</code>å†…éƒ¨ç»§ç»­é€’å½’ï¼Œ<code class="language-plaintext highlighter-rouge">special_form</code>çš„å¤„ç†æ˜¯äº¤ç»™<code class="language-plaintext highlighter-rouge">scheme.py</code>é‡Œçš„<code class="language-plaintext highlighter-rouge">do_xx_form</code>.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">calc_apply</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="s">"""Apply the named operator to a list of args."""</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">operator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span> <span class="o">+</span> <span class="s">' is not a symbol'</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'+'</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'-'</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="n">operator</span> <span class="o">+</span> <span class="s">' requires at least 1 argument'</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">args</span><span class="p">.</span><span class="n">first</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'*'</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">mul</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span> <span class="o">==</span> <span class="s">'/'</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="n">operator</span> <span class="o">+</span> <span class="s">' requires at least 1 argument'</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span><span class="o">/</span><span class="n">args</span><span class="p">.</span><span class="n">first</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">reduce</span><span class="p">(</span><span class="n">truediv</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">second</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="n">operator</span> <span class="o">+</span> <span class="s">' is an unknown operator'</span><span class="p">)</span>
</code></pre></div></div>

<p>è¿™é‡Œä½¿ç”¨çš„æ˜¯è¯¾ç¨‹å†…å®¹é‡Œ<code class="language-plaintext highlighter-rouge">calculator</code>çš„<code class="language-plaintext highlighter-rouge">calc_apply</code>å‡½æ•°ï¼Œå› ä¸ºæ›´èƒ½ç›´æ¥åœ°ä½“ç°å‡ºè¯¥å‡½æ•°çš„ä½œç”¨ï¼Œ<code class="language-plaintext highlighter-rouge">scheme_apply</code>å‡½æ•°ä¼šåœ¨æ¯æ¬¡<code class="language-plaintext highlighter-rouge">scheme_eval</code>å¯¹<code class="language-plaintext highlighter-rouge">call_expression</code>è¯„ä¼°å®Œæˆåä½¿ç”¨ã€‚<code class="language-plaintext highlighter-rouge">scheme_apply</code>çš„è®¾è®¡é€»è¾‘ä¸ºï¼š</p>

<ul>
  <li><em>Apply</em> happens in the <code class="language-plaintext highlighter-rouge">scheme_apply</code> function. If the function is a built-in procedure, <code class="language-plaintext highlighter-rouge">scheme_apply</code> calls the <code class="language-plaintext highlighter-rouge">apply</code> method of that <code class="language-plaintext highlighter-rouge">BuiltInProcedure</code> instance. If the procedure is a user-defined procedure, <code class="language-plaintext highlighter-rouge">scheme_apply</code> creates a new call frameï¼ˆåœ¨å…¶ä¸­å°†å‚æ•°ä¸å€¼ç»‘å®šï¼‰ and calls <code class="language-plaintext highlighter-rouge">eval_all</code> on the body of the procedure, resulting in a <strong>mutually</strong> recursive eval-apply loop.</li>
</ul>

<h4 id="read-eval-print-loops">Read-eval-print-loops</h4>

<p>é€šè¿‡<strong>REPL</strong>çš„æ–¹æ³•ï¼Œå¯ä»¥å®ç°ä¸<code class="language-plaintext highlighter-rouge">interpreter</code>çš„äº¤äº’ï¼š</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="k">def</span> <span class="nf">read_eval_print_loop</span><span class="p">():</span>
        <span class="s">"""Run a read-eval-print loop for calculator."""</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">src</span> <span class="o">=</span> <span class="n">buffer_input</span><span class="p">()</span>
                <span class="k">while</span> <span class="n">src</span><span class="p">.</span><span class="n">more_on_line</span><span class="p">:</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">scheme_read</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
                    <span class="k">print</span><span class="p">(</span><span class="n">calc_eval</span><span class="p">(</span><span class="n">expression</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="nb">SyntaxError</span><span class="p">,</span> <span class="nb">TypeError</span><span class="p">,</span> <span class="nb">ValueError</span><span class="p">,</span> <span class="nb">ZeroDivisionError</span><span class="p">)</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">err</span><span class="p">).</span><span class="n">__name__</span> <span class="o">+</span> <span class="s">':'</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="nb">KeyboardInterrupt</span><span class="p">,</span> <span class="nb">EOFError</span><span class="p">):</span>  <span class="c1"># &lt;Control&gt;-D, etc.
</span>                <span class="k">print</span><span class="p">(</span><span class="s">'Calculation completed.'</span><span class="p">)</span>
                <span class="k">return</span>
</code></pre></div></div>

<p>å¦‚æœæˆ‘ä»¬å°†ä¸Šè¿°å‡ ä¸ªåŸºæœ¬æ­¥éª¤æ‹“å±•åˆ°<code class="language-plaintext highlighter-rouge">scheme interpreter</code>çš„å®ç°ä¸­ï¼Œå‚è§è¯¦ç»†çš„æ–‡æ¡£æè¿°ï¼š</p>

<p>http://composingprograms.com/pages/35-interpreters-for-languages-with-abstraction.html</p>

<h4 id="å…³äºschemeä¸­çš„lambda">å…³äºschemeä¸­çš„lambda</h4>

<p><code class="language-plaintext highlighter-rouge">lambda</code>ä¸º<code class="language-plaintext highlighter-rouge">scheme</code>ä¸­çš„ä¸€äº›å…¶ä»–çš„<code class="language-plaintext highlighter-rouge">special form</code>æä¾›äº†æ–¹æ³•ï¼Œæ¯”å¦‚<code class="language-plaintext highlighter-rouge">define user-defined procedures</code>:</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">scm&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="nv">f</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">)))</span>
<span class="nv">f</span>
<span class="c1">; ç®€å†™çš„å½¢å¼å³ä¸ºï¼š</span>

<span class="nv">scm&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">f</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="mi">2</span><span class="p">))</span>
</code></pre></div></div>

<p>åŒæ—¶ï¼Œå¯¹äº<code class="language-plaintext highlighter-rouge">let</code>ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">lambda</code>è¿›è¡Œè½¬åŒ–ï¼Œè¿™æ˜¯<code class="language-plaintext highlighter-rouge">scheme interpreter</code>é¡¹ç›®ä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œæ‘˜å‡ºä¸€éƒ¨åˆ†ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">((</span><span class="nf">let?</span> <span class="nv">expr</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nb">values</span> <span class="p">(</span><span class="nb">cadr</span> <span class="nv">expr</span><span class="p">))</span>
        <span class="p">(</span><span class="nf">body</span>   <span class="p">(</span><span class="nb">cddr</span> <span class="nv">expr</span><span class="p">)))</span>
  <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'lambda</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nf">zip</span> <span class="nv">values</span><span class="p">))</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">let-to-lambda</span> <span class="nv">body</span><span class="p">)))</span> <span class="nv">nil</span><span class="p">)</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">let-to-lambda</span> <span class="p">(</span><span class="nb">cadr</span> <span class="p">(</span><span class="nf">zip</span> <span class="nv">values</span><span class="p">))))</span>
    <span class="p">))</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">scheme</code>ä¸­å¤„ç†é€’å½’é—®é¢˜çš„ä¸€ä¸ªå¸¸ç”¨æ‰‹æ³•æ˜¯ä½¿ç”¨<code class="language-plaintext highlighter-rouge">map</code>å‡½æ•°ï¼Œè¿™å…è®¸æˆ‘ä»¬å¤„ç†åµŒå¥—çš„å­è¡¨è¾¾å¼ã€‚è€Œå› ä¸º<code class="language-plaintext highlighter-rouge">let</code>å¸¦æœ‰çš„è¡¨è¾¾å¼ä¸­å¯èƒ½å­˜åœ¨å¥½å‡ ä¸ªå­<code class="language-plaintext highlighter-rouge">list</code>ï¼Œæ‰€æœ€åè¦å°†ä»–ä»¬<code class="language-plaintext highlighter-rouge">append</code>åœ¨ä¸€èµ·ã€‚å½¢æˆå¦‚ä¸‹çš„æ•ˆæœï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">scm&gt;</span> <span class="p">(</span><span class="nf">let-to-lambda</span> <span class="o">'</span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">a</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">b</span> <span class="mi">2</span><span class="p">))</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)))</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span> <span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">scm&gt;</span> <span class="p">(</span><span class="nf">let-to-lambda</span> <span class="o">'</span><span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">a</span> <span class="mi">1</span><span class="p">))</span> <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">b</span> <span class="nv">a</span><span class="p">))</span> <span class="nv">b</span><span class="p">)))</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">a</span><span class="p">)</span> <span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nf">b</span><span class="p">)</span> <span class="nv">b</span><span class="p">)</span> <span class="nv">a</span><span class="p">))</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="map">map</h4>

<p>å…³äº<code class="language-plaintext highlighter-rouge">scheme</code>ä¸­<code class="language-plaintext highlighter-rouge">map</code>çš„ä½¿ç”¨ï¼Œè¿™é‡Œè¿˜æœ‰å‡ ä¸ªä¾‹å­ï¼š</p>

<ol>
  <li>è®¾è®¡<code class="language-plaintext highlighter-rouge">scheme</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">zip</code>å‡½æ•°ï¼š</li>
</ol>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">zip</span> <span class="nv">lst</span><span class="p">)</span> 
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">=</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">length</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">)))</span> 
    <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">car</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">car</span> <span class="nv">lst</span><span class="p">)</span> <span class="p">(</span><span class="nf">zip</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">cdr</span> <span class="nv">lst</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<ol>
  <li>Fall 2019 final Q7</li>
</ol>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108271319812.png" alt="image-20210827131922919" style="zoom:50%;" /></p>

<p>å…¶ä¸­ï¼Œ<code class="language-plaintext highlighter-rouge">(b)</code>çš„è§£æ³•å¯ä»¥è¿™æ ·ç†è§£ï¼šé¦–å…ˆæ€è€ƒå‡½æ•°çš„åŠŸèƒ½ï¼Œä»æŠ½è±¡å±‚é¢æ€è€ƒä»£ç å®ç°ï¼š<code class="language-plaintext highlighter-rouge">mul-expr</code>çš„åŠŸèƒ½æ˜¯å°†æ‰€æœ‰çš„<code class="language-plaintext highlighter-rouge">sub-expression</code>æˆ–è€…<code class="language-plaintext highlighter-rouge">primitive expression</code>ä¹˜èµ·æ¥ï¼Œè€Œä¸ºäº†è¾¾åˆ°æ­¤ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦å°†<strong>æ¯ä¸€ä¸ªå­è¡¨è¾¾å¼</strong>å…¨éƒ¨æ˜ å°„ä¸ºï¼ˆè½¬åŒ–ä¸ºï¼‰å€¼ï¼Œå†å°†è¿™äº›å€¼ç›¸ä¹˜å¾—åˆ°æœ€åçš„ç»“æœ â€“ å¯ä»¥é€šè¿‡<code class="language-plaintext highlighter-rouge">map</code>å‡½æ•°çš„æ–¹æ³•å®ç°ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">number?</span> <span class="nv">e</span><span class="p">)</span> <span class="nv">e</span>
    <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">mul-expr</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">e</span><span class="p">))))</span>
</code></pre></div></div>

<p>åœ¨æœ‰äº†<code class="language-plaintext highlighter-rouge">(b)</code>çš„åŸºç¡€ä¹‹åï¼Œ<code class="language-plaintext highlighter-rouge">c</code>å…¶å®æ˜¯ä¸€æ ·çš„æ€è·¯ï¼Œæœ€ç»ˆçš„æ•ˆæœåº”è¯¥å¦‚ä¸‹ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">*-to-mul</span> <span class="o">'</span><span class="p">(</span><span class="nb">*</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nb">*</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)))</span><span class="nv">-&gt;</span><span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">1</span> <span class="mi">2</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">list</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))))</span>
</code></pre></div></div>

<p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬é‡åˆ°<code class="language-plaintext highlighter-rouge">*</code>æ—¶ï¼Œå°±åº”å½“ç«‹åˆ»æŠŠ<code class="language-plaintext highlighter-rouge">*</code>æ›¿æ¢ä¸º<code class="language-plaintext highlighter-rouge">mul</code>ï¼ŒåŒæ—¶åœ¨å®ƒçš„<code class="language-plaintext highlighter-rouge">sub-expression</code>ä¸Šåº”ç”¨<code class="language-plaintext highlighter-rouge">(b)</code>çš„<code class="language-plaintext highlighter-rouge">map</code>è¿›è¡Œä¸‹ä¸€å±‚é€’å½’ã€‚è€Œå½“ç¬¦å·ä¸æ˜¯<code class="language-plaintext highlighter-rouge">*</code>æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è¿”å›åŸæ¥çš„è¡¨è¾¾å¼å³å¯ï¼Œå¹¶ä¸éœ€è¦å…¶ä»–å¤šä½™çš„æ“ä½œã€‚</p>

<p>ä¸ªäººæ„Ÿè§‰è¿™æ ·å†™æ›´æ¸…æ¥šä¸€äº›ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">*-to-mul</span> <span class="nv">e</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">not</span> <span class="p">(</span><span class="nb">list?</span> <span class="nv">e</span><span class="p">))</span><span class="nv">e</span>
      <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nf">op</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">e</span><span class="p">))</span> <span class="p">(</span><span class="nf">rest</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">e</span><span class="p">))</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">equal?</span> <span class="nv">op</span> <span class="ss">'*</span><span class="p">)</span>
                <span class="p">(</span><span class="nb">list</span> <span class="ss">'mul</span> <span class="p">(</span><span class="nb">cons</span> <span class="ss">'list</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">*-to-mul</span> <span class="nv">rest</span><span class="p">)))</span>
                <span class="p">(</span><span class="nb">cons</span> <span class="nv">op</span> <span class="nv">rest</span><span class="p">))))))</span>
</code></pre></div></div>

<h4 id="tree-recursionåœ¨schemeä¸­çš„åº”ç”¨">Tree recursionåœ¨schemeä¸­çš„åº”ç”¨</h4>

<h5 id="project-scheme-q17">Project Scheme Q17</h5>

<p>åœ¨ä¹‹å‰çš„<code class="language-plaintext highlighter-rouge">Parsing Expressions</code>éƒ¨åˆ†ï¼Œåœ¨åšå¥æ³•åˆ†ææ—¶ï¼Œè®¾è®¡äº†<code class="language-plaintext highlighter-rouge">scheme_read</code>å’Œ<code class="language-plaintext highlighter-rouge">read_tail</code>å‡½æ•°ï¼Œå¹¶é€šè¿‡<code class="language-plaintext highlighter-rouge">mutual recursion</code>çš„æ–¹æ³•è¿›è¡Œäº†ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">tree recursion</code>çš„è¿‡ç¨‹ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†è¿™ç§æ€è·¯ç›´æ¥è¿ç”¨åˆ°<code class="language-plaintext highlighter-rouge">scheme</code>è¯­è¨€ä¸­ï¼š</p>

<p>Define a function <code class="language-plaintext highlighter-rouge">nondecreaselist</code>, which takes in a scheme list of numbers and outputs a list of lists, which overall has the same numbers in the same order, but grouped into lists that are non-decreasing.</p>

<p>For example, if the input is a list containing elements</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1 2 3 4 1 2 3 4 1 1 1 2 1 1 0 4 3 2 1)
</code></pre></div></div>

<p>the output should contain elements</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">((</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nf">0</span> <span class="mi">4</span><span class="p">)</span> <span class="p">(</span><span class="nf">3</span><span class="p">)</span> <span class="p">(</span><span class="nf">2</span><span class="p">)</span> <span class="p">(</span><span class="nf">1</span><span class="p">))</span>
</code></pre></div></div>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">nondecreaselist</span> <span class="nv">s</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span> 
          <span class="p">((</span><span class="nb">&gt;</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)))</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span> <span class="p">(</span><span class="nf">nondecreaselist</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">))))</span>
          <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">car</span> <span class="p">(</span><span class="nf">nondecreaselist</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">))))</span> <span class="p">(</span><span class="nb">cdr</span> <span class="p">(</span><span class="nf">nondecreaselist</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)))))</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>æ³¨æ„åˆ°å®ç°ä¸­ï¼Œå¦‚æœå‰ä¸€ä¸ªå…ƒç´ çš„å€¼å¤§äºåä¸€ä¸ªå…ƒç´ ï¼Œåˆ™æ­¤æ—¶æ‹¬å·é—­åˆï¼Œæ²¡æœ‰åœ¨æœ¬å±‚æ‹¬å·ä½“å†…å‘ç”Ÿé€’å½’ï¼Œç±»ä¼¼äºå‰è¾¹çš„<code class="language-plaintext highlighter-rouge">scheme_read</code>æƒ…å†µï¼›å¦åˆ™ï¼Œå°†ä¼šåœ¨æœ¬å±‚æ‹¬å·å†…éƒ¨å‘ç”Ÿé€’å½’ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»ç¡®ä¿ä¸‹ä¸€å±‚é€’å½’å‡ºæ¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ åœ¨æ‹¬å·å†…ï¼ˆå› ä¸ºå·²ç»è¢«æ’åºï¼‰ï¼›åˆ™æ‹¬å·å¤–éƒ¨éœ€è¦ä»åˆ—è¡¨ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹æ’èµ·ï¼Œå¹¶æœ€ç»ˆè¿æ¥æˆå®Œæ•´åˆ—è¡¨ï¼Œæœ‰ç‚¹ç±»ä¼¼äº<code class="language-plaintext highlighter-rouge">read_tail</code>çš„æƒ³æ³•ã€‚åœ¨è¿™é‡Œï¼Œå› ä¸ºæ˜¯å‡½æ•°å¼ç¼–ç¨‹ï¼Œæˆ‘ä»¬æ›´ä¸éœ€è¦å»è¿½æº¯å‡½æ•°çš„éå†è¿‡ç¨‹ï¼Œä»æŠ½è±¡çš„è§’åº¦è€ƒè™‘ï¼Œå½“å·²ç»æ£€æµ‹çš„ä¸¤ä¸ªå…ƒç´ ç¡®å®šå¯ä»¥æ”¾åœ¨åŒä¸€ä¸ªæ‹¬å·å†…éƒ¨æ—¶ï¼Œ<strong>éœ€è¦åœ¨æ‹¬å·å†…éƒ¨ä¸æ‹¬å·å¤–éƒ¨åŒæ—¶è¿›è¡Œé€’å½’ï¼ŒåŒæ—¶ï¼Œæˆ‘ä»¬åˆ©ç”¨<code class="language-plaintext highlighter-rouge">car</code>ä¸<code class="language-plaintext highlighter-rouge">cdr</code>ç¡®ä¿å·²ç»ç»è¿‡æ¯”è¾ƒçš„å…ƒç´ åœ¨åº”æœ‰çš„ä½ç½®</strong>ã€‚</p>

<h5 id="f20-lecture-33-q--a">F20 Lecture 33 Q &amp; A</h5>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108302324785.png" alt="image-20210830232407571" style="zoom:50%;" /></p>

<p>è¿™é“é¢˜æˆ‘ä»¬é‡‡ç”¨ä¸åˆ©ç”¨<code class="language-plaintext highlighter-rouge">helper</code>å‡½æ•°çš„æ–¹æ³•æ¥è§£ï¼Œè¦æ¯”ç­”æ¡ˆä¸­çš„æ–¹æ³•ç®€å•è®¸å¤šï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å…ˆè®¨è®º<code class="language-plaintext highlighter-rouge">(car lst)</code>æ˜¯å¦ä¸º<code class="language-plaintext highlighter-rouge">list</code>ï¼Œå…¶ååœ¨è®¨è®ºæ˜¯å¦æ»¡è¶³<code class="language-plaintext highlighter-rouge">filter-fn</code>çš„æ¡ä»¶å³å¯ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">skip-list</span> <span class="nv">lst</span> <span class="nv">filter-fn</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nb">null?</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">nil</span><span class="p">)</span>
        <span class="p">((</span><span class="nb">list?</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">))</span> <span class="p">(</span><span class="nb">append</span> <span class="p">(</span><span class="nf">skip-list</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">filter-fn</span><span class="p">)</span> <span class="p">(</span><span class="nf">skip-list</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">filter-fn</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">else</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nf">filter-fn</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">))</span> 
                  <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">lst</span><span class="p">)</span> <span class="p">(</span><span class="nf">skip-list</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">filter-fn</span><span class="p">))</span> 
                  <span class="p">(</span><span class="nf">skip-list</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">lst</span><span class="p">)</span> <span class="nv">filter-fn</span><span class="p">)</span>
                <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¬¬äºŒä¸ªæ¡ä»¶åˆ¤æ–­æ—¶è¿æ¥åˆ—è¡¨æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code class="language-plaintext highlighter-rouge">append</code>è€Œä¸æ˜¯<code class="language-plaintext highlighter-rouge">cons</code>ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸¤ä¸ªå…ƒç´ å‡ä¸º<code class="language-plaintext highlighter-rouge">list</code>çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨<code class="language-plaintext highlighter-rouge">cons</code>å°†ä¼šäº§ç”Ÿ<code class="language-plaintext highlighter-rouge">nested lists</code>çš„æ•ˆæœï¼Œå¤šå‡ºå‡ å±‚æ‹¬å·ã€‚</p>

<h4 id="tail-call-optimization">Tail Call Optimization</h4>

<p>åœ¨æœ€åçš„å¤§é¡¹ç›®çš„<code class="language-plaintext highlighter-rouge">optional problem</code>ä¸­ï¼Œé‡åˆ°äº†å°¾è°ƒç”¨çš„ä¼˜åŒ–é—®é¢˜ï¼Œåœ¨è¿™é‡Œæµ…æ˜¾çš„æ€»ç»“ä¸€ä¸‹ï¼š</p>

<ol>
  <li>ä»€ä¹ˆæ˜¯å°¾é€’å½’ï¼Ÿ</li>
</ol>

<blockquote>
  <p>å°¾é€’å½’ï¼Œæ¯”çº¿æ€§é€’å½’å¤šä¸€ä¸ªå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ¬¡è°ƒç”¨å‡½æ•°å¾—åˆ°çš„ç»“æœï¼›
æ‰€ä»¥ï¼Œå…³é”®ç‚¹åœ¨äºï¼Œå°¾é€’å½’æ¯æ¬¡è°ƒç”¨éƒ½åœ¨æ”¶é›†ç»“æœï¼Œé¿å…äº†çº¿æ€§é€’å½’ä¸æ”¶é›†ç»“æœåªèƒ½ä¾æ¬¡å±•å¼€æ¶ˆè€—å†…å­˜çš„åå¤„</p>
</blockquote>

<p>å¯ä»¥é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯æ˜ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">sum</span> <span class="nv">n</span> <span class="nv">total</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">zero?</span> <span class="nv">n</span><span class="p">)</span> <span class="nv">total</span>
    <span class="p">(</span><span class="nf">sum</span> <span class="p">(</span><span class="nb">-</span> <span class="nv">n</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">+</span> <span class="nv">n</span> <span class="nv">total</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">sum</span> <span class="mi">1001</span> <span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>åœ¨è¿™é‡Œï¼Œ<code class="language-plaintext highlighter-rouge">total</code>å°±æ˜¯è¢«æˆ‘ä»¬ç”¨æ¥ä¿å­˜è°ƒç”¨å‡½æ•°ç»“æœçš„å‚æ•°ï¼Œæ›´çº¤ç»†ç‚¹è¯´ï¼Œè¿™æ ·åšå¯ä»¥åœ¨ä¸Šå±‚å‡½æ•°æ‰§è¡Œç»“æŸåé”€æ¯å †æ ˆï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»ä¸éœ€è¦äº†ï¼Œæ‰€æœ‰çš„å¯¹åç»­å¤„ç†æœ‰ç”¨çš„ç»“æœè¢«æˆ‘ä»¬ä¿å­˜åœ¨<code class="language-plaintext highlighter-rouge">total</code>ä¸­ã€‚</p>

<ol>
  <li>å®ç°å°¾é€’å½’ä¼˜åŒ–çš„æ–¹æ³•</li>
</ol>

<p>åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">Thunk</code>ï¼Œç®€å•æ¥è¯´å°±æ˜¯æ”¶é›†ç»“æœï¼Œåœ¨ä¸‹æ¬¡éœ€è¦è°ƒç”¨æ—¶ä½¿ç”¨ã€‚</p>

<blockquote>
  <p>The <code class="language-plaintext highlighter-rouge">Thunk</code> class represents a <a href="http://en.wikipedia.org/wiki/Thunk">thunk</a>, an expression that needs to be evaluated in an environment. When <code class="language-plaintext highlighter-rouge">scheme_optimized_eval</code> receives a non-atomic expression in a <code class="language-plaintext highlighter-rouge">tail</code> context, then it returns an <code class="language-plaintext highlighter-rouge">Thunk</code> instance. Otherwise, it should repeatedly call <code class="language-plaintext highlighter-rouge">prior_eval_function</code> until the result is a value, rather than a <code class="language-plaintext highlighter-rouge">Thunk</code>.</p>
</blockquote>

<p>æˆ‘ä»¬éœ€è¦åˆ¤æ–­åœ¨<code class="language-plaintext highlighter-rouge">scheme</code>ä»£ç ä¸­ï¼Œé‚£äº›å¯èƒ½çš„ä½ç½®ä¼šå‡ºç°<code class="language-plaintext highlighter-rouge">tail recursive</code>çš„æƒ…å†µï¼šæ¯”å¦‚<code class="language-plaintext highlighter-rouge">or</code>çš„æœ«å°¾ã€<code class="language-plaintext highlighter-rouge">and</code>çš„æœ«å°¾ã€<code class="language-plaintext highlighter-rouge">if</code>çš„æœ«å°¾ã€<code class="language-plaintext highlighter-rouge">begin</code>çš„æœ«å°¾(åœ¨<code class="language-plaintext highlighter-rouge">eval_all</code>é‡Œ)ç­‰ç­‰ã€‚å½“åœ¨è¿™äº›ä½ç½®ä¸Šè¿›è¡Œ<code class="language-plaintext highlighter-rouge">tail call</code>æ—¶ï¼Œæˆ‘ä»¬å°±è¿”å›<code class="language-plaintext highlighter-rouge">Thunk</code>ï¼Œå…¶ä¸­åŒ…å«ç€å½“å‰çš„<code class="language-plaintext highlighter-rouge">frame</code>ã€‚ä¹‹åé€šè¿‡å¯¹<code class="language-plaintext highlighter-rouge">Thunk.expr</code>çš„è°ƒç”¨ï¼Œå³å¯ç»§ç»­è¿›è¡Œæ–°ä¸€è½®çš„é€’å½’ã€‚è€Œå¦‚æœä¸åœ¨æœ«ä½ï¼Œæœ¬è½®é€’å½’çš„<code class="language-plaintext highlighter-rouge">frame</code>è¿˜éœ€è¦ç»§ç»­å­˜åœ¨ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è¿”å›<code class="language-plaintext highlighter-rouge">Thunk</code>ã€‚</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108302334887.png" alt="image-20210830233453762" style="zoom:50%;" /></p>

<p>é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108302351938.png" alt="image-20210830235109849" style="zoom:50%;" /></p>

<p>åœ¨ä¸Šè¾¹ä¸€ä¸ªä¾‹å­é‡Œï¼Œç¬¬ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">if</code>å°±ä¸æ˜¯<code class="language-plaintext highlighter-rouge">tail context</code>ï¼Œä»€ä¹ˆæ˜¯<code class="language-plaintext highlighter-rouge">tail context</code>?ä¸ä»…ä»…æ˜¯æœ€åä¸€ä¸ª<code class="language-plaintext highlighter-rouge">evaluate</code>çš„éƒ¨åˆ†ï¼Œè€Œæ˜¯è¯´é€šè¿‡åœ¨æœ€å<code class="language-plaintext highlighter-rouge">evaluate</code>è¯¥éƒ¨åˆ†ï¼Œå¯ä»¥è¿”å›å¾—åˆ°å½“å‰çš„<code class="language-plaintext highlighter-rouge">procedure</code>çš„è®¡ç®—ç»“æœï¼Œåœ¨å½“å‰éƒ¨åˆ†çš„<code class="language-plaintext highlighter-rouge">environment frame</code>æ¥ç»§ç»­å‰©ä½™æ“ä½œäº†ã€‚æ˜¾ç„¶è¿™é‡Œçš„<code class="language-plaintext highlighter-rouge">if</code>ä¸ç¬¦åˆã€‚</p>

<p>åœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œç¬¬ä¸€ä¸ªçº¢è‰²éƒ¨åˆ†ä¹Ÿä¸æ˜¯<code class="language-plaintext highlighter-rouge">tail context</code>ï¼Œå› ä¸ºä»–ä¸å¤„äºæœ€åçš„ä½ç½®ï¼ŒåŒæ—¶å…¶ä¸­çš„å°çº¢åœˆä¹Ÿä¸æ˜¯<code class="language-plaintext highlighter-rouge">tail call</code>ï¼Œå› ä¸º<code class="language-plaintext highlighter-rouge">evaluate</code>è¯¥<code class="language-plaintext highlighter-rouge">call expression</code>ä¸èƒ½å¾—åˆ°æ•´ä½“çš„è¿”å›ç»“æœï¼Œ<code class="language-plaintext highlighter-rouge">environment frame</code>åŒæ ·æ— æ³•è¢«ä¸¢å¼ƒï¼Œå‰è¾¹è¿˜æœ‰<code class="language-plaintext highlighter-rouge">(+ current)</code>ã€‚</p>

<h5 id="å®ç°map--reduce">å®ç°map &amp; reduce</h5>

<ul>
  <li>å…³äº<code class="language-plaintext highlighter-rouge">reduce</code>çš„å®ç°ï¼š<code class="language-plaintext highlighter-rouge">recursive call is a tail call</code>:</li>
</ul>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">reduce</span> <span class="nv">procedure</span> <span class="nv">s</span> <span class="nv">start</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">start</span>
      <span class="p">(</span><span class="nf">reduce</span> <span class="nv">procedure</span>
              <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)</span>
              <span class="c1">; change the start</span>
              
              <span class="p">(</span><span class="nf">procedure</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">start</span><span class="p">))</span>
      <span class="p">)</span>
  <span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>ä¸¤ç§<code class="language-plaintext highlighter-rouge">map</code>çš„å®ç°æ–¹æ³•ï¼š</li>
</ul>

<ol>
  <li>éå°¾é€’å½’ï¼š</li>
</ol>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">procedure</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">nil</span>
    <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">procedure</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">))</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">procedure</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">)</span>
</code></pre></div></div>

<p>å› ä¸ºæœ€å<code class="language-plaintext highlighter-rouge">map</code>çš„è¿”å›å€¼è¿˜è¦ç”¨æ¥ç»„æˆ<code class="language-plaintext highlighter-rouge">cons</code>ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">tail context</code>ï¼Œä½†å¹¶é<code class="language-plaintext highlighter-rouge">tail call</code>.</p>

<ol>
  <li>å°¾é€’å½’ï¼š</li>
</ol>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">map</span> <span class="nv">procedure</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">map-reverse</span> <span class="nv">s</span> <span class="nv">m</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">m</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">map-reverse</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nf">procedure</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">))</span> <span class="nv">m</span><span class="p">)))</span>
    <span class="p">)</span>
  <span class="p">)</span>
  <span class="p">(</span><span class="nb">reverse</span> <span class="p">(</span><span class="nf">map-reverse</span> <span class="nv">s</span> <span class="nv">nil</span><span class="p">))</span>
<span class="p">)</span>
</code></pre></div></div>

<p>æ³¨æ„åˆ°è¿™é‡Œçš„å®ç°æ–¹æ³•æ˜¯ä¸€ä¸ªå…¸å‹çš„<code class="language-plaintext highlighter-rouge">tail recursion</code>çš„æ–¹æ³•ï¼Œåœ¨å‡½æ•°å‚æ•°ä¸­å¢æ·»ä¸€ä¸ªç”¨ä»¥å­˜å‚¨å½“å‰è®¡ç®—ç»“æœï¼Œå½“æ•°æ®å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åï¼Œè¿”å›è¯¥å‚æ•°ã€‚</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nb">reverse</span> <span class="nv">s</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nf">reverse-iter</span> <span class="nv">s</span> <span class="nv">r</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">null?</span> <span class="nv">s</span><span class="p">)</span>
      <span class="nv">r</span>
      <span class="p">(</span><span class="nf">reverse-iter</span> <span class="p">(</span><span class="nb">cdr</span> <span class="nv">s</span><span class="p">)</span>
        <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nb">car</span> <span class="nv">s</span><span class="p">)</span> <span class="nv">r</span><span class="p">))))</span>
<span class="p">(</span><span class="nf">reverse-iter</span> <span class="nv">s</span> <span class="nv">nil</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="macro">Macro</h4>

<p>åœ¨<code class="language-plaintext highlighter-rouge">scheme</code>è¯­è¨€ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code class="language-plaintext highlighter-rouge">define-macro</code>ä½¿ç”¨å†…éƒ¨å®šä¹‰çš„<code class="language-plaintext highlighter-rouge">macro</code>å‡½æ•°ã€‚<code class="language-plaintext highlighter-rouge">macro</code>çš„æ‰§è¡Œæ–¹æ³•ä¸ä¸€èˆ¬çš„<code class="language-plaintext highlighter-rouge">procedure</code>ä¸ä¸€æ ·ï¼Œæ€»çš„æ¥è¯´éœ€è¦ç»è¿‡ä¸‰ä¸ªæ­¥éª¤ï¼š</p>

<p><img src="https://shaopu-blog.oss-cn-beijing.aliyuncs.com/img/202108311935604.png" alt="image-20210831193544519" style="zoom:50%;" /></p>

<p>é¦–å…ˆç¬¬ä¸€æ­¥ï¼Œ<code class="language-plaintext highlighter-rouge">evaluate</code>åœ¨<code class="language-plaintext highlighter-rouge">call expression</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">operator</code>éƒ¨åˆ†ï¼Œä¹Ÿå³<code class="language-plaintext highlighter-rouge">twice</code>ï¼Œä¹‹ååœ¨è¿”å›çš„<code class="language-plaintext highlighter-rouge">macro</code>ä¸­<strong>è°ƒç”¨</strong><code class="language-plaintext highlighter-rouge">operand expression</code>ç»‘å®šï¼Œä½†ä¸å»<code class="language-plaintext highlighter-rouge">evaluate the operand expression</code>ï¼Œè€Œæ˜¯åœ¨ä¹‹å‰çš„å·¥ä½œå…¨éƒ¨ç»“æŸåï¼Œ<code class="language-plaintext highlighter-rouge">evaluate the entire expression (body)</code>ã€‚</p>

<blockquote>
  <p>ä¸ºä»€ä¹ˆå®å‡½æ•°ä¸å¯ä»¥è¿™æ ·å†™ï¼Ÿ</p>

  <div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">twice</span> <span class="nv">expr</span><span class="p">)</span> <span class="p">(</span><span class="k">begin</span> <span class="nv">expr</span> <span class="nv">expr</span><span class="p">))</span>
</code></pre></div>  </div>

  <p>å› ä¸ºåœ¨æ‰§è¡Œç¬¬äºŒæ­¥æ—¶ï¼Œä¼šå…ˆ<code class="language-plaintext highlighter-rouge">call the macro procedure on the operand procedure</code>ï¼Œæ­¤æ—¶<code class="language-plaintext highlighter-rouge">begin</code>å°±ä¼šè¢«<code class="language-plaintext highlighter-rouge">eval</code></p>
</blockquote>

<p>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥å†™è¿™æ ·ä¸€ä¸ªå‡½æ•°ï¼Œç”¨ä»¥è¯„ä¼°<code class="language-plaintext highlighter-rouge">x</code>æ˜¯å¦æ»¡è¶³æŸæ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³ï¼Œåˆ™è¾“å‡º<code class="language-plaintext highlighter-rouge">passed</code>ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œåˆ™è¾“å‡º<code class="language-plaintext highlighter-rouge">failed: </code>ï¼Œä»¥åŠä¸æ»¡è¶³çš„æ¡ä»¶ã€‚</p>

<p>ä½¿ç”¨<code class="language-plaintext highlighter-rouge">macro</code>å¯ä»¥è¿™æ ·å®šä¹‰ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">check</span> <span class="nv">expr</span><span class="p">)</span> 
              <span class="p">(</span><span class="nb">list</span> <span class="ss">'if</span> <span class="nv">expr</span> <span class="o">'</span><span class="ss">'passed</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'quote</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'failed:</span> <span class="nv">expr</span><span class="p">))))</span>
<span class="c1">; test</span>

<span class="p">(</span><span class="k">define</span> <span class="nv">x</span> <span class="mi">-2</span><span class="p">)</span>
<span class="p">(</span><span class="nf">check</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></div>

<p>åœ¨æ‰§è¡Œæ—¶ï¼Œæ³¨æ„æ¯æ¬¡<code class="language-plaintext highlighter-rouge">evaluate call expression</code>ä¼šå»æ‰ä½äºåŒä¸€å±‚çš„<code class="language-plaintext highlighter-rouge">quote</code>ç¬¦å·ï¼ˆä½äº<code class="language-plaintext highlighter-rouge">'</code>å†…éƒ¨çš„<code class="language-plaintext highlighter-rouge">'</code>ä¸ä¼šè¢«å±•å¼€ï¼‰ï¼Œå¾—åˆ°å¦‚ä¸‹è¡¨è¾¾å¼ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)</span> <span class="ss">'passed</span> <span class="p">(</span><span class="k">quote</span> <span class="p">(</span><span class="nf">failed:</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">)</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">scheme_eval the above expression, then we get: </code></p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">failed:</span> <span class="p">(</span><span class="nb">&gt;</span> <span class="nv">x</span> <span class="mi">0</span><span class="p">))</span>
</code></pre></div></div>

<blockquote>
  <p>ä¸Šè¿°æ“ä½œæ˜¯é€šè¿‡<code class="language-plaintext highlighter-rouge">define</code>æ— æ³•å®Œæˆçš„ï¼Œç›´æ¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">define</code>ä¼šå…ˆè®¡ç®—<code class="language-plaintext highlighter-rouge">(&gt; x 0)</code></p>
</blockquote>

<p>åŒæ ·åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="language-plaintext highlighter-rouge">macro</code>å†™å‡º<code class="language-plaintext highlighter-rouge">scheme</code>ä¸­çš„<code class="language-plaintext highlighter-rouge">for</code>ï¼š</p>

<div class="language-scheme highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nf">define-macro</span> <span class="p">(</span><span class="nf">for</span> <span class="nv">sym</span> <span class="nv">vals</span> <span class="nv">expr</span><span class="p">)</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'map</span> <span class="p">(</span><span class="nb">list</span> <span class="ss">'lambda</span> <span class="p">(</span><span class="nb">list</span> <span class="nv">sym</span><span class="p">)</span> <span class="nv">expr</span><span class="p">)</span> <span class="nv">vals</span><span class="p">)</span> <span class="p">)</span>

<span class="nv">scm&gt;</span> <span class="p">(</span><span class="nf">for</span> <span class="nv">x</span> <span class="o">'</span><span class="p">(</span><span class="nf">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span> <span class="p">(</span><span class="nb">*</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
<span class="p">(</span><span class="nf">4</span> <span class="mi">9</span> <span class="mi">16</span> <span class="mi">25</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="macroå®ç°">Macroå®ç°</h5>

<p>åœ¨å®é™…å®ç°æ—¶ï¼Œåˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œåœ¨<code class="language-plaintext highlighter-rouge">do_define_macro</code>å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ®<code class="language-plaintext highlighter-rouge">do_define_form</code>ï¼Œç¨ä½œæ”¹åŠ¨ï¼Œå› ä¸ºä¸ä¼šå‡ºç°<code class="language-plaintext highlighter-rouge">define_macro x '(1 2)</code>çš„è¿™ç§å½¢å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸èƒ½ç›´æ¥å¯¹<code class="language-plaintext highlighter-rouge">symbol</code>åšç»‘å®šã€‚</p>

<p>åœ¨<code class="language-plaintext highlighter-rouge">scheme_eval</code>ä¸­ï¼ŒæŒ‰ç…§ä¹‹å‰æè¿°æ‰§è¡Œè¿‡ç¨‹çš„é¡ºåºï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ¤å®š<code class="language-plaintext highlighter-rouge">operator</code>å¯¹åº”çš„ç±»å‹ä¸º<code class="language-plaintext highlighter-rouge">MacroProcedure</code>åï¼Œå…ˆåˆ©ç”¨<code class="language-plaintext highlighter-rouge">apply_macro</code>å°†å®é™…çš„<code class="language-plaintext highlighter-rouge">args</code>ä¸<code class="language-plaintext highlighter-rouge">formals</code>ç»‘å®šï¼ˆåŒæ—¶æ‰§è¡Œäº†<code class="language-plaintext highlighter-rouge">call the Macro on the operand procedure</code>ï¼Œå› ä¸ºæ˜¯ä¸€ä¸ª<code class="language-plaintext highlighter-rouge">mutual recursive</code>çš„è¿‡ç¨‹ï¼‰ï¼Œåœ¨å¤–è¾¹å¥—ä¸€å±‚<code class="language-plaintext highlighter-rouge">scheme_eval</code>ï¼Œç”¨ä»¥è®¡ç®—æ•´ä½“çš„æœ€ç»ˆç»“æœã€‚</p>
:ET